import{f as ba,g as Es,d as I,p as pt,Z as hc,E as ln,h as k,c as Ue,aB as dc,aC as fc,r as wo,aD as mc,aE as gc,aF as Vn,aG as pc,aH as Zt,aI as Tn,aJ as vc,aK as yc,aL as wc,aA as Sc,G as So,ad as ji,ag as Ki,_ as lr,J as he,K as Rn,L as Ne,M as G,P as Y,aM as Le,aN as Ge,U as tt,O as Cn,N as bs,aO as Tc,aP as kn,aQ as Ia,aR as Ca,aS as ka,aT as ur,aU as Aa,aV as xa,aW as Da,u as Ec,a as bc,aX as Ic,Q as Wt,e as Cc,R as kc,s as je,aY as cr,aZ as Ac,j as J,l as _a,Y as xc,z as Dc,A as it,W as nt,a_ as _c,a$ as Nc,C as Na,D as Va,o as zi,b0 as Vc,b1 as Rc,b2 as To,q as yn,b3 as Lc,b4 as Mc,a7 as Is,b5 as Oc,b6 as zt,m as qc,b7 as Ra,n as Fc,ap as Pc,b8 as Uc,ac as Bc,af as $c,v as Eo,ai as jc,T as bo,w as Os,b9 as Kc,B as zc,k as La,ba as Hc,ar as Qc,bb as Gc,bc as Wc,bd as $e,S as Io,be as Xc,F as Yc,I as Co}from"./index.9e6c573f.js";import{Q as Jc}from"./QPage.d6240cf6.js";import"./index.esm.f36f7a7a.js";import{r as qs,Q as Zc,C as ko,u as eh}from"./settings.4fc569ab.js";const th={position:{type:String,default:"bottom-right",validator:t=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(t)},offset:{type:Array,validator:t=>t.length===2},expand:Boolean};function nh(){const{props:t,proxy:{$q:e}}=pt(),n=ba(hc,Es);if(n===Es)return console.error("QPageSticky needs to be child of QLayout"),Es;const i=I(()=>{const d=t.position;return{top:d.indexOf("top")>-1,right:d.indexOf("right")>-1,bottom:d.indexOf("bottom")>-1,left:d.indexOf("left")>-1,vertical:d==="top"||d==="bottom",horizontal:d==="left"||d==="right"}}),s=I(()=>n.header.offset),r=I(()=>n.right.offset),o=I(()=>n.footer.offset),a=I(()=>n.left.offset),l=I(()=>{let d=0,m=0;const f=i.value,y=e.lang.rtl===!0?-1:1;f.top===!0&&s.value!==0?m=`${s.value}px`:f.bottom===!0&&o.value!==0&&(m=`${-o.value}px`),f.left===!0&&a.value!==0?d=`${y*a.value}px`:f.right===!0&&r.value!==0&&(d=`${-y*r.value}px`);const p={transform:`translate(${d}, ${m})`};return t.offset&&(p.margin=`${t.offset[1]}px ${t.offset[0]}px`),f.vertical===!0?(a.value!==0&&(p[e.lang.rtl===!0?"right":"left"]=`${a.value}px`),r.value!==0&&(p[e.lang.rtl===!0?"left":"right"]=`${r.value}px`)):f.horizontal===!0&&(s.value!==0&&(p.top=`${s.value}px`),o.value!==0&&(p.bottom=`${o.value}px`)),p}),u=I(()=>`q-page-sticky row flex-center fixed-${t.position} q-page-sticky--${t.expand===!0?"expand":"shrink"}`);function c(d){const m=ln(d.default);return k("div",{class:u.value,style:l.value},t.expand===!0?m:[k("div",m)])}return{$layout:n,getStickyContent:c}}var ih=Ue({name:"QPageSticky",props:th,setup(t,{slots:e}){const{getStickyContent:n}=nh();return()=>n(e)}}),sh=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},A,hr=hr||{},L=sh||self;function xi(){}function Hi(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function Hn(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function rh(t){return Object.prototype.hasOwnProperty.call(t,Cs)&&t[Cs]||(t[Cs]=++oh)}var Cs="closure_uid_"+(1e9*Math.random()>>>0),oh=0;function ah(t,e,n){return t.call.apply(t.bind,arguments)}function lh(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,i),t.apply(e,s)}}return function(){return t.apply(e,arguments)}}function Ie(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Ie=ah:Ie=lh,Ie.apply(null,arguments)}function gi(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var i=n.slice();return i.push.apply(i,arguments),t.apply(this,i)}}function we(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Wb=function(i,s,r){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(i,o)}}function vt(){this.s=this.s,this.o=this.o}var uh=0;vt.prototype.s=!1;vt.prototype.na=function(){!this.s&&(this.s=!0,this.M(),uh!=0)&&rh(this)};vt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Ma=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function dr(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function Ao(t,e){for(let n=1;n<arguments.length;n++){const i=arguments[n];if(Hi(i)){const s=t.length||0,r=i.length||0;t.length=s+r;for(let o=0;o<r;o++)t[s+o]=i[o]}else t.push(i)}}function Ce(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Ce.prototype.h=function(){this.defaultPrevented=!0};var ch=function(){if(!L.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{L.addEventListener("test",xi,e),L.removeEventListener("test",xi,e)}catch{}return t}();function Di(t){return/^[\s\xa0]*$/.test(t)}var xo=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function ks(t,e){return t<e?-1:t>e?1:0}function Qi(){var t=L.navigator;return t&&(t=t.userAgent)?t:""}function We(t){return Qi().indexOf(t)!=-1}function fr(t){return fr[" "](t),t}fr[" "]=xi;function hh(t){var e=mh;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}var dh=We("Opera"),en=We("Trident")||We("MSIE"),Oa=We("Edge"),Fs=Oa||en,qa=We("Gecko")&&!(Qi().toLowerCase().indexOf("webkit")!=-1&&!We("Edge"))&&!(We("Trident")||We("MSIE"))&&!We("Edge"),fh=Qi().toLowerCase().indexOf("webkit")!=-1&&!We("Edge");function Fa(){var t=L.document;return t?t.documentMode:void 0}var _i;e:{var As="",xs=function(){var t=Qi();if(qa)return/rv:([^\);]+)(\)|;)/.exec(t);if(Oa)return/Edge\/([\d\.]+)/.exec(t);if(en)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(fh)return/WebKit\/(\S+)/.exec(t);if(dh)return/(?:Version)[ \/]?(\S+)/.exec(t)}();if(xs&&(As=xs?xs[1]:""),en){var Ds=Fa();if(Ds!=null&&Ds>parseFloat(As)){_i=String(Ds);break e}}_i=As}var mh={};function gh(){return hh(function(){let t=0;const e=xo(String(_i)).split("."),n=xo("9").split("."),i=Math.max(e.length,n.length);for(let o=0;t==0&&o<i;o++){var s=e[o]||"",r=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],s[0].length==0&&r[0].length==0)break;t=ks(s[1].length==0?0:parseInt(s[1],10),r[1].length==0?0:parseInt(r[1],10))||ks(s[2].length==0,r[2].length==0)||ks(s[2],r[2]),s=s[3],r=r[3]}while(t==0)}return 0<=t})}var Ps;if(L.document&&en){var Do=Fa();Ps=Do||parseInt(_i,10)||void 0}else Ps=void 0;var ph=Ps;function Ln(t,e){if(Ce.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(qa){e:{try{fr(e.nodeName);var s=!0;break e}catch{}s=!1}s||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:vh[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Ln.X.h.call(this)}}we(Ln,Ce);var vh={2:"touch",3:"pen",4:"mouse"};Ln.prototype.h=function(){Ln.X.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Qn="closure_listenable_"+(1e6*Math.random()|0),yh=0;function wh(t,e,n,i,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.ha=s,this.key=++yh,this.ba=this.ea=!1}function Gi(t){t.ba=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function mr(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function Pa(t){const e={};for(const n in t)e[n]=t[n];return e}const _o="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ua(t,e){let n,i;for(let s=1;s<arguments.length;s++){i=arguments[s];for(n in i)t[n]=i[n];for(let r=0;r<_o.length;r++)n=_o[r],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function Wi(t){this.src=t,this.g={},this.h=0}Wi.prototype.add=function(t,e,n,i,s){var r=t.toString();t=this.g[r],t||(t=this.g[r]=[],this.h++);var o=Bs(t,e,i,s);return-1<o?(e=t[o],n||(e.ea=!1)):(e=new wh(e,this.src,r,!!i,s),e.ea=n,t.push(e)),e};function Us(t,e){var n=e.type;if(n in t.g){var i=t.g[n],s=Ma(i,e),r;(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(Gi(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function Bs(t,e,n,i){for(var s=0;s<t.length;++s){var r=t[s];if(!r.ba&&r.listener==e&&r.capture==!!n&&r.ha==i)return s}return-1}var gr="closure_lm_"+(1e6*Math.random()|0),_s={};function Ba(t,e,n,i,s){if(i&&i.once)return ja(t,e,n,i,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)Ba(t,e[r],n,i,s);return null}return n=yr(n),t&&t[Qn]?t.N(e,n,Hn(i)?!!i.capture:!!i,s):$a(t,e,n,!1,i,s)}function $a(t,e,n,i,s,r){if(!e)throw Error("Invalid event type");var o=Hn(s)?!!s.capture:!!s,a=vr(t);if(a||(t[gr]=a=new Wi(t)),n=a.add(e,n,i,o,r),n.proxy)return n;if(i=Sh(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)ch||(s=o),s===void 0&&(s=!1),t.addEventListener(e.toString(),i,s);else if(t.attachEvent)t.attachEvent(za(e.toString()),i);else if(t.addListener&&t.removeListener)t.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Sh(){function t(n){return e.call(t.src,t.listener,n)}const e=Th;return t}function ja(t,e,n,i,s){if(Array.isArray(e)){for(var r=0;r<e.length;r++)ja(t,e[r],n,i,s);return null}return n=yr(n),t&&t[Qn]?t.O(e,n,Hn(i)?!!i.capture:!!i,s):$a(t,e,n,!0,i,s)}function Ka(t,e,n,i,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)Ka(t,e[r],n,i,s);else i=Hn(i)?!!i.capture:!!i,n=yr(n),t&&t[Qn]?(t=t.i,e=String(e).toString(),e in t.g&&(r=t.g[e],n=Bs(r,n,i,s),-1<n&&(Gi(r[n]),Array.prototype.splice.call(r,n,1),r.length==0&&(delete t.g[e],t.h--)))):t&&(t=vr(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Bs(e,n,i,s)),(n=-1<t?e[t]:null)&&pr(n))}function pr(t){if(typeof t!="number"&&t&&!t.ba){var e=t.src;if(e&&e[Qn])Us(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(za(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=vr(e))?(Us(n,t),n.h==0&&(n.src=null,e[gr]=null)):Gi(t)}}}function za(t){return t in _s?_s[t]:_s[t]="on"+t}function Th(t,e){if(t.ba)t=!0;else{e=new Ln(e,this);var n=t.listener,i=t.ha||t.src;t.ea&&pr(t),t=n.call(i,e)}return t}function vr(t){return t=t[gr],t instanceof Wi?t:null}var Ns="__closure_events_fn_"+(1e9*Math.random()>>>0);function yr(t){return typeof t=="function"?t:(t[Ns]||(t[Ns]=function(e){return t.handleEvent(e)}),t[Ns])}function fe(){vt.call(this),this.i=new Wi(this),this.P=this,this.I=null}we(fe,vt);fe.prototype[Qn]=!0;fe.prototype.removeEventListener=function(t,e,n,i){Ka(this,t,e,n,i)};function ye(t,e){var n,i=t.I;if(i)for(n=[];i;i=i.I)n.push(i);if(t=t.P,i=e.type||e,typeof e=="string")e=new Ce(e,t);else if(e instanceof Ce)e.target=e.target||t;else{var s=e;e=new Ce(i,t),Ua(e,s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];s=pi(o,i,!0,e)&&s}if(o=e.g=t,s=pi(o,i,!0,e)&&s,s=pi(o,i,!1,e)&&s,n)for(r=0;r<n.length;r++)o=e.g=n[r],s=pi(o,i,!1,e)&&s}fe.prototype.M=function(){if(fe.X.M.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)Gi(n[i]);delete t.g[e],t.h--}}this.I=null};fe.prototype.N=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)};fe.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};function pi(t,e,n,i){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.ba&&o.capture==n){var a=o.listener,l=o.ha||o.src;o.ea&&Us(t.i,o),s=a.call(l,i)!==!1&&s}}return s&&!i.defaultPrevented}var wr=L.JSON.stringify;function Eh(){var t=Ga;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class bh{constructor(){this.h=this.g=null}add(e,n){const i=Ha.get();i.set(e,n),this.h?this.h.next=i:this.g=i,this.h=i}}var Ha=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new Ih,t=>t.reset());class Ih{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}}function Ch(t){L.setTimeout(()=>{throw t},0)}function Qa(t,e){$s||kh(),js||($s(),js=!0),Ga.add(t,e)}var $s;function kh(){var t=L.Promise.resolve(void 0);$s=function(){t.then(Ah)}}var js=!1,Ga=new bh;function Ah(){for(var t;t=Eh();){try{t.h.call(t.g)}catch(n){Ch(n)}var e=Ha;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}js=!1}function Xi(t,e){fe.call(this),this.h=t||1,this.g=e||L,this.j=Ie(this.lb,this),this.l=Date.now()}we(Xi,fe);A=Xi.prototype;A.ca=!1;A.R=null;A.lb=function(){if(this.ca){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-t):(this.R&&(this.g.clearTimeout(this.R),this.R=null),ye(this,"tick"),this.ca&&(Sr(this),this.start()))}};A.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Sr(t){t.ca=!1,t.R&&(t.g.clearTimeout(t.R),t.R=null)}A.M=function(){Xi.X.M.call(this),Sr(this),delete this.g};function Tr(t,e,n){if(typeof t=="function")n&&(t=Ie(t,n));else if(t&&typeof t.handleEvent=="function")t=Ie(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:L.setTimeout(t,e||0)}function Wa(t){t.g=Tr(()=>{t.g=null,t.i&&(t.i=!1,Wa(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}class xh extends vt{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Wa(this)}M(){super.M(),this.g&&(L.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Mn(t){vt.call(this),this.h=t,this.g={}}we(Mn,vt);var No=[];function Xa(t,e,n,i){Array.isArray(n)||(n&&(No[0]=n.toString()),n=No);for(var s=0;s<n.length;s++){var r=Ba(e,n[s],i||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function Ya(t){mr(t.g,function(e,n){this.g.hasOwnProperty(n)&&pr(e)},t),t.g={}}Mn.prototype.M=function(){Mn.X.M.call(this),Ya(this)};Mn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Yi(){this.g=!0}Yi.prototype.Aa=function(){this.g=!1};function Dh(t,e,n,i,s,r){t.info(function(){if(t.g)if(r)for(var o="",a=r.split("&"),l=0;l<a.length;l++){var u=a[l].split("=");if(1<u.length){var c=u[0];u=u[1];var d=c.split("_");o=2<=d.length&&d[1]=="type"?o+(c+"="+u+"&"):o+(c+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+e+`
`+n+`
`+o})}function _h(t,e,n,i,s,r,o){t.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+e+`
`+n+`
`+r+" "+o})}function Qt(t,e,n,i){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+Vh(t,n)+(i?" "+i:"")})}function Nh(t,e){t.info(function(){return"TIMEOUT: "+e})}Yi.prototype.info=function(){};function Vh(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if(r!="noop"&&r!="stop"&&r!="close")for(var o=1;o<s.length;o++)s[o]=""}}}}return wr(n)}catch{return e}}var Lt={},Vo=null;function Ji(){return Vo=Vo||new fe}Lt.Pa="serverreachability";function Ja(t){Ce.call(this,Lt.Pa,t)}we(Ja,Ce);function On(t){const e=Ji();ye(e,new Ja(e))}Lt.STAT_EVENT="statevent";function Za(t,e){Ce.call(this,Lt.STAT_EVENT,t),this.stat=e}we(Za,Ce);function De(t){const e=Ji();ye(e,new Za(e,t))}Lt.Qa="timingevent";function el(t,e){Ce.call(this,Lt.Qa,t),this.size=e}we(el,Ce);function Gn(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return L.setTimeout(function(){t()},e)}var Zi={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},tl={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Er(){}Er.prototype.h=null;function Ro(t){return t.h||(t.h=t.i())}function nl(){}var Wn={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function br(){Ce.call(this,"d")}we(br,Ce);function Ir(){Ce.call(this,"c")}we(Ir,Ce);var Ks;function es(){}we(es,Er);es.prototype.g=function(){return new XMLHttpRequest};es.prototype.i=function(){return{}};Ks=new es;function Xn(t,e,n,i){this.l=t,this.j=e,this.m=n,this.U=i||1,this.S=new Mn(this),this.O=Rh,t=Fs?125:void 0,this.T=new Xi(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new il}function il(){this.i=null,this.g="",this.h=!1}var Rh=45e3,zs={},Ni={};A=Xn.prototype;A.setTimeout=function(t){this.O=t};function Hs(t,e,n){t.K=1,t.v=ns(ot(e)),t.s=n,t.P=!0,sl(t,null)}function sl(t,e){t.F=Date.now(),Yn(t),t.A=ot(t.v);var n=t.A,i=t.U;Array.isArray(i)||(i=[String(i)]),dl(n.i,"t",i),t.C=0,n=t.l.H,t.h=new il,t.g=Rl(t.l,n?e:null,!t.s),0<t.N&&(t.L=new xh(Ie(t.La,t,t.g),t.N)),Xa(t.S,t.g,"readystatechange",t.ib),e=t.H?Pa(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.da(t.A,t.u,t.s,e)):(t.u="GET",t.g.da(t.A,t.u,null,e)),On(),Dh(t.j,t.u,t.A,t.m,t.U,t.s)}A.ib=function(t){t=t.target;const e=this.L;e&&st(t)==3?e.l():this.La(t)};A.La=function(t){try{if(t==this.g)e:{const c=st(this.g);var e=this.g.Ea();const d=this.g.aa();if(!(3>c)&&(c!=3||Fs||this.g&&(this.h.h||this.g.fa()||qo(this.g)))){this.I||c!=4||e==7||(e==8||0>=d?On(3):On(2)),ts(this);var n=this.g.aa();this.Y=n;t:if(rl(this)){var i=qo(this.g);t="";var s=i.length,r=st(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){kt(this),An(this);var o="";break t}this.h.i=new L.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:r&&e==s-1});i.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=n==200,_h(this.j,this.u,this.A,this.m,this.U,c,n),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Di(a)){var u=a;break t}}u=null}if(n=u)Qt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Qs(this,n);else{this.i=!1,this.o=3,De(12),kt(this),An(this);break e}}this.P?(ol(this,c,o),Fs&&this.i&&c==3&&(Xa(this.S,this.T,"tick",this.hb),this.T.start())):(Qt(this.j,this.m,o,null),Qs(this,o)),c==4&&kt(this),this.i&&!this.I&&(c==4?Dl(this.l,this):(this.i=!1,Yn(this)))}else n==400&&0<o.indexOf("Unknown SID")?(this.o=3,De(12)):(this.o=0,De(13)),kt(this),An(this)}}}catch{}finally{}};function rl(t){return t.g?t.u=="GET"&&t.K!=2&&t.l.Da:!1}function ol(t,e,n){let i=!0,s;for(;!t.I&&t.C<n.length;)if(s=Lh(t,n),s==Ni){e==4&&(t.o=4,De(14),i=!1),Qt(t.j,t.m,null,"[Incomplete Response]");break}else if(s==zs){t.o=4,De(15),Qt(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}else Qt(t.j,t.m,s,null),Qs(t,s);rl(t)&&s!=Ni&&s!=zs&&(t.h.g="",t.C=0),e!=4||n.length!=0||t.h.h||(t.o=1,De(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.$&&(t.$=!0,e=t.l,e.g==t&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Nr(e),e.K=!0,De(11))):(Qt(t.j,t.m,n,"[Invalid Chunked Response]"),kt(t),An(t))}A.hb=function(){if(this.g){var t=st(this.g),e=this.g.fa();this.C<e.length&&(ts(this),ol(this,t,e),this.i&&t!=4&&Yn(this))}};function Lh(t,e){var n=t.C,i=e.indexOf(`
`,n);return i==-1?Ni:(n=Number(e.substring(n,i)),isNaN(n)?zs:(i+=1,i+n>e.length?Ni:(e=e.substr(i,n),t.C=i+n,e)))}A.cancel=function(){this.I=!0,kt(this)};function Yn(t){t.V=Date.now()+t.O,al(t,t.O)}function al(t,e){if(t.B!=null)throw Error("WatchDog timer not null");t.B=Gn(Ie(t.gb,t),e)}function ts(t){t.B&&(L.clearTimeout(t.B),t.B=null)}A.gb=function(){this.B=null;const t=Date.now();0<=t-this.V?(Nh(this.j,this.A),this.K!=2&&(On(),De(17)),kt(this),this.o=2,An(this)):al(this,this.V-t)};function An(t){t.l.G==0||t.I||Dl(t.l,t)}function kt(t){ts(t);var e=t.L;e&&typeof e.na=="function"&&e.na(),t.L=null,Sr(t.T),Ya(t.S),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Qs(t,e){try{var n=t.l;if(n.G!=0&&(n.g==t||Gs(n.h,t))){if(!t.J&&Gs(n.h,t)&&n.G==3){try{var i=n.Fa.g.parse(e)}catch{i=null}if(Array.isArray(i)&&i.length==3){var s=i;if(s[0]==0){e:if(!n.u){if(n.g)if(n.g.F+3e3<t.F)Li(n),rs(n);else break e;_r(n),De(18)}}else n.Ba=s[1],0<n.Ba-n.T&&37500>s[2]&&n.L&&n.A==0&&!n.v&&(n.v=Gn(Ie(n.cb,n),6e3));if(1>=gl(n.h)&&n.ja){try{n.ja()}catch{}n.ja=void 0}}else At(n,11)}else if((t.J||n.g==t)&&Li(n),!Di(e))for(s=n.Fa.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.T=u[0],u=u[1],n.G==2)if(u[0]=="c"){n.I=u[1],n.ka=u[2];const c=u[3];c!=null&&(n.ma=c,n.j.info("VER="+n.ma));const d=u[4];d!=null&&(n.Ca=d,n.j.info("SVER="+n.Ca));const m=u[5];m!=null&&typeof m=="number"&&0<m&&(i=1.5*m,n.J=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const f=t.g;if(f){const y=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(y){var r=i.h;r.g||y.indexOf("spdy")==-1&&y.indexOf("quic")==-1&&y.indexOf("h2")==-1||(r.j=r.l,r.g=new Set,r.h&&(Cr(r,r.h),r.h=null))}if(i.D){const p=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;p&&(i.za=p,ie(i.F,i.D,p))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-t.F,n.j.info("Handshake RTT: "+n.P+"ms")),i=n;var o=t;if(i.sa=Vl(i,i.H?i.ka:null,i.V),o.J){pl(i.h,o);var a=o,l=i.J;l&&a.setTimeout(l),a.B&&(ts(a),Yn(a)),i.g=o}else Al(i);0<n.i.length&&os(n)}else u[0]!="stop"&&u[0]!="close"||At(n,7);else n.G==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?At(n,7):Dr(n):u[0]!="noop"&&n.l&&n.l.wa(u),n.A=0)}}On(4)}catch{}}function Mh(t){if(t.W&&typeof t.W=="function")return t.W();if(typeof Map!="undefined"&&t instanceof Map||typeof Set!="undefined"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(Hi(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}e=[],n=0;for(i in t)e[n++]=t[i];return e}function Oh(t){if(t.oa&&typeof t.oa=="function")return t.oa();if(!t.W||typeof t.W!="function"){if(typeof Map!="undefined"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set!="undefined"&&t instanceof Set)){if(Hi(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const i in t)e[n++]=i;return e}}}function ll(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(Hi(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=Oh(t),i=Mh(t),s=i.length,r=0;r<s;r++)e.call(void 0,i[r],n&&n[r],t)}var ul=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qh(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),s=null;if(0<=i){var r=t[n].substring(0,i);s=t[n].substring(i+1)}else r=t[n];e(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}function Dt(t,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Dt){this.h=e!==void 0?e:t.h,Vi(this,t.j),this.s=t.s,this.g=t.g,Ri(this,t.m),this.l=t.l,e=t.i;var n=new qn;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Lo(this,n),this.o=t.o}else t&&(n=String(t).match(ul))?(this.h=!!e,Vi(this,n[1]||"",!0),this.s=En(n[2]||""),this.g=En(n[3]||"",!0),Ri(this,n[4]),this.l=En(n[5]||"",!0),Lo(this,n[6]||"",!0),this.o=En(n[7]||"")):(this.h=!!e,this.i=new qn(null,this.h))}Dt.prototype.toString=function(){var t=[],e=this.j;e&&t.push(bn(e,Mo,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(bn(e,Mo,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(bn(n,n.charAt(0)=="/"?Uh:Ph,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",bn(n,$h)),t.join("")};function ot(t){return new Dt(t)}function Vi(t,e,n){t.j=n?En(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ri(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Lo(t,e,n){e instanceof qn?(t.i=e,jh(t.i,t.h)):(n||(e=bn(e,Bh)),t.i=new qn(e,t.h))}function ie(t,e,n){t.i.set(e,n)}function ns(t){return ie(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function En(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function bn(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,Fh),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Fh(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var Mo=/[#\/\?@]/g,Ph=/[#\?:]/g,Uh=/[#\?]/g,Bh=/[#\?@]/g,$h=/#/g;function qn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function yt(t){t.g||(t.g=new Map,t.h=0,t.i&&qh(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}A=qn.prototype;A.add=function(t,e){yt(this),this.i=null,t=un(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function cl(t,e){yt(t),e=un(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function hl(t,e){return yt(t),e=un(t,e),t.g.has(e)}A.forEach=function(t,e){yt(this),this.g.forEach(function(n,i){n.forEach(function(s){t.call(e,s,i,this)},this)},this)};A.oa=function(){yt(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let i=0;i<e.length;i++){const s=t[i];for(let r=0;r<s.length;r++)n.push(e[i])}return n};A.W=function(t){yt(this);let e=[];if(typeof t=="string")hl(this,t)&&(e=e.concat(this.g.get(un(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};A.set=function(t,e){return yt(this),this.i=null,t=un(this,t),hl(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};A.get=function(t,e){return t?(t=this.W(t),0<t.length?String(t[0]):e):e};function dl(t,e,n){cl(t,e),0<n.length&&(t.i=null,t.g.set(un(t,e),dr(n)),t.h+=n.length)}A.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var i=e[n];const r=encodeURIComponent(String(i)),o=this.W(i);for(i=0;i<o.length;i++){var s=r;o[i]!==""&&(s+="="+encodeURIComponent(String(o[i]))),t.push(s)}}return this.i=t.join("&")};function un(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function jh(t,e){e&&!t.j&&(yt(t),t.i=null,t.g.forEach(function(n,i){var s=i.toLowerCase();i!=s&&(cl(this,i),dl(this,s,n))},t)),t.j=e}var Kh=class{constructor(t,e){this.h=t,this.g=e}};function fl(t){this.l=t||zh,L.PerformanceNavigationTiming?(t=L.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(L.g&&L.g.Ga&&L.g.Ga()&&L.g.Ga().$b),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var zh=10;function ml(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function gl(t){return t.h?1:t.g?t.g.size:0}function Gs(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function Cr(t,e){t.g?t.g.add(e):t.h=e}function pl(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}fl.prototype.cancel=function(){if(this.i=vl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const t of this.g.values())t.cancel();this.g.clear()}};function vl(t){if(t.h!=null)return t.i.concat(t.h.D);if(t.g!=null&&t.g.size!==0){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return dr(t.i)}function kr(){}kr.prototype.stringify=function(t){return L.JSON.stringify(t,void 0)};kr.prototype.parse=function(t){return L.JSON.parse(t,void 0)};function Hh(){this.g=new kr}function Qh(t,e,n){const i=n||"";try{ll(t,function(s,r){let o=s;Hn(s)&&(o=wr(s)),e.push(i+r+"="+encodeURIComponent(o))})}catch(s){throw e.push(i+"type="+encodeURIComponent("_badmap")),s}}function Gh(t,e){const n=new Yi;if(L.Image){const i=new Image;i.onload=gi(vi,n,i,"TestLoadImage: loaded",!0,e),i.onerror=gi(vi,n,i,"TestLoadImage: error",!1,e),i.onabort=gi(vi,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=gi(vi,n,i,"TestLoadImage: timeout",!1,e),L.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=t}else e(!1)}function vi(t,e,n,i,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(i)}catch{}}function Jn(t){this.l=t.ac||null,this.j=t.jb||!1}we(Jn,Er);Jn.prototype.g=function(){return new is(this.l,this.j)};Jn.prototype.i=function(t){return function(){return t}}({});function is(t,e){fe.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Ar,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}we(is,fe);var Ar=0;A=is.prototype;A.open=function(t,e){if(this.readyState!=Ar)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Fn(this)};A.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||L).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))};A.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Zn(this)),this.readyState=Ar};A.Wa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Fn(this)),this.g&&(this.readyState=3,Fn(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(typeof L.ReadableStream!="undefined"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;yl(this)}else t.text().then(this.Va.bind(this),this.ga.bind(this))};function yl(t){t.j.read().then(t.Ta.bind(t)).catch(t.ga.bind(t))}A.Ta=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Zn(this):Fn(this),this.readyState==3&&yl(this)}};A.Va=function(t){this.g&&(this.response=this.responseText=t,Zn(this))};A.Ua=function(t){this.g&&(this.response=t,Zn(this))};A.ga=function(){this.g&&Zn(this)};function Zn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Fn(t)}A.setRequestHeader=function(t,e){this.v.append(t,e)};A.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};A.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function Fn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(is.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var Wh=L.JSON.parse;function se(t){fe.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=wl,this.K=this.L=!1}we(se,fe);var wl="",Xh=/^https?$/i,Yh=["POST","PUT"];A=se.prototype;A.Ka=function(t){this.L=t};A.da=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ks.g(),this.C=this.u?Ro(this.u):Ro(Ks),this.g.onreadystatechange=Ie(this.Ha,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(r){Oo(this,r);return}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if(typeof i.keys=="function"&&typeof i.get=="function")for(const r of i.keys())n.set(r,i.get(r));else throw Error("Unknown input type for opt_headers: "+String(i));i=Array.from(n.keys()).find(r=>r.toLowerCase()=="content-type"),s=L.FormData&&t instanceof L.FormData,!(0<=Ma(Yh,e))||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[r,o]of n)this.g.setRequestHeader(r,o);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{El(this),0<this.B&&((this.K=Jh(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ie(this.qa,this)):this.A=Tr(this.qa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(r){Oo(this,r)}};function Jh(t){return en&&gh()&&typeof t.timeout=="number"&&t.ontimeout!==void 0}A.qa=function(){typeof hr!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ye(this,"timeout"),this.abort(8))};function Oo(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Sl(t),ss(t)}function Sl(t){t.D||(t.D=!0,ye(t,"complete"),ye(t,"error"))}A.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,ye(this,"complete"),ye(this,"abort"),ss(this))};A.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ss(this,!0)),se.X.M.call(this)};A.Ha=function(){this.s||(this.F||this.v||this.l?Tl(this):this.fb())};A.fb=function(){Tl(this)};function Tl(t){if(t.h&&typeof hr!="undefined"&&(!t.C[1]||st(t)!=4||t.aa()!=2)){if(t.v&&st(t)==4)Tr(t.Ha,0,t);else if(ye(t,"readystatechange"),st(t)==4){t.h=!1;try{const a=t.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var i;if(i=a===0){var s=String(t.H).match(ul)[1]||null;if(!s&&L.self&&L.self.location){var r=L.self.location.protocol;s=r.substr(0,r.length-1)}i=!Xh.test(s?s.toLowerCase():"")}n=i}if(n)ye(t,"complete"),ye(t,"success");else{t.m=6;try{var o=2<st(t)?t.g.statusText:""}catch{o=""}t.j=o+" ["+t.aa()+"]",Sl(t)}}finally{ss(t)}}}}function ss(t,e){if(t.g){El(t);const n=t.g,i=t.C[0]?xi:null;t.g=null,t.C=null,e||ye(t,"ready");try{n.onreadystatechange=i}catch{}}}function El(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(L.clearTimeout(t.A),t.A=null)}function st(t){return t.g?t.g.readyState:0}A.aa=function(){try{return 2<st(this)?this.g.status:-1}catch{return-1}};A.fa=function(){try{return this.g?this.g.responseText:""}catch{return""}};A.Sa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),Wh(e)}};function qo(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case wl:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}A.Ea=function(){return this.m};A.Oa=function(){return typeof this.j=="string"?this.j:String(this.j)};function bl(t){let e="";return mr(t,function(n,i){e+=i,e+=":",e+=n,e+=`\r
`}),e}function xr(t,e,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=bl(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):ie(t,e,n))}function wn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Il(t){this.Ca=0,this.i=[],this.j=new Yi,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=wn("failFast",!1,t),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=wn("baseRetryDelayMs",5e3,t),this.bb=wn("retryDelaySeedMs",1e4,t),this.$a=wn("forwardChannelMaxRetries",2,t),this.ta=wn("forwardChannelRequestTimeoutMs",2e4,t),this.ra=t&&t.xmlHttpFactory||void 0,this.Da=t&&t.Zb||!1,this.J=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.I="",this.h=new fl(t&&t.concurrentRequestLimit),this.Fa=new Hh,this.O=t&&t.fastHandshake||!1,this.N=t&&t.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=t&&t.Xb||!1,t&&t.Aa&&this.j.Aa(),t&&t.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&t&&t.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}A=Il.prototype;A.ma=8;A.G=1;function Dr(t){if(Cl(t),t.G==3){var e=t.U++,n=ot(t.F);ie(n,"SID",t.I),ie(n,"RID",e),ie(n,"TYPE","terminate"),ei(t,n),e=new Xn(t,t.j,e,void 0),e.K=2,e.v=ns(ot(n)),n=!1,L.navigator&&L.navigator.sendBeacon&&(n=L.navigator.sendBeacon(e.v.toString(),"")),!n&&L.Image&&(new Image().src=e.v,n=!0),n||(e.g=Rl(e.l,null),e.g.da(e.v)),e.F=Date.now(),Yn(e)}Nl(t)}function rs(t){t.g&&(Nr(t),t.g.cancel(),t.g=null)}function Cl(t){rs(t),t.u&&(L.clearTimeout(t.u),t.u=null),Li(t),t.h.cancel(),t.m&&(typeof t.m=="number"&&L.clearTimeout(t.m),t.m=null)}function os(t){ml(t.h)||t.m||(t.m=!0,Qa(t.Ja,t),t.C=0)}function Zh(t,e){return gl(t.h)>=t.h.j-(t.m?1:0)?!1:t.m?(t.i=e.D.concat(t.i),!0):t.G==1||t.G==2||t.C>=(t.Za?0:t.$a)?!1:(t.m=Gn(Ie(t.Ja,t,e),_l(t,t.C)),t.C++,!0)}A.Ja=function(t){if(this.m)if(this.m=null,this.G==1){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const s=new Xn(this,this.j,t,void 0);let r=this.s;if(this.S&&(r?(r=Pa(r),Ua(r,this.S)):r=this.S),this.o!==null||this.N||(s.H=r,r=null),this.O)e:{for(var e=0,n=0;n<this.i.length;n++){t:{var i=this.i[n];if("__data__"in i.g&&(i=i.g.__data__,typeof i=="string")){i=i.length;break t}i=void 0}if(i===void 0)break;if(e+=i,4096<e){e=n;break e}if(e===4096||n===this.i.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=kl(this,s,e),n=ot(this.F),ie(n,"RID",t),ie(n,"CVER",22),this.D&&ie(n,"X-HTTP-Session-Id",this.D),ei(this,n),r&&(this.N?e="headers="+encodeURIComponent(String(bl(r)))+"&"+e:this.o&&xr(n,this.o,r)),Cr(this.h,s),this.Ya&&ie(n,"TYPE","init"),this.O?(ie(n,"$req",e),ie(n,"SID","null"),s.Z=!0,Hs(s,n,null)):Hs(s,n,e),this.G=2}}else this.G==3&&(t?Fo(this,t):this.i.length==0||ml(this.h)||Fo(this))};function Fo(t,e){var n;e?n=e.m:n=t.U++;const i=ot(t.F);ie(i,"SID",t.I),ie(i,"RID",n),ie(i,"AID",t.T),ei(t,i),t.o&&t.s&&xr(i,t.o,t.s),n=new Xn(t,t.j,n,t.C+1),t.o===null&&(n.H=t.s),e&&(t.i=e.D.concat(t.i)),e=kl(t,n,1e3),n.setTimeout(Math.round(.5*t.ta)+Math.round(.5*t.ta*Math.random())),Cr(t.h,n),Hs(n,i,e)}function ei(t,e){t.ia&&mr(t.ia,function(n,i){ie(e,i,n)}),t.l&&ll({},function(n,i){ie(e,i,n)})}function kl(t,e,n){n=Math.min(t.i.length,n);var i=t.l?Ie(t.l.Ra,t.l,t):null;e:{var s=t.i;let r=-1;for(;;){const o=["count="+n];r==-1?0<n?(r=s[0].h,o.push("ofs="+r)):r=0:o.push("ofs="+r);let a=!0;for(let l=0;l<n;l++){let u=s[l].h;const c=s[l].g;if(u-=r,0>u)r=Math.max(0,s[l].h-100),a=!1;else try{Qh(c,o,"req"+u+"_")}catch{i&&i(c)}}if(a){i=o.join("&");break e}}}return t=t.i.splice(0,n),e.D=t,i}function Al(t){t.g||t.u||(t.Z=1,Qa(t.Ia,t),t.A=0)}function _r(t){return t.g||t.u||3<=t.A?!1:(t.Z++,t.u=Gn(Ie(t.Ia,t),_l(t,t.A)),t.A++,!0)}A.Ia=function(){if(this.u=null,xl(this),this.$&&!(this.K||this.g==null||0>=this.P)){var t=2*this.P;this.j.info("BP detection timer enabled: "+t),this.B=Gn(Ie(this.eb,this),t)}};A.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,De(10),rs(this),xl(this))};function Nr(t){t.B!=null&&(L.clearTimeout(t.B),t.B=null)}function xl(t){t.g=new Xn(t,t.j,"rpc",t.Z),t.o===null&&(t.g.H=t.s),t.g.N=0;var e=ot(t.sa);ie(e,"RID","rpc"),ie(e,"SID",t.I),ie(e,"CI",t.L?"0":"1"),ie(e,"AID",t.T),ie(e,"TYPE","xmlhttp"),ei(t,e),t.o&&t.s&&xr(e,t.o,t.s),t.J&&t.g.setTimeout(t.J);var n=t.g;t=t.ka,n.K=1,n.v=ns(ot(e)),n.s=null,n.P=!0,sl(n,t)}A.cb=function(){this.v!=null&&(this.v=null,rs(this),_r(this),De(19))};function Li(t){t.v!=null&&(L.clearTimeout(t.v),t.v=null)}function Dl(t,e){var n=null;if(t.g==e){Li(t),Nr(t),t.g=null;var i=2}else if(Gs(t.h,e))n=e.D,pl(t.h,e),i=1;else return;if(t.G!=0){if(t.pa=e.Y,e.i)if(i==1){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;i=Ji(),ye(i,new el(i,n)),os(t)}else Al(t);else if(s=e.o,s==3||s==0&&0<t.pa||!(i==1&&Zh(t,e)||i==2&&_r(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),s){case 1:At(t,5);break;case 4:At(t,10);break;case 3:At(t,6);break;default:At(t,2)}}}function _l(t,e){let n=t.Xa+Math.floor(Math.random()*t.bb);return t.l||(n*=2),n*e}function At(t,e){if(t.j.info("Error code "+e),e==2){var n=null;t.l&&(n=null);var i=Ie(t.kb,t);n||(n=new Dt("//www.google.com/images/cleardot.gif"),L.location&&L.location.protocol=="http"||Vi(n,"https"),ns(n)),Gh(n.toString(),i)}else De(2);t.G=0,t.l&&t.l.va(e),Nl(t),Cl(t)}A.kb=function(t){t?(this.j.info("Successfully pinged google.com"),De(2)):(this.j.info("Failed to ping google.com"),De(1))};function Nl(t){if(t.G=0,t.la=[],t.l){const e=vl(t.h);(e.length!=0||t.i.length!=0)&&(Ao(t.la,e),Ao(t.la,t.i),t.h.i.length=0,dr(t.i),t.i.length=0),t.l.ua()}}function Vl(t,e,n){var i=n instanceof Dt?ot(n):new Dt(n,void 0);if(i.g!="")e&&(i.g=e+"."+i.g),Ri(i,i.m);else{var s=L.location;i=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var r=new Dt(null,void 0);i&&Vi(r,i),e&&(r.g=e),s&&Ri(r,s),n&&(r.l=n),i=r}return n=t.D,e=t.za,n&&e&&ie(i,n,e),ie(i,"VER",t.ma),ei(t,i),i}function Rl(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=n&&t.Da&&!t.ra?new se(new Jn({jb:!0})):new se(t.ra),e.Ka(t.H),e}function Ll(){}A=Ll.prototype;A.xa=function(){};A.wa=function(){};A.va=function(){};A.ua=function(){};A.Ra=function(){};function Mi(){if(en&&!(10<=Number(ph)))throw Error("Environmental error: no available transport.")}Mi.prototype.g=function(t,e){return new Oe(t,e)};function Oe(t,e){fe.call(this),this.g=new Il(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.S=t,(t=e&&e.Yb)&&!Di(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Di(e)&&(this.g.D=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new cn(this)}we(Oe,fe);Oe.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;De(0),t.V=e,t.ia=n||{},t.L=t.Y,t.F=Vl(t,null,t.V),os(t)};Oe.prototype.close=function(){Dr(this.g)};Oe.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=wr(t),t=n);e.i.push(new Kh(e.ab++,t)),e.G==3&&os(e)};Oe.prototype.M=function(){this.g.l=null,delete this.j,Dr(this.g),delete this.g,Oe.X.M.call(this)};function Ml(t){br.call(this);var e=t.__sm__;if(e){e:{for(const n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}we(Ml,br);function Ol(){Ir.call(this),this.status=1}we(Ol,Ir);function cn(t){this.g=t}we(cn,Ll);cn.prototype.xa=function(){ye(this.g,"a")};cn.prototype.wa=function(t){ye(this.g,new Ml(t))};cn.prototype.va=function(t){ye(this.g,new Ol)};cn.prototype.ua=function(){ye(this.g,"b")};Mi.prototype.createWebChannel=Mi.prototype.g;Oe.prototype.send=Oe.prototype.u;Oe.prototype.open=Oe.prototype.m;Oe.prototype.close=Oe.prototype.close;Zi.NO_ERROR=0;Zi.TIMEOUT=8;Zi.HTTP_ERROR=6;tl.COMPLETE="complete";nl.EventType=Wn;Wn.OPEN="a";Wn.CLOSE="b";Wn.ERROR="c";Wn.MESSAGE="d";fe.prototype.listen=fe.prototype.N;se.prototype.listenOnce=se.prototype.O;se.prototype.getLastError=se.prototype.Oa;se.prototype.getLastErrorCode=se.prototype.Ea;se.prototype.getStatus=se.prototype.aa;se.prototype.getResponseJson=se.prototype.Sa;se.prototype.getResponseText=se.prototype.fa;se.prototype.send=se.prototype.da;se.prototype.setWithCredentials=se.prototype.Ka;var ed=function(){return new Mi},td=function(){return Ji()},Vs=Zi,nd=tl,id=Lt,Po={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},sd=Jn,yi=nl,rd=se;const Uo="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ee{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ee.UNAUTHENTICATED=new Ee(null),Ee.GOOGLE_CREDENTIALS=new Ee("google-credentials-uid"),Ee.FIRST_PARTY=new Ee("first-party-uid"),Ee.MOCK_USER=new Ee("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hn="9.13.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nt=new mc("@firebase/firestore");function Bo(){return Nt.logLevel}function x(t,...e){if(Nt.logLevel<=Vn.DEBUG){const n=e.map(Vr);Nt.debug(`Firestore (${hn}): ${t}`,...n)}}function at(t,...e){if(Nt.logLevel<=Vn.ERROR){const n=e.map(Vr);Nt.error(`Firestore (${hn}): ${t}`,...n)}}function Ws(t,...e){if(Nt.logLevel<=Vn.WARN){const n=e.map(Vr);Nt.warn(`Firestore (${hn}): ${t}`,...n)}}function Vr(t){if(typeof t=="string")return t;try{return e=t,JSON.stringify(e)}catch{return t}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q(t="Unexpected state"){const e=`FIRESTORE (${hn}) INTERNAL ASSERTION FAILED: `+t;throw at(e),new Error(e)}function ee(t,e){t||q()}function F(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends gc{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class od{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Ee.UNAUTHENTICATED))}shutdown(){}}class ad{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class ld{constructor(e){this.t=e,this.currentUser=Ee.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let i=this.i;const s=l=>this.i!==i?(i=this.i,n(l)):Promise.resolve();let r=new ht;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new ht,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=r;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new ht)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(i=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(ee(typeof i.accessToken=="string"),new ql(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return ee(e===null||typeof e=="string"),new Ee(e)}}class ud{constructor(e,n,i,s){this.h=e,this.l=n,this.m=i,this.g=s,this.type="FirstParty",this.user=Ee.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(ee(!(typeof this.h!="object"||this.h===null||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class cd{constructor(e,n,i,s){this.h=e,this.l=n,this.m=i,this.g=s}getToken(){return Promise.resolve(new ud(this.h,this.l,this.m,this.g))}start(e,n){e.enqueueRetryable(()=>n(Ee.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class hd{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class dd{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,n){const i=r=>{r.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const o=r.token!==this.A;return this.A=r.token,x("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable(()=>i(r))};const s=r=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.appCheck.addTokenListener(this.o)};this.T.onInit(r=>s(r)),setTimeout(()=>{if(!this.appCheck){const r=this.T.getImmediate({optional:!0});r?s(r):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(ee(typeof n.token=="string"),this.A=n.token,new hd(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fd(t){const e=typeof self!="undefined"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let i=0;i<t;i++)n[i]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fl{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const s=fd(40);for(let r=0;r<s.length;++r)i.length<20&&s[r]<n&&(i+=e.charAt(s[r]%e.length))}return i}}function W(t,e){return t<e?-1:t>e?1:0}function tn(t,e,n){return t.length===e.length&&t.every((i,s)=>n(i,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class le{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new C(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new C(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new C(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new C(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return le.fromMillis(Date.now())}static fromDate(e){return le.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*n));return new le(n,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j{constructor(e){this.timestamp=e}static fromTimestamp(e){return new j(e)}static min(){return new j(new le(0,0))}static max(){return new j(new le(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e,n,i){n===void 0?n=0:n>e.length&&q(),i===void 0?i=e.length-n:i>e.length-n&&q(),this.segments=e,this.offset=n,this.len=i}get length(){return this.len}isEqual(e){return Pn.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Pn?e.forEach(i=>{n.push(i)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,i=this.limit();n<i;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const i=Math.min(e.length,n.length);for(let s=0;s<i;s++){const r=e.get(s),o=n.get(s);if(r<o)return-1;if(r>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class te extends Pn{construct(e,n,i){return new te(e,n,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const n=[];for(const i of e){if(i.indexOf("//")>=0)throw new C(g.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);n.push(...i.split("/").filter(s=>s.length>0))}return new te(n)}static emptyPath(){return new te([])}}const md=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class be extends Pn{construct(e,n,i){return new be(e,n,i)}static isValidIdentifier(e){return md.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),be.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new be(["__name__"])}static fromServerFormat(e){const n=[];let i="",s=0;const r=()=>{if(i.length===0)throw new C(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(i),i=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new C(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new C(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(i+=a,s++):(r(),s++)}if(r(),o)throw new C(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new be(n)}static emptyPath(){return new be([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D{constructor(e){this.path=e}static fromPath(e){return new D(te.fromString(e))}static fromName(e){return new D(te.fromString(e).popFirst(5))}static empty(){return new D(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&te.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return te.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new D(new te(e.slice()))}}function gd(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,s=j.fromTimestamp(i===1e9?new le(n+1,0):new le(n,i));return new ft(s,D.empty(),e)}function pd(t){return new ft(t.readTime,t.key,-1)}class ft{constructor(e,n,i){this.readTime=e,this.documentKey=n,this.largestBatchId=i}static min(){return new ft(j.min(),D.empty(),-1)}static max(){return new ft(j.max(),D.empty(),-1)}}function vd(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=D.comparator(t.documentKey,e.documentKey),n!==0?n:W(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yd="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class wd{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ti(t){if(t.code!==g.FAILED_PRECONDITION||t.message!==yd)throw t;x("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&q(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new v((i,s)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(i,s)},this.catchCallback=r=>{this.wrapFailure(n,r).next(i,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof v?n:v.resolve(n)}catch(n){return v.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):v.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):v.reject(n)}static resolve(e){return new v((n,i)=>{n(e)})}static reject(e){return new v((n,i)=>{i(e)})}static waitFor(e){return new v((n,i)=>{let s=0,r=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++r,o&&r===s&&n()},l=>i(l))}),o=!0,r===s&&n()})}static or(e){let n=v.resolve(!1);for(const i of e)n=n.next(s=>s?v.resolve(s):i());return n}static forEach(e,n){const i=[];return e.forEach((s,r)=>{i.push(n.call(this,s,r))}),this.waitFor(i)}static mapArray(e,n){return new v((i,s)=>{const r=e.length,o=new Array(r);let a=0;for(let l=0;l<r;l++){const u=l;n(e[u]).next(c=>{o[u]=c,++a,a===r&&i(o)},c=>s(c))}})}static doWhile(e,n){return new v((i,s)=>{const r=()=>{e()===!0?n().next(()=>{r()},s):i()};r()})}}function ni(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this.ut(i),this.ct=i=>n.writeSequenceNumber(i))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $o(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function dn(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Pl(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Rr.at=-1;class ce{constructor(e,n){this.comparator=e,this.root=n||pe.EMPTY}insert(e,n){return new ce(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,pe.BLACK,null,null))}remove(e){return new ce(this.comparator,this.root.remove(e,this.comparator).copy(null,null,pe.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(i===0)return n.value;i<0?n=n.left:i>0&&(n=n.right)}return null}indexOf(e){let n=0,i=this.root;for(;!i.isEmpty();){const s=this.comparator(e,i.key);if(s===0)return n+i.left.size;s<0?i=i.left:(n+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,i)=>(e(n,i),!1))}toString(){const e=[];return this.inorderTraversal((n,i)=>(e.push(`${n}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new wi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new wi(this.root,e,this.comparator,!1)}getReverseIterator(){return new wi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new wi(this.root,e,this.comparator,!0)}}class wi{constructor(e,n,i,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=n?i(e.key,n):1,n&&s&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class pe{constructor(e,n,i,s,r){this.key=e,this.value=n,this.color=i!=null?i:pe.RED,this.left=s!=null?s:pe.EMPTY,this.right=r!=null?r:pe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,i,s,r){return new pe(e!=null?e:this.key,n!=null?n:this.value,i!=null?i:this.color,s!=null?s:this.left,r!=null?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,i){let s=this;const r=i(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,n,i),null):r===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return pe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let i,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return pe.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,pe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,pe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw q();const e=this.left.check();if(e!==this.right.check())throw q();return e+(this.isRed()?0:1)}}pe.EMPTY=null,pe.RED=!0,pe.BLACK=!1;pe.EMPTY=new class{constructor(){this.size=0}get key(){throw q()}get value(){throw q()}get color(){throw q()}get left(){throw q()}get right(){throw q()}copy(t,e,n,i,s){return this}insert(t,e,n){return new pe(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(e){this.comparator=e,this.data=new ce(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,i)=>(e(n),!1))}forEachInRange(e,n){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const s=i.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let i;for(i=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new jo(this.data.getIterator())}getIteratorFrom(e){return new jo(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(i=>{n=n.add(i)}),n}isEqual(e){if(!(e instanceof ue)||this.size!==e.size)return!1;const n=this.data.getIterator(),i=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,r=i.getNext().key;if(this.comparator(s,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new ue(this.comparator);return n.data=e,n}}class jo{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xe{constructor(e){this.fields=e,e.sort(be.comparator)}static empty(){return new Xe([])}unionWith(e){let n=new ue(be.comparator);for(const i of this.fields)n=n.add(i);for(const i of e)n=n.add(i);return new Xe(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return tn(this.fields,e.fields,(n,i)=>n.isEqual(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ke{constructor(e){this.binaryString=e}static fromBase64String(e){const n=atob(e);return new ke(n)}static fromUint8Array(e){const n=function(i){let s="";for(let r=0;r<i.length;++r)s+=String.fromCharCode(i[r]);return s}(e);return new ke(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ke.EMPTY_BYTE_STRING=new ke("");const Sd=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mt(t){if(ee(!!t),typeof t=="string"){let e=0;const n=Sd.exec(t);if(ee(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ae(t.seconds),nanos:ae(t.nanos)}}function ae(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function nn(t){return typeof t=="string"?ke.fromBase64String(t):ke.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ul(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Bl(t){const e=t.mapValue.fields.__previous_value__;return Ul(e)?Bl(e):e}function Un(t){const e=mt(t.mapValue.fields.__local_write_time__.timestampValue);return new le(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Td{constructor(e,n,i,s,r,o,a,l){this.databaseId=e,this.appId=n,this.persistenceKey=i,this.host=s,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=l}}class Bn{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new Bn("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Bn&&e.projectId===this.projectId&&e.database===this.database}}function as(t){return t==null}function Oi(t){return t===0&&1/t==-1/0}function Ed(t){return typeof t=="number"&&Number.isInteger(t)&&!Oi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Si={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Vt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ul(t)?4:bd(t)?9007199254740991:10:q()}function Ye(t,e){if(t===e)return!0;const n=Vt(t);if(n!==Vt(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Un(t).isEqual(Un(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const r=mt(i.timestampValue),o=mt(s.timestampValue);return r.seconds===o.seconds&&r.nanos===o.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return nn(i.bytesValue).isEqual(nn(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return ae(i.geoPointValue.latitude)===ae(s.geoPointValue.latitude)&&ae(i.geoPointValue.longitude)===ae(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ae(i.integerValue)===ae(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const r=ae(i.doubleValue),o=ae(s.doubleValue);return r===o?Oi(r)===Oi(o):isNaN(r)&&isNaN(o)}return!1}(t,e);case 9:return tn(t.arrayValue.values||[],e.arrayValue.values||[],Ye);case 10:return function(i,s){const r=i.mapValue.fields||{},o=s.mapValue.fields||{};if($o(r)!==$o(o))return!1;for(const a in r)if(r.hasOwnProperty(a)&&(o[a]===void 0||!Ye(r[a],o[a])))return!1;return!0}(t,e);default:return q()}}function $n(t,e){return(t.values||[]).find(n=>Ye(n,e))!==void 0}function sn(t,e){if(t===e)return 0;const n=Vt(t),i=Vt(e);if(n!==i)return W(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return W(t.booleanValue,e.booleanValue);case 2:return function(s,r){const o=ae(s.integerValue||s.doubleValue),a=ae(r.integerValue||r.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(t,e);case 3:return Ko(t.timestampValue,e.timestampValue);case 4:return Ko(Un(t),Un(e));case 5:return W(t.stringValue,e.stringValue);case 6:return function(s,r){const o=nn(s),a=nn(r);return o.compareTo(a)}(t.bytesValue,e.bytesValue);case 7:return function(s,r){const o=s.split("/"),a=r.split("/");for(let l=0;l<o.length&&l<a.length;l++){const u=W(o[l],a[l]);if(u!==0)return u}return W(o.length,a.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,r){const o=W(ae(s.latitude),ae(r.latitude));return o!==0?o:W(ae(s.longitude),ae(r.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(s,r){const o=s.values||[],a=r.values||[];for(let l=0;l<o.length&&l<a.length;++l){const u=sn(o[l],a[l]);if(u)return u}return W(o.length,a.length)}(t.arrayValue,e.arrayValue);case 10:return function(s,r){if(s===Si.mapValue&&r===Si.mapValue)return 0;if(s===Si.mapValue)return 1;if(r===Si.mapValue)return-1;const o=s.fields||{},a=Object.keys(o),l=r.fields||{},u=Object.keys(l);a.sort(),u.sort();for(let c=0;c<a.length&&c<u.length;++c){const d=W(a[c],u[c]);if(d!==0)return d;const m=sn(o[a[c]],l[u[c]]);if(m!==0)return m}return W(a.length,u.length)}(t.mapValue,e.mapValue);default:throw q()}}function Ko(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return W(t,e);const n=mt(t),i=mt(e),s=W(n.seconds,i.seconds);return s!==0?s:W(n.nanos,i.nanos)}function Xt(t){return Xs(t)}function Xs(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(i){const s=mt(i);return`time(${s.seconds},${s.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?nn(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,D.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(i){let s="[",r=!0;for(const o of i.values||[])r?r=!1:s+=",",s+=Xs(o);return s+"]"}(t.arrayValue):"mapValue"in t?function(i){const s=Object.keys(i.fields||{}).sort();let r="{",o=!0;for(const a of s)o?o=!1:r+=",",r+=`${a}:${Xs(i.fields[a])}`;return r+"}"}(t.mapValue):q();var e,n}function zo(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ys(t){return!!t&&"integerValue"in t}function Lr(t){return!!t&&"arrayValue"in t}function Ho(t){return!!t&&"nullValue"in t}function Qo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function bi(t){return!!t&&"mapValue"in t}function xn(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return dn(t.mapValue.fields,(n,i)=>e.mapValue.fields[n]=xn(i)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=xn(t.arrayValue.values[n]);return e}return Object.assign({},t)}function bd(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe{constructor(e){this.value=e}static empty(){return new Pe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let i=0;i<e.length-1;++i)if(n=(n.mapValue.fields||{})[e.get(i)],!bi(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=xn(n)}setAll(e){let n=be.emptyPath(),i={},s=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,i,s),i={},s=[],n=a.popLast()}o?i[a.lastSegment()]=xn(o):s.push(a.lastSegment())});const r=this.getFieldsMap(n);this.applyChanges(r,i,s)}delete(e){const n=this.field(e.popLast());bi(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Ye(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let i=0;i<e.length;++i){let s=n.mapValue.fields[e.get(i)];bi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(i)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,i){dn(n,(s,r)=>e[s]=r);for(const s of i)delete e[s]}clone(){return new Pe(xn(this.value))}}function $l(t){const e=[];return dn(t.fields,(n,i)=>{const s=new be([n]);if(bi(i)){const r=$l(i.mapValue).fields;if(r.length===0)e.push(s);else for(const o of r)e.push(s.child(o))}else e.push(s)}),new Xe(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ve{constructor(e,n,i,s,r,o){this.key=e,this.documentType=n,this.version=i,this.readTime=s,this.data=r,this.documentState=o}static newInvalidDocument(e){return new ve(e,0,j.min(),j.min(),Pe.empty(),0)}static newFoundDocument(e,n,i){return new ve(e,1,n,j.min(),i,0)}static newNoDocument(e,n){return new ve(e,2,n,j.min(),Pe.empty(),0)}static newUnknownDocument(e,n){return new ve(e,3,n,j.min(),Pe.empty(),2)}convertToFoundDocument(e,n){return this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ve&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ve(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id{constructor(e,n=null,i=[],s=[],r=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=i,this.filters=s,this.limit=r,this.startAt=o,this.endAt=a,this.ht=null}}function Go(t,e=null,n=[],i=[],s=null,r=null,o=null){return new Id(t,e,n,i,s,r,o)}function Mr(t){const e=F(t);if(e.ht===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(i=>{return(s=i).field.canonicalString()+s.op.toString()+Xt(s.value);var s}).join(","),n+="|ob:",n+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),as(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>Xt(i)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>Xt(i)).join(",")),e.ht=n}return e.ht}function Cd(t){let e=t.path.canonicalString();return t.collectionGroup!==null&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(n=>{return`${(i=n).field.canonicalString()} ${i.op} ${Xt(i.value)}`;var i}).join(", ")}]`),as(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(n=>function(i){return`${i.field.canonicalString()} (${i.dir})`}(n)).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>Xt(n)).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>Xt(n)).join(",")),`Target(${e})`}function Or(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<t.orderBy.length;s++)if(!Rd(t.orderBy[s],e.orderBy[s]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],i=e.filters[s],n.op!==i.op||!n.field.isEqual(i.field)||!Ye(n.value,i.value))return!1;var n,i;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Xo(t.startAt,e.startAt)&&Xo(t.endAt,e.endAt)}function Js(t){return D.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class _e extends class{}{constructor(e,n,i){super(),this.field=e,this.op=n,this.value=i}static create(e,n,i){return e.isKeyField()?n==="in"||n==="not-in"?this.lt(e,n,i):new kd(e,n,i):n==="array-contains"?new Dd(e,i):n==="in"?new _d(e,i):n==="not-in"?new Nd(e,i):n==="array-contains-any"?new Vd(e,i):new _e(e,n,i)}static lt(e,n,i){return n==="in"?new Ad(e,i):new xd(e,i)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.ft(sn(n,this.value)):n!==null&&Vt(this.value)===Vt(n)&&this.ft(sn(n,this.value))}ft(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return q()}}dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class kd extends _e{constructor(e,n,i){super(e,n,i),this.key=D.fromName(i.referenceValue)}matches(e){const n=D.comparator(e.key,this.key);return this.ft(n)}}class Ad extends _e{constructor(e,n){super(e,"in",n),this.keys=jl("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class xd extends _e{constructor(e,n){super(e,"not-in",n),this.keys=jl("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function jl(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(i=>D.fromName(i.referenceValue))}class Dd extends _e{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Lr(n)&&$n(n.arrayValue,this.value)}}class _d extends _e{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&$n(this.value.arrayValue,n)}}class Nd extends _e{constructor(e,n){super(e,"not-in",n)}matches(e){if($n(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!$n(this.value.arrayValue,n)}}class Vd extends _e{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Lr(n)||!n.arrayValue.values)&&n.arrayValue.values.some(i=>$n(this.value.arrayValue,i))}}class qi{constructor(e,n){this.position=e,this.inclusive=n}}class Dn{constructor(e,n="asc"){this.field=e,this.dir=n}}function Rd(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Wo(t,e,n){let i=0;for(let s=0;s<t.position.length;s++){const r=e[s],o=t.position[s];if(r.field.isKeyField()?i=D.comparator(D.fromName(o.referenceValue),n.key):i=sn(o,n.data.field(r.field)),r.dir==="desc"&&(i*=-1),i!==0)break}return i}function Xo(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ye(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{constructor(e,n=null,i=[],s=[],r=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=i,this.filters=s,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=l,this._t=null,this.wt=null,this.startAt,this.endAt}}function Ld(t,e,n,i,s,r,o,a){return new ii(t,e,n,i,s,r,o,a)}function Kl(t){return new ii(t)}function Yo(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function zl(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Hl(t){for(const e of t.filters)if(e.dt())return e.field;return null}function Ql(t){return t.collectionGroup!==null}function jn(t){const e=F(t);if(e._t===null){e._t=[];const n=Hl(e),i=zl(e);if(n!==null&&i===null)n.isKeyField()||e._t.push(new Dn(n)),e._t.push(new Dn(be.keyField(),"asc"));else{let s=!1;for(const r of e.explicitOrderBy)e._t.push(r),r.field.isKeyField()&&(s=!0);if(!s){const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e._t.push(new Dn(be.keyField(),r))}}}return e._t}function lt(t){const e=F(t);if(!e.wt)if(e.limitType==="F")e.wt=Go(e.path,e.collectionGroup,jn(e),e.filters,e.limit,e.startAt,e.endAt);else{const n=[];for(const r of jn(e)){const o=r.dir==="desc"?"asc":"desc";n.push(new Dn(r.field,o))}const i=e.endAt?new qi(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new qi(e.startAt.position,e.startAt.inclusive):null;e.wt=Go(e.path,e.collectionGroup,n,e.filters,e.limit,i,s)}return e.wt}function Zs(t,e,n){return new ii(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ls(t,e){return Or(lt(t),lt(e))&&t.limitType===e.limitType}function Gl(t){return`${Mr(lt(t))}|lt:${t.limitType}`}function er(t){return`Query(target=${Cd(lt(t))}; limitType=${t.limitType})`}function qr(t,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):D.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(t,e)&&function(n,i){for(const s of n.explicitOrderBy)if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(n,i){return!(n.startAt&&!function(s,r,o){const a=Wo(s,r,o);return s.inclusive?a<=0:a<0}(n.startAt,jn(n),i)||n.endAt&&!function(s,r,o){const a=Wo(s,r,o);return s.inclusive?a>=0:a>0}(n.endAt,jn(n),i))}(t,e)}function Md(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Wl(t){return(e,n)=>{let i=!1;for(const s of jn(t)){const r=Od(s,e,n);if(r!==0)return r;i=i||s.field.isKeyField()}return 0}}function Od(t,e,n){const i=t.field.isKeyField()?D.comparator(e.key,n.key):function(s,r,o){const a=r.data.field(s),l=o.data.field(s);return a!==null&&l!==null?sn(a,l):q()}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return q()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xl(t,e){if(t.gt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Oi(e)?"-0":e}}function Yl(t){return{integerValue:""+t}}function qd(t,e){return Ed(e)?Yl(e):Xl(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(){this._=void 0}}function Fd(t,e,n){return t instanceof Fi?function(i,s){const r={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&(r.fields.__previous_value__=s),{mapValue:r}}(n,e):t instanceof Kn?Zl(t,e):t instanceof zn?eu(t,e):function(i,s){const r=Jl(i,s),o=Jo(r)+Jo(i.yt);return Ys(r)&&Ys(i.yt)?Yl(o):Xl(i.It,o)}(t,e)}function Pd(t,e,n){return t instanceof Kn?Zl(t,e):t instanceof zn?eu(t,e):n}function Jl(t,e){return t instanceof Pi?Ys(n=e)||function(i){return!!i&&"doubleValue"in i}(n)?e:{integerValue:0}:null;var n}class Fi extends us{}class Kn extends us{constructor(e){super(),this.elements=e}}function Zl(t,e){const n=tu(e);for(const i of t.elements)n.some(s=>Ye(s,i))||n.push(i);return{arrayValue:{values:n}}}class zn extends us{constructor(e){super(),this.elements=e}}function eu(t,e){let n=tu(e);for(const i of t.elements)n=n.filter(s=>!Ye(s,i));return{arrayValue:{values:n}}}class Pi extends us{constructor(e,n){super(),this.It=e,this.yt=n}}function Jo(t){return ae(t.integerValue||t.doubleValue)}function tu(t){return Lr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Ud(t,e){return t.field.isEqual(e.field)&&function(n,i){return n instanceof Kn&&i instanceof Kn||n instanceof zn&&i instanceof zn?tn(n.elements,i.elements,Ye):n instanceof Pi&&i instanceof Pi?Ye(n.yt,i.yt):n instanceof Fi&&i instanceof Fi}(t.transform,e.transform)}class Bd{constructor(e,n){this.version=e,this.transformResults=n}}class ze{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new ze}static exists(e){return new ze(void 0,e)}static updateTime(e){return new ze(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ii(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class cs{}function nu(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Fr(t.key,ze.none()):new si(t.key,t.data,ze.none());{const n=t.data,i=Pe.empty();let s=new ue(be.comparator);for(let r of e.fields)if(!s.has(r)){let o=n.field(r);o===null&&r.length>1&&(r=r.popLast(),o=n.field(r)),o===null?i.delete(r):i.set(r,o),s=s.add(r)}return new Mt(t.key,i,new Xe(s.toArray()),ze.none())}}function $d(t,e,n){t instanceof si?function(i,s,r){const o=i.value.clone(),a=ea(i.fieldTransforms,s,r.transformResults);o.setAll(a),s.convertToFoundDocument(r.version,o).setHasCommittedMutations()}(t,e,n):t instanceof Mt?function(i,s,r){if(!Ii(i.precondition,s))return void s.convertToUnknownDocument(r.version);const o=ea(i.fieldTransforms,s,r.transformResults),a=s.data;a.setAll(iu(i)),a.setAll(o),s.convertToFoundDocument(r.version,a).setHasCommittedMutations()}(t,e,n):function(i,s,r){s.convertToNoDocument(r.version).setHasCommittedMutations()}(0,e,n)}function _n(t,e,n,i){return t instanceof si?function(s,r,o,a){if(!Ii(s.precondition,r))return o;const l=s.value.clone(),u=ta(s.fieldTransforms,a,r);return l.setAll(u),r.convertToFoundDocument(r.version,l).setHasLocalMutations(),null}(t,e,n,i):t instanceof Mt?function(s,r,o,a){if(!Ii(s.precondition,r))return o;const l=ta(s.fieldTransforms,a,r),u=r.data;return u.setAll(iu(s)),u.setAll(l),r.convertToFoundDocument(r.version,u).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(c=>c.field))}(t,e,n,i):function(s,r,o){return Ii(s.precondition,r)?(r.convertToNoDocument(r.version).setHasLocalMutations(),null):o}(t,e,n)}function jd(t,e){let n=null;for(const i of t.fieldTransforms){const s=e.data.field(i.field),r=Jl(i.transform,s||null);r!=null&&(n===null&&(n=Pe.empty()),n.set(i.field,r))}return n||null}function Zo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&tn(n,i,(s,r)=>Ud(s,r))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class si extends cs{constructor(e,n,i,s=[]){super(),this.key=e,this.value=n,this.precondition=i,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Mt extends cs{constructor(e,n,i,s,r=[]){super(),this.key=e,this.data=n,this.fieldMask=i,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function iu(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}}),e}function ea(t,e,n){const i=new Map;ee(t.length===n.length);for(let s=0;s<n.length;s++){const r=t[s],o=r.transform,a=e.data.field(r.field);i.set(r.field,Pd(o,a,n[s]))}return i}function ta(t,e,n){const i=new Map;for(const s of t){const r=s.transform,o=n.data.field(s.field);i.set(s.field,Fd(r,o,e))}return i}class Fr extends cs{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Kd extends cs{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zd{constructor(e){this.count=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oe,H;function Hd(t){switch(t){default:return q();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function su(t){if(t===void 0)return at("GRPC error has no .code"),g.UNKNOWN;switch(t){case oe.OK:return g.OK;case oe.CANCELLED:return g.CANCELLED;case oe.UNKNOWN:return g.UNKNOWN;case oe.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case oe.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case oe.INTERNAL:return g.INTERNAL;case oe.UNAVAILABLE:return g.UNAVAILABLE;case oe.UNAUTHENTICATED:return g.UNAUTHENTICATED;case oe.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case oe.NOT_FOUND:return g.NOT_FOUND;case oe.ALREADY_EXISTS:return g.ALREADY_EXISTS;case oe.PERMISSION_DENIED:return g.PERMISSION_DENIED;case oe.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case oe.ABORTED:return g.ABORTED;case oe.OUT_OF_RANGE:return g.OUT_OF_RANGE;case oe.UNIMPLEMENTED:return g.UNIMPLEMENTED;case oe.DATA_LOSS:return g.DATA_LOSS;default:return q()}}(H=oe||(oe={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),i=this.inner[n];if(i!==void 0){for(const[s,r]of i)if(this.equalsFn(s,e))return r}}has(e){return this.get(e)!==void 0}set(e,n){const i=this.mapKeyFn(e),s=this.inner[i];if(s===void 0)return this.inner[i]=[[e,n]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return!1;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return i.length===1?delete this.inner[n]:i.splice(s,1),this.innerSize--,!0;return!1}forEach(e){dn(this.inner,(n,i)=>{for(const[s,r]of i)e(s,r)})}isEmpty(){return Pl(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qd=new ce(D.comparator);function ut(){return Qd}const ru=new ce(D.comparator);function In(...t){let e=ru;for(const n of t)e=e.insert(n.key,n);return e}function ou(t){let e=ru;return t.forEach((n,i)=>e=e.insert(n,i.overlayedDocument)),e}function xt(){return Nn()}function au(){return Nn()}function Nn(){return new fn(t=>t.toString(),(t,e)=>t.isEqual(e))}const Gd=new ce(D.comparator),Wd=new ue(D.comparator);function z(...t){let e=Wd;for(const n of t)e=e.add(n);return e}const Xd=new ue(W);function lu(){return Xd}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hs{constructor(e,n,i,s,r){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=i,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,n,i){const s=new Map;return s.set(e,ri.createSynthesizedTargetChangeForCurrentChange(e,n,i)),new hs(j.min(),s,lu(),ut(),z())}}class ri{constructor(e,n,i,s,r){this.resumeToken=e,this.current=n,this.addedDocuments=i,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,n,i){return new ri(i,n,z(),z(),z())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ci{constructor(e,n,i,s){this.Tt=e,this.removedTargetIds=n,this.key=i,this.Et=s}}class uu{constructor(e,n){this.targetId=e,this.At=n}}class cu{constructor(e,n,i=ke.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=i,this.cause=s}}class na{constructor(){this.Rt=0,this.bt=sa(),this.Pt=ke.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}get current(){return this.vt}get resumeToken(){return this.Pt}get St(){return this.Rt!==0}get Dt(){return this.Vt}Ct(e){e.approximateByteSize()>0&&(this.Vt=!0,this.Pt=e)}xt(){let e=z(),n=z(),i=z();return this.bt.forEach((s,r)=>{switch(r){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:i=i.add(s);break;default:q()}}),new ri(this.Pt,this.vt,e,n,i)}Nt(){this.Vt=!1,this.bt=sa()}kt(e,n){this.Vt=!0,this.bt=this.bt.insert(e,n)}Ot(e){this.Vt=!0,this.bt=this.bt.remove(e)}Mt(){this.Rt+=1}Ft(){this.Rt-=1}$t(){this.Vt=!0,this.vt=!0}}class Yd{constructor(e){this.Bt=e,this.Lt=new Map,this.Ut=ut(),this.qt=ia(),this.Kt=new ue(W)}Gt(e){for(const n of e.Tt)e.Et&&e.Et.isFoundDocument()?this.Qt(n,e.Et):this.jt(n,e.key,e.Et);for(const n of e.removedTargetIds)this.jt(n,e.key,e.Et)}Wt(e){this.forEachTarget(e,n=>{const i=this.zt(n);switch(e.state){case 0:this.Ht(n)&&i.Ct(e.resumeToken);break;case 1:i.Ft(),i.St||i.Nt(),i.Ct(e.resumeToken);break;case 2:i.Ft(),i.St||this.removeTarget(n);break;case 3:this.Ht(n)&&(i.$t(),i.Ct(e.resumeToken));break;case 4:this.Ht(n)&&(this.Jt(n),i.Ct(e.resumeToken));break;default:q()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Lt.forEach((i,s)=>{this.Ht(s)&&n(s)})}Yt(e){const n=e.targetId,i=e.At.count,s=this.Xt(n);if(s){const r=s.target;if(Js(r))if(i===0){const o=new D(r.path);this.jt(n,o,ve.newNoDocument(o,j.min()))}else ee(i===1);else this.Zt(n)!==i&&(this.Jt(n),this.Kt=this.Kt.add(n))}}te(e){const n=new Map;this.Lt.forEach((r,o)=>{const a=this.Xt(o);if(a){if(r.current&&Js(a.target)){const l=new D(a.target.path);this.Ut.get(l)!==null||this.ee(o,l)||this.jt(o,l,ve.newNoDocument(l,e))}r.Dt&&(n.set(o,r.xt()),r.Nt())}});let i=z();this.qt.forEach((r,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.Xt(l);return!u||u.purpose===2||(a=!1,!1)}),a&&(i=i.add(r))}),this.Ut.forEach((r,o)=>o.setReadTime(e));const s=new hs(e,n,this.Kt,this.Ut,i);return this.Ut=ut(),this.qt=ia(),this.Kt=new ue(W),s}Qt(e,n){if(!this.Ht(e))return;const i=this.ee(e,n.key)?2:0;this.zt(e).kt(n.key,i),this.Ut=this.Ut.insert(n.key,n),this.qt=this.qt.insert(n.key,this.ne(n.key).add(e))}jt(e,n,i){if(!this.Ht(e))return;const s=this.zt(e);this.ee(e,n)?s.kt(n,1):s.Ot(n),this.qt=this.qt.insert(n,this.ne(n).delete(e)),i&&(this.Ut=this.Ut.insert(n,i))}removeTarget(e){this.Lt.delete(e)}Zt(e){const n=this.zt(e).xt();return this.Bt.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Mt(e){this.zt(e).Mt()}zt(e){let n=this.Lt.get(e);return n||(n=new na,this.Lt.set(e,n)),n}ne(e){let n=this.qt.get(e);return n||(n=new ue(W),this.qt=this.qt.insert(e,n)),n}Ht(e){const n=this.Xt(e)!==null;return n||x("WatchChangeAggregator","Detected inactive target",e),n}Xt(e){const n=this.Lt.get(e);return n&&n.St?null:this.Bt.se(e)}Jt(e){this.Lt.set(e,new na),this.Bt.getRemoteKeysForTarget(e).forEach(n=>{this.jt(e,n,null)})}ee(e,n){return this.Bt.getRemoteKeysForTarget(e).has(n)}}function ia(){return new ce(D.comparator)}function sa(){return new ce(D.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jd=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),Zd=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))();class ef{constructor(e,n){this.databaseId=e,this.gt=n}}function Ui(t,e){return t.gt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function hu(t,e){return t.gt?e.toBase64():e.toUint8Array()}function tf(t,e){return Ui(t,e.toTimestamp())}function rt(t){return ee(!!t),j.fromTimestamp(function(e){const n=mt(e);return new le(n.seconds,n.nanos)}(t))}function Pr(t,e){return function(n){return new te(["projects",n.projectId,"databases",n.database])}(t).child("documents").child(e).canonicalString()}function du(t){const e=te.fromString(t);return ee(gu(e)),e}function tr(t,e){return Pr(t.databaseId,e.path)}function Rs(t,e){const n=du(e);if(n.get(1)!==t.databaseId.projectId)throw new C(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new C(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new D(fu(n))}function nr(t,e){return Pr(t.databaseId,e)}function nf(t){const e=du(t);return e.length===4?te.emptyPath():fu(e)}function ir(t){return new te(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function fu(t){return ee(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function ra(t,e,n){return{name:tr(t,e),fields:n.value.mapValue.fields}}function sf(t,e){let n;if("targetChange"in e){e.targetChange;const i=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:q()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],r=function(l,u){return l.gt?(ee(u===void 0||typeof u=="string"),ke.fromBase64String(u||"")):(ee(u===void 0||u instanceof Uint8Array),ke.fromUint8Array(u||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const u=l.code===void 0?g.UNKNOWN:su(l.code);return new C(u,l.message||"")}(o);n=new cu(i,s,r,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const s=Rs(t,i.document.name),r=rt(i.document.updateTime),o=new Pe({mapValue:{fields:i.document.fields}}),a=ve.newFoundDocument(s,r,o),l=i.targetIds||[],u=i.removedTargetIds||[];n=new Ci(l,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const s=Rs(t,i.document),r=i.readTime?rt(i.readTime):j.min(),o=ve.newNoDocument(s,r),a=i.removedTargetIds||[];n=new Ci([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const s=Rs(t,i.document),r=i.removedTargetIds||[];n=new Ci([],r,s,null)}else{if(!("filter"in e))return q();{e.filter;const i=e.filter;i.targetId;const s=i.count||0,r=new zd(s),o=i.targetId;n=new uu(o,r)}}return n}function rf(t,e){let n;if(e instanceof si)n={update:ra(t,e.key,e.value)};else if(e instanceof Fr)n={delete:tr(t,e.key)};else if(e instanceof Mt)n={update:ra(t,e.key,e.data),updateMask:gf(e.fieldMask)};else{if(!(e instanceof Kd))return q();n={verify:tr(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(i=>function(s,r){const o=r.transform;if(o instanceof Fi)return{fieldPath:r.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Kn)return{fieldPath:r.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof zn)return{fieldPath:r.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Pi)return{fieldPath:r.field.canonicalString(),increment:o.yt};throw q()}(0,i))),e.precondition.isNone||(n.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:tf(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:q()}(t,e.precondition)),n}function of(t,e){return t&&t.length>0?(ee(e!==void 0),t.map(n=>function(i,s){let r=i.updateTime?rt(i.updateTime):rt(s);return r.isEqual(j.min())&&(r=rt(s)),new Bd(r,i.transformResults||[])}(n,e))):[]}function af(t,e){return{documents:[nr(t,e.path)]}}function lf(t,e){const n={structuredQuery:{}},i=e.path;e.collectionGroup!==null?(n.parent=nr(t,i),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=nr(t,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(l){if(l.length===0)return;const u=l.map(c=>function(d){if(d.op==="=="){if(Qo(d.value))return{unaryFilter:{field:Ht(d.field),op:"IS_NAN"}};if(Ho(d.value))return{unaryFilter:{field:Ht(d.field),op:"IS_NULL"}}}else if(d.op==="!="){if(Qo(d.value))return{unaryFilter:{field:Ht(d.field),op:"IS_NOT_NAN"}};if(Ho(d.value))return{unaryFilter:{field:Ht(d.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ht(d.field),op:df(d.op),value:d.value}}}(c));return u.length===1?u[0]:{compositeFilter:{op:"AND",filters:u}}}(e.filters);s&&(n.structuredQuery.where=s);const r=function(l){if(l.length!==0)return l.map(u=>function(c){return{field:Ht(c.field),direction:hf(c.dir)}}(u))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(l,u){return l.gt||as(u)?u:{value:u}}(t,e.limit);var a;return o!==null&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),n}function uf(t){let e=nf(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){ee(i===1);const c=n.from[0];c.allDescendants?s=c.collectionId:e=e.child(c.collectionId)}let r=[];n.where&&(r=mu(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(c=>function(d){return new Dn(Gt(d.field),function(m){switch(m){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(d.direction))}(c)));let a=null;n.limit&&(a=function(c){let d;return d=typeof c=="object"?c.value:c,as(d)?null:d}(n.limit));let l=null;n.startAt&&(l=function(c){const d=!!c.before,m=c.values||[];return new qi(m,d)}(n.startAt));let u=null;return n.endAt&&(u=function(c){const d=!c.before,m=c.values||[];return new qi(m,d)}(n.endAt)),Ld(e,s,o,r,a,"F",l,u)}function cf(t,e){const n=function(i,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return q()}}(0,e.purpose);return n==null?null:{"goog-listen-tags":n}}function mu(t){return t?t.unaryFilter!==void 0?[mf(t)]:t.fieldFilter!==void 0?[ff(t)]:t.compositeFilter!==void 0?t.compositeFilter.filters.map(e=>mu(e)).reduce((e,n)=>e.concat(n)):q():[]}function hf(t){return Jd[t]}function df(t){return Zd[t]}function Ht(t){return{fieldPath:t.canonicalString()}}function Gt(t){return be.fromServerFormat(t.fieldPath)}function ff(t){return _e.create(Gt(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return q()}}(t.fieldFilter.op),t.fieldFilter.value)}function mf(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Gt(t.unaryFilter.field);return _e.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Gt(t.unaryFilter.field);return _e.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Gt(t.unaryFilter.field);return _e.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Gt(t.unaryFilter.field);return _e.create(s,"!=",{nullValue:"NULL_VALUE"});default:return q()}}function gf(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function gu(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e,n,i,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=i,this.mutations=s}applyToRemoteDocument(e,n){const i=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const r=this.mutations[s];r.key.isEqual(e.key)&&$d(r,e,i[s])}}applyToLocalView(e,n){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(n=_n(i,e,n,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(n=_n(i,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const i=au();return this.mutations.forEach(s=>{const r=e.get(s.key),o=r.overlayedDocument;let a=this.applyToLocalView(o,r.mutatedFields);a=n.has(s.key)?null:a;const l=nu(o,a);l!==null&&i.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(j.min())}),i}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),z())}isEqual(e){return this.batchId===e.batchId&&tn(this.mutations,e.mutations,(n,i)=>Zo(n,i))&&tn(this.baseMutations,e.baseMutations,(n,i)=>Zo(n,i))}}class Ur{constructor(e,n,i,s){this.batch=e,this.commitVersion=n,this.mutationResults=i,this.docVersions=s}static from(e,n,i){ee(e.mutations.length===i.length);let s=Gd;const r=e.mutations;for(let o=0;o<r.length;o++)s=s.insert(r[o].key,i[o].version);return new Ur(e,n,i,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e,n,i,s,r=j.min(),o=j.min(),a=ke.EMPTY_BYTE_STRING){this.target=e,this.targetId=n,this.purpose=i,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new _t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,n){return new _t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new _t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf{constructor(e){this.re=e}}function wf(t){const e=uf({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Zs(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(){this.Ye=new Tf}addToCollectionParentIndex(e,n){return this.Ye.add(n),v.resolve()}getCollectionParents(e,n){return v.resolve(this.Ye.getEntries(n))}addFieldIndex(e,n){return v.resolve()}deleteFieldIndex(e,n){return v.resolve()}getDocumentsMatchingTarget(e,n){return v.resolve(null)}getIndexType(e,n){return v.resolve(0)}getFieldIndexes(e,n){return v.resolve([])}getNextCollectionGroupToUpdate(e){return v.resolve(null)}getMinOffset(e,n){return v.resolve(ft.min())}getMinOffsetFromCollectionGroup(e,n){return v.resolve(ft.min())}updateCollectionGroup(e,n,i){return v.resolve()}updateIndexEntries(e,n){return v.resolve()}}class Tf{constructor(){this.index={}}add(e){const n=e.lastSegment(),i=e.popLast(),s=this.index[n]||new ue(te.comparator),r=!s.has(i);return this.index[n]=s.add(i),r}has(e){const n=e.lastSegment(),i=e.popLast(),s=this.index[n];return s&&s.has(i)}getEntries(e){return(this.index[e]||new ue(te.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new rn(0)}static vn(){return new rn(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ef{constructor(){this.changes=new fn(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,ve.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const i=this.changes.get(n);return i!==void 0?v.resolve(i):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bf{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If{constructor(e,n,i,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=i,this.indexManager=s}getDocument(e,n){let i=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(i=s,this.getBaseDocument(e,n,i))).next(s=>(i!==null&&_n(i.mutation,s,Xe.empty(),le.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(i=>this.getLocalViewOfDocuments(e,i,z()).next(()=>i))}getLocalViewOfDocuments(e,n,i=z()){const s=xt();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,i).next(r=>{let o=In();return r.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const i=xt();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,z()))}populateOverlays(e,n,i){const s=[];return i.forEach(r=>{n.has(r)||s.push(r)}),this.documentOverlayCache.getOverlays(e,s).next(r=>{r.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,i,s){let r=ut();const o=Nn(),a=Nn();return n.forEach((l,u)=>{const c=i.get(u.key);s.has(u.key)&&(c===void 0||c.mutation instanceof Mt)?r=r.insert(u.key,u):c!==void 0&&(o.set(u.key,c.mutation.getFieldMask()),_n(c.mutation,u,c.mutation.getFieldMask(),le.now()))}),this.recalculateAndSaveOverlays(e,r).next(l=>(l.forEach((u,c)=>o.set(u,c)),n.forEach((u,c)=>{var d;return a.set(u,new bf(c,(d=o.get(u))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,n){const i=Nn();let s=new ce((o,a)=>o-a),r=z();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=n.get(l);if(u===null)return;let c=i.get(l)||Xe.empty();c=a.applyToLocalView(u,c),i.set(l,c);const d=(s.get(a.batchId)||z()).add(l);s=s.insert(a.batchId,d)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,c=l.value,d=au();c.forEach(m=>{if(!r.has(m)){const f=nu(n.get(m),i.get(m));f!==null&&d.set(m,f),r=r.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,d))}return v.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,n,i){return function(s){return D.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):Ql(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,i):this.getDocumentsMatchingCollectionQuery(e,n,i)}getNextDocuments(e,n,i,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,i,s).next(r=>{const o=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,i.largestBatchId,s-r.size):v.resolve(xt());let a=-1,l=r;return o.next(u=>v.forEach(u,(c,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),r.get(c)?v.resolve():this.getBaseDocument(e,c,d).next(m=>{l=l.insert(c,m)}))).next(()=>this.populateOverlays(e,u,r)).next(()=>this.computeViews(e,l,u,z())).next(c=>({batchId:a,changes:ou(c)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new D(n)).next(i=>{let s=In();return i.isFoundDocument()&&(s=s.insert(i.key,i)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,i){const s=n.collectionGroup;let r=In();return this.indexManager.getCollectionParents(e,s).next(o=>v.forEach(o,a=>{const l=function(u,c){return new ii(c,null,u.explicitOrderBy.slice(),u.filters.slice(),u.limit,u.limitType,u.startAt,u.endAt)}(n,a.child(s));return this.getDocumentsMatchingCollectionQuery(e,l,i).next(u=>{u.forEach((c,d)=>{r=r.insert(c,d)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(e,n,i){let s;return this.remoteDocumentCache.getAllFromCollection(e,n.path,i).next(r=>(s=r,this.documentOverlayCache.getOverlaysForCollection(e,n.path,i.largestBatchId))).next(r=>{r.forEach((a,l)=>{const u=l.getKey();s.get(u)===null&&(s=s.insert(u,ve.newInvalidDocument(u)))});let o=In();return s.forEach((a,l)=>{const u=r.get(a);u!==void 0&&_n(u.mutation,l,Xe.empty(),le.now()),qr(n,l)&&(o=o.insert(a,l))}),o})}getBaseDocument(e,n,i){return i===null||i.mutation.type===1?this.remoteDocumentCache.getEntry(e,n):v.resolve(ve.newInvalidDocument(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf{constructor(e){this.It=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,n){return v.resolve(this.Zn.get(n))}saveBundleMetadata(e,n){var i;return this.Zn.set(n.id,{id:(i=n).id,version:i.version,createTime:rt(i.createTime)}),v.resolve()}getNamedQuery(e,n){return v.resolve(this.ts.get(n))}saveNamedQuery(e,n){return this.ts.set(n.name,function(i){return{name:i.name,query:wf(i.bundledQuery),readTime:rt(i.readTime)}}(n)),v.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(){this.overlays=new ce(D.comparator),this.es=new Map}getOverlay(e,n){return v.resolve(this.overlays.get(n))}getOverlays(e,n){const i=xt();return v.forEach(n,s=>this.getOverlay(e,s).next(r=>{r!==null&&i.set(s,r)})).next(()=>i)}saveOverlays(e,n,i){return i.forEach((s,r)=>{this.ue(e,n,r)}),v.resolve()}removeOverlaysForBatchId(e,n,i){const s=this.es.get(i);return s!==void 0&&(s.forEach(r=>this.overlays=this.overlays.remove(r)),this.es.delete(i)),v.resolve()}getOverlaysForCollection(e,n,i){const s=xt(),r=n.length+1,o=new D(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===r&&l.largestBatchId>i&&s.set(l.getKey(),l)}return v.resolve(s)}getOverlaysForCollectionGroup(e,n,i,s){let r=new ce((u,c)=>u-c);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>i){let c=r.get(u.largestBatchId);c===null&&(c=xt(),r=r.insert(u.largestBatchId,c)),c.set(u.getKey(),u)}}const a=xt(),l=r.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,c)=>a.set(u,c)),!(a.size()>=s)););return v.resolve(a)}ue(e,n,i){const s=this.overlays.get(i.key);if(s!==null){const o=this.es.get(s.largestBatchId).delete(i.key);this.es.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new vf(n,i));let r=this.es.get(n);r===void 0&&(r=z(),this.es.set(n,r)),this.es.set(n,r.add(i.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br{constructor(){this.ns=new ue(de.ss),this.rs=new ue(de.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,n){const i=new de(e,n);this.ns=this.ns.add(i),this.rs=this.rs.add(i)}us(e,n){e.forEach(i=>this.addReference(i,n))}removeReference(e,n){this.cs(new de(e,n))}hs(e,n){e.forEach(i=>this.removeReference(i,n))}ls(e){const n=new D(new te([])),i=new de(n,e),s=new de(n,e+1),r=[];return this.rs.forEachInRange([i,s],o=>{this.cs(o),r.push(o.key)}),r}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const n=new D(new te([])),i=new de(n,e),s=new de(n,e+1);let r=z();return this.rs.forEachInRange([i,s],o=>{r=r.add(o.key)}),r}containsKey(e){const n=new de(e,0),i=this.ns.firstAfterOrEqual(n);return i!==null&&e.isEqual(i.key)}}class de{constructor(e,n){this.key=e,this._s=n}static ss(e,n){return D.comparator(e.key,n.key)||W(e._s,n._s)}static os(e,n){return W(e._s,n._s)||D.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.ws=1,this.gs=new ue(de.ss)}checkEmpty(e){return v.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,i,s){const r=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new pf(r,n,i,s);this.mutationQueue.push(o);for(const a of s)this.gs=this.gs.add(new de(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return v.resolve(o)}lookupMutationBatch(e,n){return v.resolve(this.ys(n))}getNextMutationBatchAfterBatchId(e,n){const i=n+1,s=this.ps(i),r=s<0?0:s;return v.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return v.resolve(this.mutationQueue.length===0?-1:this.ws-1)}getAllMutationBatches(e){return v.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const i=new de(n,0),s=new de(n,Number.POSITIVE_INFINITY),r=[];return this.gs.forEachInRange([i,s],o=>{const a=this.ys(o._s);r.push(a)}),v.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,n){let i=new ue(W);return n.forEach(s=>{const r=new de(s,0),o=new de(s,Number.POSITIVE_INFINITY);this.gs.forEachInRange([r,o],a=>{i=i.add(a._s)})}),v.resolve(this.Is(i))}getAllMutationBatchesAffectingQuery(e,n){const i=n.path,s=i.length+1;let r=i;D.isDocumentKey(r)||(r=r.child(""));const o=new de(new D(r),0);let a=new ue(W);return this.gs.forEachWhile(l=>{const u=l.key.path;return!!i.isPrefixOf(u)&&(u.length===s&&(a=a.add(l._s)),!0)},o),v.resolve(this.Is(a))}Is(e){const n=[];return e.forEach(i=>{const s=this.ys(i);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){ee(this.Ts(n.batchId,"removed")===0),this.mutationQueue.shift();let i=this.gs;return v.forEach(n.mutations,s=>{const r=new de(s.key,n.batchId);return i=i.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.gs=i})}An(e){}containsKey(e,n){const i=new de(n,0),s=this.gs.firstAfterOrEqual(i);return v.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,v.resolve()}Ts(e,n){return this.ps(e)}ps(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ys(e){const n=this.ps(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(e){this.Es=e,this.docs=new ce(D.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const i=n.key,s=this.docs.get(i),r=s?s.size:0,o=this.Es(n);return this.docs=this.docs.insert(i,{document:n.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const i=this.docs.get(n);return v.resolve(i?i.document.mutableCopy():ve.newInvalidDocument(n))}getEntries(e,n){let i=ut();return n.forEach(s=>{const r=this.docs.get(s);i=i.insert(s,r?r.document.mutableCopy():ve.newInvalidDocument(s))}),v.resolve(i)}getAllFromCollection(e,n,i){let s=ut();const r=new D(n.child("")),o=this.docs.getIteratorFrom(r);for(;o.hasNext();){const{key:a,value:{document:l}}=o.getNext();if(!n.isPrefixOf(a.path))break;a.path.length>n.length+1||vd(pd(l),i)<=0||(s=s.insert(l.key,l.mutableCopy()))}return v.resolve(s)}getAllFromCollectionGroup(e,n,i,s){q()}As(e,n){return v.forEach(this.docs,i=>n(i))}newChangeBuffer(e){return new Df(this)}getSize(e){return v.resolve(this.size)}}class Df extends Ef{constructor(e){super(),this.Yn=e}applyChanges(e){const n=[];return this.changes.forEach((i,s)=>{s.isValidDocument()?n.push(this.Yn.addEntry(e,s)):this.Yn.removeEntry(i)}),v.waitFor(n)}getFromCache(e,n){return this.Yn.getEntry(e,n)}getAllFromCache(e,n){return this.Yn.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(e){this.persistence=e,this.Rs=new fn(n=>Mr(n),Or),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Br,this.targetCount=0,this.vs=rn.Pn()}forEachTarget(e,n){return this.Rs.forEach((i,s)=>n(s)),v.resolve()}getLastRemoteSnapshotVersion(e){return v.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return v.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),v.resolve(this.highestTargetId)}setTargetsMetadata(e,n,i){return i&&(this.lastRemoteSnapshotVersion=i),n>this.bs&&(this.bs=n),v.resolve()}Dn(e){this.Rs.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.vs=new rn(n),this.highestTargetId=n),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,n){return this.Dn(n),this.targetCount+=1,v.resolve()}updateTargetData(e,n){return this.Dn(n),v.resolve()}removeTargetData(e,n){return this.Rs.delete(n.target),this.Ps.ls(n.targetId),this.targetCount-=1,v.resolve()}removeTargets(e,n,i){let s=0;const r=[];return this.Rs.forEach((o,a)=>{a.sequenceNumber<=n&&i.get(a.targetId)===null&&(this.Rs.delete(o),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),v.waitFor(r).next(()=>s)}getTargetCount(e){return v.resolve(this.targetCount)}getTargetData(e,n){const i=this.Rs.get(n)||null;return v.resolve(i)}addMatchingKeys(e,n,i){return this.Ps.us(n,i),v.resolve()}removeMatchingKeys(e,n,i){this.Ps.hs(n,i);const s=this.persistence.referenceDelegate,r=[];return s&&n.forEach(o=>{r.push(s.markPotentiallyOrphaned(e,o))}),v.waitFor(r)}removeMatchingKeysForTargetId(e,n){return this.Ps.ls(n),v.resolve()}getMatchingKeysForTargetId(e,n){const i=this.Ps.ds(n);return v.resolve(i)}containsKey(e,n){return v.resolve(this.Ps.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf{constructor(e,n){this.Vs={},this.overlays={},this.Ss=new Rr(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new _f(this),this.indexManager=new Sf,this.remoteDocumentCache=function(i){return new xf(i)}(i=>this.referenceDelegate.xs(i)),this.It=new yf(n),this.Ns=new Cf(this.It)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new kf,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let i=this.Vs[e.toKey()];return i||(i=new Af(n,this.referenceDelegate),this.Vs[e.toKey()]=i),i}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,n,i){x("MemoryPersistence","Starting transaction:",e);const s=new Vf(this.Ss.next());return this.referenceDelegate.ks(),i(s).next(r=>this.referenceDelegate.Os(s).next(()=>r)).toPromise().then(r=>(s.raiseOnCommittedEvent(),r))}Ms(e,n){return v.or(Object.values(this.Vs).map(i=>()=>i.containsKey(e,n)))}}class Vf extends wd{constructor(e){super(),this.currentSequenceNumber=e}}class $r{constructor(e){this.persistence=e,this.Fs=new Br,this.$s=null}static Bs(e){return new $r(e)}get Ls(){if(this.$s)return this.$s;throw q()}addReference(e,n,i){return this.Fs.addReference(i,n),this.Ls.delete(i.toString()),v.resolve()}removeReference(e,n,i){return this.Fs.removeReference(i,n),this.Ls.add(i.toString()),v.resolve()}markPotentiallyOrphaned(e,n){return this.Ls.add(n.toString()),v.resolve()}removeTarget(e,n){this.Fs.ls(n.targetId).forEach(s=>this.Ls.add(s.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(r=>this.Ls.add(r.toString()))}).next(()=>i.removeTargetData(e,n))}ks(){this.$s=new Set}Os(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return v.forEach(this.Ls,i=>{const s=D.fromPath(i);return this.Us(e,s).next(r=>{r||n.removeEntry(s,j.min())})}).next(()=>(this.$s=null,n.apply(e)))}updateLimboDocument(e,n){return this.Us(e,n).next(i=>{i?this.Ls.delete(n.toString()):this.Ls.add(n.toString())})}xs(e){return 0}Us(e,n){return v.or([()=>v.resolve(this.Fs.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ms(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(e,n,i,s){this.targetId=e,this.fromCache=n,this.Si=i,this.Di=s}static Ci(e,n){let i=z(),s=z();for(const r of n.docChanges)switch(r.type){case 0:i=i.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new jr(e,n.fromCache,i,s)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{constructor(){this.xi=!1}initialize(e,n){this.Ni=e,this.indexManager=n,this.xi=!0}getDocumentsMatchingQuery(e,n,i,s){return this.ki(e,n).next(r=>r||this.Oi(e,n,s,i)).next(r=>r||this.Mi(e,n))}ki(e,n){if(Yo(n))return v.resolve(null);let i=lt(n);return this.indexManager.getIndexType(e,i).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=Zs(n,null,"F"),i=lt(n)),this.indexManager.getDocumentsMatchingTarget(e,i).next(r=>{const o=z(...r);return this.Ni.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(l=>{const u=this.Fi(n,a);return this.$i(n,u,o,l.readTime)?this.ki(e,Zs(n,null,"F")):this.Bi(e,u,n,l)}))})))}Oi(e,n,i,s){return Yo(n)||s.isEqual(j.min())?this.Mi(e,n):this.Ni.getDocuments(e,i).next(r=>{const o=this.Fi(n,r);return this.$i(n,o,i,s)?this.Mi(e,n):(Bo()<=Vn.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),er(n)),this.Bi(e,o,n,gd(s,-1)))})}Fi(e,n){let i=new ue(Wl(e));return n.forEach((s,r)=>{qr(e,r)&&(i=i.add(r))}),i}$i(e,n,i,s){if(e.limit===null)return!1;if(i.size!==n.size)return!0;const r=e.limitType==="F"?n.last():n.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Mi(e,n){return Bo()<=Vn.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",er(n)),this.Ni.getDocumentsMatchingQuery(e,n,ft.min())}Bi(e,n,i,s){return this.Ni.getDocumentsMatchingQuery(e,i,s).next(r=>(n.forEach(o=>{r=r.insert(o.key,o)}),r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{constructor(e,n,i,s){this.persistence=e,this.Li=n,this.It=s,this.Ui=new ce(W),this.qi=new fn(r=>Mr(r),Or),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(i)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new If(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ui))}}function Mf(t,e,n,i){return new Lf(t,e,n,i)}async function pu(t,e){const n=F(t);return await n.persistence.runTransaction("Handle user change","readonly",i=>{let s;return n.mutationQueue.getAllMutationBatches(i).next(r=>(s=r,n.Qi(e),n.mutationQueue.getAllMutationBatches(i))).next(r=>{const o=[],a=[];let l=z();for(const u of s){o.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}for(const u of r){a.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}return n.localDocuments.getDocuments(i,l).next(u=>({ji:u,removedBatchIds:o,addedBatchIds:a}))})})}function Of(t,e){const n=F(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const s=e.batch.keys(),r=n.Gi.newChangeBuffer({trackRemovals:!0});return function(o,a,l,u){const c=l.batch,d=c.keys();let m=v.resolve();return d.forEach(f=>{m=m.next(()=>u.getEntry(a,f)).next(y=>{const p=l.docVersions.get(f);ee(p!==null),y.version.compareTo(p)<0&&(c.applyToRemoteDocument(y,l),y.isValidDocument()&&(y.setReadTime(l.commitVersion),u.addEntry(y)))})}),m.next(()=>o.mutationQueue.removeMutationBatch(a,c))}(n,i,e,r).next(()=>r.apply(i)).next(()=>n.mutationQueue.performConsistencyCheck(i)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(i,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(o){let a=z();for(let l=0;l<o.mutationResults.length;++l)o.mutationResults[l].transformResults.length>0&&(a=a.add(o.batch.mutations[l].key));return a}(e))).next(()=>n.localDocuments.getDocuments(i,s))})}function vu(t){const e=F(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Cs.getLastRemoteSnapshotVersion(n))}function qf(t,e){const n=F(t),i=e.snapshotVersion;let s=n.Ui;return n.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{const o=n.Gi.newChangeBuffer({trackRemovals:!0});s=n.Ui;const a=[];e.targetChanges.forEach((c,d)=>{const m=s.get(d);if(!m)return;a.push(n.Cs.removeMatchingKeys(r,c.removedDocuments,d).next(()=>n.Cs.addMatchingKeys(r,c.addedDocuments,d)));let f=m.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.has(d)?f=f.withResumeToken(ke.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):c.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(c.resumeToken,i)),s=s.insert(d,f),function(y,p,w){return y.resumeToken.approximateByteSize()===0||p.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=3e8?!0:w.addedDocuments.size+w.modifiedDocuments.size+w.removedDocuments.size>0}(m,f,c)&&a.push(n.Cs.updateTargetData(r,f))});let l=ut(),u=z();if(e.documentUpdates.forEach(c=>{e.resolvedLimboDocuments.has(c)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(r,c))}),a.push(Ff(r,o,e.documentUpdates).next(c=>{l=c.Wi,u=c.zi})),!i.isEqual(j.min())){const c=n.Cs.getLastRemoteSnapshotVersion(r).next(d=>n.Cs.setTargetsMetadata(r,r.currentSequenceNumber,i));a.push(c)}return v.waitFor(a).next(()=>o.apply(r)).next(()=>n.localDocuments.getLocalViewOfDocuments(r,l,u)).next(()=>l)}).then(r=>(n.Ui=s,r))}function Ff(t,e,n){let i=z(),s=z();return n.forEach(r=>i=i.add(r)),e.getEntries(t,i).next(r=>{let o=ut();return n.forEach((a,l)=>{const u=r.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(j.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):x("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{Wi:o,zi:s}})}function Pf(t,e){const n=F(t);return n.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function Uf(t,e){const n=F(t);return n.persistence.runTransaction("Allocate target","readwrite",i=>{let s;return n.Cs.getTargetData(i,e).next(r=>r?(s=r,v.resolve(s)):n.Cs.allocateTargetId(i).next(o=>(s=new _t(e,o,0,i.currentSequenceNumber),n.Cs.addTargetData(i,s).next(()=>s))))}).then(i=>{const s=n.Ui.get(i.targetId);return(s===null||i.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ui=n.Ui.insert(i.targetId,i),n.qi.set(e,i.targetId)),i})}async function sr(t,e,n){const i=F(t),s=i.Ui.get(e),r=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",r,o=>i.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!ni(o))throw o;x("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}i.Ui=i.Ui.remove(e),i.qi.delete(s.target)}function oa(t,e,n){const i=F(t);let s=j.min(),r=z();return i.persistence.runTransaction("Execute query","readonly",o=>function(a,l,u){const c=F(a),d=c.qi.get(u);return d!==void 0?v.resolve(c.Ui.get(d)):c.Cs.getTargetData(l,u)}(i,o,lt(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,i.Cs.getMatchingKeysForTargetId(o,a.targetId).next(l=>{r=l})}).next(()=>i.Li.getDocumentsMatchingQuery(o,e,n?s:j.min(),n?r:z())).next(a=>(Bf(i,Md(e),a),{documents:a,Hi:r})))}function Bf(t,e,n){let i=t.Ki.get(e)||j.min();n.forEach((s,r)=>{r.readTime.compareTo(i)>0&&(i=r.readTime)}),t.Ki.set(e,i)}class aa{constructor(){this.activeTargetIds=lu()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class $f{constructor(){this.Lr=new aa,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,i){}addLocalQueryTarget(e){return this.Lr.er(e),this.Ur[e]||"not-current"}updateQueryState(e,n,i){this.Ur[e]=n}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.Ur[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new aa,Promise.resolve()}handleUserChange(e,n,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf{qr(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}qr(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){x("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){x("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http";this.oo=n+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,n,i,s,r){const o=this.ho(e,n);x("RestConnection","Sending: ",o,i);const a={};return this.lo(a,s,r),this.fo(e,o,a,i).then(l=>(x("RestConnection","Received: ",l),l),l=>{throw Ws("RestConnection",`${e} failed with error: `,l,"url: ",o,"request:",i),l})}_o(e,n,i,s,r,o){return this.ao(e,n,i,s,r)}lo(e,n,i){e["X-Goog-Api-Client"]="gl-js/ fire/"+hn,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,r)=>e[r]=s),i&&i.headers.forEach((s,r)=>e[r]=s)}ho(e,n){const i=Kf[e];return`${this.oo}/v1/${n}:${i}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,n,i,s){return new Promise((r,o)=>{const a=new rd;a.setWithCredentials(!0),a.listenOnce(nd.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Vs.NO_ERROR:const u=a.getResponseJson();x("Connection","XHR received:",JSON.stringify(u)),r(u);break;case Vs.TIMEOUT:x("Connection",'RPC "'+e+'" timed out'),o(new C(g.DEADLINE_EXCEEDED,"Request time out"));break;case Vs.HTTP_ERROR:const c=a.getStatus();if(x("Connection",'RPC "'+e+'" failed with status:',c,"response text:",a.getResponseText()),c>0){const d=a.getResponseJson().error;if(d&&d.status&&d.message){const m=function(f){const y=f.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(y)>=0?y:g.UNKNOWN}(d.status);o(new C(m,d.message))}else o(new C(g.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new C(g.UNAVAILABLE,"Connection failed."));break;default:q()}}finally{x("Connection",'RPC "'+e+'" completed.')}});const l=JSON.stringify(s);a.send(n,"POST",l,i,15)})}wo(e,n,i){const s=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=ed(),o=td(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new sd({})),this.lo(a.initMessageHeaders,n,i),a.encodeInitMessageHeaders=!0;const l=s.join("");x("Connection","Creating WebChannel: "+l,a);const u=r.createWebChannel(l,a);let c=!1,d=!1;const m=new zf({Hr:y=>{d?x("Connection","Not sending because WebChannel is closed:",y):(c||(x("Connection","Opening WebChannel transport."),u.open(),c=!0),x("Connection","WebChannel sending:",y),u.send(y))},Jr:()=>u.close()}),f=(y,p,w)=>{y.listen(p,R=>{try{w(R)}catch(N){setTimeout(()=>{throw N},0)}})};return f(u,yi.EventType.OPEN,()=>{d||x("Connection","WebChannel transport opened.")}),f(u,yi.EventType.CLOSE,()=>{d||(d=!0,x("Connection","WebChannel transport closed"),m.io())}),f(u,yi.EventType.ERROR,y=>{d||(d=!0,Ws("Connection","WebChannel transport errored:",y),m.io(new C(g.UNAVAILABLE,"The operation could not be completed")))}),f(u,yi.EventType.MESSAGE,y=>{var p;if(!d){const w=y.data[0];ee(!!w);const R=w,N=R.error||((p=R[0])===null||p===void 0?void 0:p.error);if(N){x("Connection","WebChannel received error:",N);const _=N.status;let M=function(Se){const Ve=oe[Se];if(Ve!==void 0)return su(Ve)}(_),B=N.message;M===void 0&&(M=g.INTERNAL,B="Unknown error status: "+_+" with message "+N.message),d=!0,m.io(new C(M,B)),u.close()}else x("Connection","WebChannel received:",w),m.ro(w)}}),f(o,id.STAT_EVENT,y=>{y.stat===Po.PROXY?x("Connection","Detected buffering proxy"):y.stat===Po.NOPROXY&&x("Connection","Detected no buffering proxy")}),setTimeout(()=>{m.so()},0),m}}function Ls(){return typeof document!="undefined"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ds(t){return new ef(t,!0)}class yu{constructor(e,n,i=1e3,s=1.5,r=6e4){this.Hs=e,this.timerId=n,this.mo=i,this.yo=s,this.po=r,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const n=Math.floor(this.Io+this.bo()),i=Math.max(0,Date.now()-this.Eo),s=Math.max(0,n-i);s>0&&x("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Io} ms, delay with jitter: ${n} ms, last attempt: ${i} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,s,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){this.To!==null&&(this.To.skipDelay(),this.To=null)}cancel(){this.To!==null&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu{constructor(e,n,i,s,r,o,a,l){this.Hs=e,this.vo=i,this.Vo=s,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new yu(e,n)}No(){return this.state===1||this.state===5||this.ko()}ko(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&this.Do===null&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,n){this.Lo(),this.Uo(),this.xo.cancel(),this.So++,e!==4?this.xo.reset():n&&n.code===g.RESOURCE_EXHAUSTED?(at(n.toString()),at("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):n&&n.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.qo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(n)}qo(){}auth(){this.state=1;const e=this.Ko(this.So),n=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,s])=>{this.So===n&&this.Go(i,s)},i=>{e(()=>{const s=new C(g.UNKNOWN,"Fetching auth token failed: "+i.message);return this.Qo(s)})})}Go(e,n){const i=this.Ko(this.So);this.stream=this.jo(e,n),this.stream.Yr(()=>{i(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(s=>{i(()=>this.Qo(s))}),this.stream.onMessage(s=>{i(()=>this.onMessage(s))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(e){return x("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return n=>{this.Hs.enqueueAndForget(()=>this.So===e?n():(x("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Qf extends wu{constructor(e,n,i,s,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,i,s,o),this.It=r}jo(e,n){return this.connection.wo("Listen",e,n)}onMessage(e){this.xo.reset();const n=sf(this.It,e),i=function(s){if(!("targetChange"in s))return j.min();const r=s.targetChange;return r.targetIds&&r.targetIds.length?j.min():r.readTime?rt(r.readTime):j.min()}(e);return this.listener.Wo(n,i)}zo(e){const n={};n.database=ir(this.It),n.addTarget=function(s,r){let o;const a=r.target;return o=Js(a)?{documents:af(s,a)}:{query:lf(s,a)},o.targetId=r.targetId,r.resumeToken.approximateByteSize()>0?o.resumeToken=hu(s,r.resumeToken):r.snapshotVersion.compareTo(j.min())>0&&(o.readTime=Ui(s,r.snapshotVersion.toTimestamp())),o}(this.It,e);const i=cf(this.It,e);i&&(n.labels=i),this.Bo(n)}Ho(e){const n={};n.database=ir(this.It),n.removeTarget=e,this.Bo(n)}}class Gf extends wu{constructor(e,n,i,s,r,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,i,s,o),this.It=r,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}qo(){this.Jo&&this.Xo([])}jo(e,n){return this.connection.wo("Write",e,n)}onMessage(e){if(ee(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const n=of(e.writeResults,e.commitTime),i=rt(e.commitTime);return this.listener.Zo(i,n)}return ee(!e.writeResults||e.writeResults.length===0),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=ir(this.It),this.Bo(e)}Xo(e){const n={streamToken:this.lastStreamToken,writes:e.map(i=>rf(this.It,i))};this.Bo(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wf extends class{}{constructor(e,n,i,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=i,this.It=s,this.nu=!1}su(){if(this.nu)throw new C(g.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,n,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,r])=>this.connection.ao(e,n,i,s,r)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new C(g.UNKNOWN,s.toString())})}_o(e,n,i,s){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,o])=>this.connection._o(e,n,i,r,o,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new C(g.UNKNOWN,r.toString())})}terminate(){this.nu=!0}}class Xf{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){this.iu===0&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){this.state==="Online"?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,e==="Online"&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(at(n),this.ou=!1):x("OnlineStateTracker",n)}lu(){this.ru!==null&&(this.ru.cancel(),this.ru=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(e,n,i,s,r){this.localStore=e,this.datastore=n,this.asyncQueue=i,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=r,this.mu.qr(o=>{i.enqueueAndForget(async()=>{Ot(this)&&(x("RemoteStore","Restarting streams for network reachability change."),await async function(a){const l=F(a);l._u.add(4),await oi(l),l.gu.set("Unknown"),l._u.delete(4),await fs(l)}(this))})}),this.gu=new Xf(i,s)}}async function fs(t){if(Ot(t))for(const e of t.wu)await e(!0)}async function oi(t){for(const e of t.wu)await e(!1)}function Su(t,e){const n=F(t);n.du.has(e.targetId)||(n.du.set(e.targetId,e),Hr(n)?zr(n):mn(n).ko()&&Kr(n,e))}function Tu(t,e){const n=F(t),i=mn(n);n.du.delete(e),i.ko()&&Eu(n,e),n.du.size===0&&(i.ko()?i.Fo():Ot(n)&&n.gu.set("Unknown"))}function Kr(t,e){t.yu.Mt(e.targetId),mn(t).zo(e)}function Eu(t,e){t.yu.Mt(e),mn(t).Ho(e)}function zr(t){t.yu=new Yd({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),se:e=>t.du.get(e)||null}),mn(t).start(),t.gu.uu()}function Hr(t){return Ot(t)&&!mn(t).No()&&t.du.size>0}function Ot(t){return F(t)._u.size===0}function bu(t){t.yu=void 0}async function Jf(t){t.du.forEach((e,n)=>{Kr(t,e)})}async function Zf(t,e){bu(t),Hr(t)?(t.gu.hu(e),zr(t)):t.gu.set("Unknown")}async function em(t,e,n){if(t.gu.set("Online"),e instanceof cu&&e.state===2&&e.cause)try{await async function(i,s){const r=s.cause;for(const o of s.targetIds)i.du.has(o)&&(await i.remoteSyncer.rejectListen(o,r),i.du.delete(o),i.yu.removeTarget(o))}(t,e)}catch(i){x("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Bi(t,i)}else if(e instanceof Ci?t.yu.Gt(e):e instanceof uu?t.yu.Yt(e):t.yu.Wt(e),!n.isEqual(j.min()))try{const i=await vu(t.localStore);n.compareTo(i)>=0&&await function(s,r){const o=s.yu.te(r);return o.targetChanges.forEach((a,l)=>{if(a.resumeToken.approximateByteSize()>0){const u=s.du.get(l);u&&s.du.set(l,u.withResumeToken(a.resumeToken,r))}}),o.targetMismatches.forEach(a=>{const l=s.du.get(a);if(!l)return;s.du.set(a,l.withResumeToken(ke.EMPTY_BYTE_STRING,l.snapshotVersion)),Eu(s,a);const u=new _t(l.target,a,1,l.sequenceNumber);Kr(s,u)}),s.remoteSyncer.applyRemoteEvent(o)}(t,n)}catch(i){x("RemoteStore","Failed to raise snapshot:",i),await Bi(t,i)}}async function Bi(t,e,n){if(!ni(e))throw e;t._u.add(1),await oi(t),t.gu.set("Offline"),n||(n=()=>vu(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{x("RemoteStore","Retrying IndexedDB access"),await n(),t._u.delete(1),await fs(t)})}function Iu(t,e){return e().catch(n=>Bi(t,n,e))}async function ms(t){const e=F(t),n=gt(e);let i=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;tm(e);)try{const s=await Pf(e.localStore,i);if(s===null){e.fu.length===0&&n.Fo();break}i=s.batchId,nm(e,s)}catch(s){await Bi(e,s)}Cu(e)&&ku(e)}function tm(t){return Ot(t)&&t.fu.length<10}function nm(t,e){t.fu.push(e);const n=gt(t);n.ko()&&n.Yo&&n.Xo(e.mutations)}function Cu(t){return Ot(t)&&!gt(t).No()&&t.fu.length>0}function ku(t){gt(t).start()}async function im(t){gt(t).eu()}async function sm(t){const e=gt(t);for(const n of t.fu)e.Xo(n.mutations)}async function rm(t,e,n){const i=t.fu.shift(),s=Ur.from(i,e,n);await Iu(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await ms(t)}async function om(t,e){e&&gt(t).Yo&&await async function(n,i){if(s=i.code,Hd(s)&&s!==g.ABORTED){const r=n.fu.shift();gt(n).Mo(),await Iu(n,()=>n.remoteSyncer.rejectFailedWrite(r.batchId,i)),await ms(n)}var s}(t,e),Cu(t)&&ku(t)}async function ua(t,e){const n=F(t);n.asyncQueue.verifyOperationInProgress(),x("RemoteStore","RemoteStore received new credentials");const i=Ot(n);n._u.add(3),await oi(n),i&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n._u.delete(3),await fs(n)}async function am(t,e){const n=F(t);e?(n._u.delete(2),await fs(n)):e||(n._u.add(2),await oi(n),n.gu.set("Unknown"))}function mn(t){return t.pu||(t.pu=function(e,n,i){const s=F(e);return s.su(),new Qf(n,s.connection,s.authCredentials,s.appCheckCredentials,s.It,i)}(t.datastore,t.asyncQueue,{Yr:Jf.bind(null,t),Zr:Zf.bind(null,t),Wo:em.bind(null,t)}),t.wu.push(async e=>{e?(t.pu.Mo(),Hr(t)?zr(t):t.gu.set("Unknown")):(await t.pu.stop(),bu(t))})),t.pu}function gt(t){return t.Iu||(t.Iu=function(e,n,i){const s=F(e);return s.su(),new Gf(n,s.connection,s.authCredentials,s.appCheckCredentials,s.It,i)}(t.datastore,t.asyncQueue,{Yr:im.bind(null,t),Zr:om.bind(null,t),tu:sm.bind(null,t),Zo:rm.bind(null,t)}),t.wu.push(async e=>{e?(t.Iu.Mo(),await ms(t)):(await t.Iu.stop(),t.fu.length>0&&(x("RemoteStore",`Stopping write stream with ${t.fu.length} pending writes`),t.fu=[]))})),t.Iu}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qr{constructor(e,n,i,s,r){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=i,this.op=s,this.removalCallback=r,this.deferred=new ht,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,n,i,s,r){const o=Date.now()+i,a=new Qr(e,n,o,s,r);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new C(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Gr(t,e){if(at("AsyncQueue",`${e}: ${t}`),ni(t))return new C(g.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e){this.comparator=e?(n,i)=>e(n,i)||D.comparator(n.key,i.key):(n,i)=>D.comparator(n.key,i.key),this.keyedMap=In(),this.sortedSet=new ce(this.comparator)}static emptySet(e){return new Yt(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,i)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Yt)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,r=i.getNext().key;if(!s.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const i=new Yt;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=n,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca{constructor(){this.Tu=new ce(D.comparator)}track(e){const n=e.doc.key,i=this.Tu.get(n);i?e.type!==0&&i.type===3?this.Tu=this.Tu.insert(n,e):e.type===3&&i.type!==1?this.Tu=this.Tu.insert(n,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.Tu=this.Tu.insert(n,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.Tu=this.Tu.insert(n,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.Tu=this.Tu.remove(n):e.type===1&&i.type===2?this.Tu=this.Tu.insert(n,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.Tu=this.Tu.insert(n,{type:2,doc:e.doc}):q():this.Tu=this.Tu.insert(n,e)}Eu(){const e=[];return this.Tu.inorderTraversal((n,i)=>{e.push(i)}),e}}class on{constructor(e,n,i,s,r,o,a,l,u){this.query=e,this.docs=n,this.oldDocs=i,this.docChanges=s,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,n,i,s,r){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new on(e,n,Yt.emptySet(n),o,i,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ls(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,i=e.docChanges;if(n.length!==i.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==i[s].type||!n[s].doc.isEqual(i[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lm{constructor(){this.Au=void 0,this.listeners=[]}}class um{constructor(){this.queries=new fn(e=>Gl(e),ls),this.onlineState="Unknown",this.Ru=new Set}}async function cm(t,e){const n=F(t),i=e.query;let s=!1,r=n.queries.get(i);if(r||(s=!0,r=new lm),s)try{r.Au=await n.onListen(i)}catch(o){const a=Gr(o,`Initialization of query '${er(e.query)}' failed`);return void e.onError(a)}n.queries.set(i,r),r.listeners.push(e),e.bu(n.onlineState),r.Au&&e.Pu(r.Au)&&Wr(n)}async function hm(t,e){const n=F(t),i=e.query;let s=!1;const r=n.queries.get(i);if(r){const o=r.listeners.indexOf(e);o>=0&&(r.listeners.splice(o,1),s=r.listeners.length===0)}if(s)return n.queries.delete(i),n.onUnlisten(i)}function dm(t,e){const n=F(t);let i=!1;for(const s of e){const r=s.query,o=n.queries.get(r);if(o){for(const a of o.listeners)a.Pu(s)&&(i=!0);o.Au=s}}i&&Wr(n)}function fm(t,e,n){const i=F(t),s=i.queries.get(e);if(s)for(const r of s.listeners)r.onError(n);i.queries.delete(e)}function Wr(t){t.Ru.forEach(e=>{e.next()})}class mm{constructor(e,n,i){this.query=e,this.vu=n,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=i||{}}Pu(e){if(!this.options.includeMetadataChanges){const i=[];for(const s of e.docChanges)s.type!==3&&i.push(s);e=new on(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),n=!0):this.Cu(e,this.onlineState)&&(this.xu(e),n=!0),this.Su=e,n}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let n=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),n=!0),n}Cu(e,n){if(!e.fromCache)return!0;const i=n!=="Offline";return(!this.options.Nu||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Du(e){if(e.docChanges.length>0)return!0;const n=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}xu(e){e=on.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{constructor(e){this.key=e}}class xu{constructor(e){this.key=e}}class gm{constructor(e,n){this.query=e,this.Uu=n,this.qu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=z(),this.mutatedKeys=z(),this.Gu=Wl(e),this.Qu=new Yt(this.Gu)}get ju(){return this.Uu}Wu(e,n){const i=n?n.zu:new ca,s=n?n.Qu:this.Qu;let r=n?n.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((c,d)=>{const m=s.get(c),f=qr(this.query,d)?d:null,y=!!m&&this.mutatedKeys.has(m.key),p=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let w=!1;m&&f?m.data.isEqual(f.data)?y!==p&&(i.track({type:3,doc:f}),w=!0):this.Hu(m,f)||(i.track({type:2,doc:f}),w=!0,(l&&this.Gu(f,l)>0||u&&this.Gu(f,u)<0)&&(a=!0)):!m&&f?(i.track({type:0,doc:f}),w=!0):m&&!f&&(i.track({type:1,doc:m}),w=!0,(l||u)&&(a=!0)),w&&(f?(o=o.add(f),r=p?r.add(c):r.delete(c)):(o=o.delete(c),r=r.delete(c)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const c=this.query.limitType==="F"?o.last():o.first();o=o.delete(c.key),r=r.delete(c.key),i.track({type:1,doc:c})}return{Qu:o,zu:i,$i:a,mutatedKeys:r}}Hu(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,i){const s=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const r=e.zu.Eu();r.sort((u,c)=>function(d,m){const f=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return q()}};return f(d)-f(m)}(u.type,c.type)||this.Gu(u.doc,c.doc)),this.Ju(i);const o=n?this.Yu():[],a=this.Ku.size===0&&this.current?1:0,l=a!==this.qu;return this.qu=a,r.length!==0||l?{snapshot:new on(this.query,e.Qu,s,r,e.mutatedKeys,a===0,l,!1,!!i&&i.resumeToken.approximateByteSize()>0),Xu:o}:{Xu:o}}bu(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new ca,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.Uu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(n=>this.Uu=this.Uu.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Uu=this.Uu.delete(n)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=z(),this.Qu.forEach(i=>{this.Zu(i.key)&&(this.Ku=this.Ku.add(i.key))});const n=[];return e.forEach(i=>{this.Ku.has(i)||n.push(new xu(i))}),this.Ku.forEach(i=>{e.has(i)||n.push(new Au(i))}),n}tc(e){this.Uu=e.Hi,this.Ku=z();const n=this.Wu(e.documents);return this.applyChanges(n,!0)}ec(){return on.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,this.qu===0,this.hasCachedResults)}}class pm{constructor(e,n,i){this.query=e,this.targetId=n,this.view=i}}class vm{constructor(e){this.key=e,this.nc=!1}}class ym{constructor(e,n,i,s,r,o){this.localStore=e,this.remoteStore=n,this.eventManager=i,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.sc={},this.ic=new fn(a=>Gl(a),ls),this.rc=new Map,this.oc=new Set,this.uc=new ce(D.comparator),this.cc=new Map,this.ac=new Br,this.hc={},this.lc=new Map,this.fc=rn.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return this.dc===!0}}async function wm(t,e){const n=Dm(t);let i,s;const r=n.ic.get(e);if(r)i=r.targetId,n.sharedClientState.addLocalQueryTarget(i),s=r.view.ec();else{const o=await Uf(n.localStore,lt(e));n.isPrimaryClient&&Su(n.remoteStore,o);const a=n.sharedClientState.addLocalQueryTarget(o.targetId);i=o.targetId,s=await Sm(n,e,i,a==="current",o.resumeToken)}return s}async function Sm(t,e,n,i,s){t._c=(d,m,f)=>async function(y,p,w,R){let N=p.view.Wu(w);N.$i&&(N=await oa(y.localStore,p.query,!1).then(({documents:B})=>p.view.Wu(B,N)));const _=R&&R.targetChanges.get(p.targetId),M=p.view.applyChanges(N,y.isPrimaryClient,_);return da(y,p.targetId,M.Xu),M.snapshot}(t,d,m,f);const r=await oa(t.localStore,e,!0),o=new gm(e,r.Hi),a=o.Wu(r.documents),l=ri.createSynthesizedTargetChangeForCurrentChange(n,i&&t.onlineState!=="Offline",s),u=o.applyChanges(a,t.isPrimaryClient,l);da(t,n,u.Xu);const c=new pm(e,n,o);return t.ic.set(e,c),t.rc.has(n)?t.rc.get(n).push(e):t.rc.set(n,[e]),u.snapshot}async function Tm(t,e){const n=F(t),i=n.ic.get(e),s=n.rc.get(i.targetId);if(s.length>1)return n.rc.set(i.targetId,s.filter(r=>!ls(r,e))),void n.ic.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await sr(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),Tu(n.remoteStore,i.targetId),rr(n,i.targetId)}).catch(ti)):(rr(n,i.targetId),await sr(n.localStore,i.targetId,!0))}async function Em(t,e,n){const i=_m(t);try{const s=await function(r,o){const a=F(r),l=le.now(),u=o.reduce((m,f)=>m.add(f.key),z());let c,d;return a.persistence.runTransaction("Locally write mutations","readwrite",m=>{let f=ut(),y=z();return a.Gi.getEntries(m,u).next(p=>{f=p,f.forEach((w,R)=>{R.isValidDocument()||(y=y.add(w))})}).next(()=>a.localDocuments.getOverlayedDocuments(m,f)).next(p=>{c=p;const w=[];for(const R of o){const N=jd(R,c.get(R.key).overlayedDocument);N!=null&&w.push(new Mt(R.key,N,$l(N.value.mapValue),ze.exists(!0)))}return a.mutationQueue.addMutationBatch(m,l,w,o)}).next(p=>{d=p;const w=p.applyToLocalDocumentSet(c,y);return a.documentOverlayCache.saveOverlays(m,p.batchId,w)})}).then(()=>({batchId:d.batchId,changes:ou(c)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(s.batchId),function(r,o,a){let l=r.hc[r.currentUser.toKey()];l||(l=new ce(W)),l=l.insert(o,a),r.hc[r.currentUser.toKey()]=l}(i,s.batchId,n),await ai(i,s.changes),await ms(i.remoteStore)}catch(s){const r=Gr(s,"Failed to persist write");n.reject(r)}}async function Du(t,e){const n=F(t);try{const i=await qf(n.localStore,e);e.targetChanges.forEach((s,r)=>{const o=n.cc.get(r);o&&(ee(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.nc=!0:s.modifiedDocuments.size>0?ee(o.nc):s.removedDocuments.size>0&&(ee(o.nc),o.nc=!1))}),await ai(n,i,e)}catch(i){await ti(i)}}function ha(t,e,n){const i=F(t);if(i.isPrimaryClient&&n===0||!i.isPrimaryClient&&n===1){const s=[];i.ic.forEach((r,o)=>{const a=o.view.bu(e);a.snapshot&&s.push(a.snapshot)}),function(r,o){const a=F(r);a.onlineState=o;let l=!1;a.queries.forEach((u,c)=>{for(const d of c.listeners)d.bu(o)&&(l=!0)}),l&&Wr(a)}(i.eventManager,e),s.length&&i.sc.Wo(s),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function bm(t,e,n){const i=F(t);i.sharedClientState.updateQueryState(e,"rejected",n);const s=i.cc.get(e),r=s&&s.key;if(r){let o=new ce(D.comparator);o=o.insert(r,ve.newNoDocument(r,j.min()));const a=z().add(r),l=new hs(j.min(),new Map,new ue(W),o,a);await Du(i,l),i.uc=i.uc.remove(r),i.cc.delete(e),Xr(i)}else await sr(i.localStore,e,!1).then(()=>rr(i,e,n)).catch(ti)}async function Im(t,e){const n=F(t),i=e.batch.batchId;try{const s=await Of(n.localStore,e);Nu(n,i,null),_u(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await ai(n,s)}catch(s){await ti(s)}}async function Cm(t,e,n){const i=F(t);try{const s=await function(r,o){const a=F(r);return a.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let u;return a.mutationQueue.lookupMutationBatch(l,o).next(c=>(ee(c!==null),u=c.keys(),a.mutationQueue.removeMutationBatch(l,c))).next(()=>a.mutationQueue.performConsistencyCheck(l)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(l,u,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,u)).next(()=>a.localDocuments.getDocuments(l,u))})}(i.localStore,e);Nu(i,e,n),_u(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),await ai(i,s)}catch(s){await ti(s)}}function _u(t,e){(t.lc.get(e)||[]).forEach(n=>{n.resolve()}),t.lc.delete(e)}function Nu(t,e,n){const i=F(t);let s=i.hc[i.currentUser.toKey()];if(s){const r=s.get(e);r&&(n?r.reject(n):r.resolve(),s=s.remove(e)),i.hc[i.currentUser.toKey()]=s}}function rr(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t.rc.get(e))t.ic.delete(i),n&&t.sc.wc(i,n);t.rc.delete(e),t.isPrimaryClient&&t.ac.ls(e).forEach(i=>{t.ac.containsKey(i)||Vu(t,i)})}function Vu(t,e){t.oc.delete(e.path.canonicalString());const n=t.uc.get(e);n!==null&&(Tu(t.remoteStore,n),t.uc=t.uc.remove(e),t.cc.delete(n),Xr(t))}function da(t,e,n){for(const i of n)i instanceof Au?(t.ac.addReference(i.key,e),km(t,i)):i instanceof xu?(x("SyncEngine","Document no longer in limbo: "+i.key),t.ac.removeReference(i.key,e),t.ac.containsKey(i.key)||Vu(t,i.key)):q()}function km(t,e){const n=e.key,i=n.path.canonicalString();t.uc.get(n)||t.oc.has(i)||(x("SyncEngine","New document in limbo: "+n),t.oc.add(i),Xr(t))}function Xr(t){for(;t.oc.size>0&&t.uc.size<t.maxConcurrentLimboResolutions;){const e=t.oc.values().next().value;t.oc.delete(e);const n=new D(te.fromString(e)),i=t.fc.next();t.cc.set(i,new vm(n)),t.uc=t.uc.insert(n,i),Su(t.remoteStore,new _t(lt(Kl(n.path)),i,2,Rr.at))}}async function ai(t,e,n){const i=F(t),s=[],r=[],o=[];i.ic.isEmpty()||(i.ic.forEach((a,l)=>{o.push(i._c(l,e,n).then(u=>{if((u||n)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(l.targetId,u!=null&&u.fromCache?"not-current":"current"),u){s.push(u);const c=jr.Ci(l.targetId,u);r.push(c)}}))}),await Promise.all(o),i.sc.Wo(s),await async function(a,l){const u=F(a);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",c=>v.forEach(l,d=>v.forEach(d.Si,m=>u.persistence.referenceDelegate.addReference(c,d.targetId,m)).next(()=>v.forEach(d.Di,m=>u.persistence.referenceDelegate.removeReference(c,d.targetId,m)))))}catch(c){if(!ni(c))throw c;x("LocalStore","Failed to update sequence numbers: "+c)}for(const c of l){const d=c.targetId;if(!c.fromCache){const m=u.Ui.get(d),f=m.snapshotVersion,y=m.withLastLimboFreeSnapshotVersion(f);u.Ui=u.Ui.insert(d,y)}}}(i.localStore,r))}async function Am(t,e){const n=F(t);if(!n.currentUser.isEqual(e)){x("SyncEngine","User change. New user:",e.toKey());const i=await pu(n.localStore,e);n.currentUser=e,function(s,r){s.lc.forEach(o=>{o.forEach(a=>{a.reject(new C(g.CANCELLED,r))})}),s.lc.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await ai(n,i.ji)}}function xm(t,e){const n=F(t),i=n.cc.get(e);if(i&&i.nc)return z().add(i.key);{let s=z();const r=n.rc.get(e);if(!r)return s;for(const o of r){const a=n.ic.get(o);s=s.unionWith(a.view.ju)}return s}}function Dm(t){const e=F(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Du.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xm.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bm.bind(null,e),e.sc.Wo=dm.bind(null,e.eventManager),e.sc.wc=fm.bind(null,e.eventManager),e}function _m(t){const e=F(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Im.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Cm.bind(null,e),e}class Nm{constructor(){this.synchronizeTabs=!1}async initialize(e){this.It=ds(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,n){return null}Ec(e,n){return null}Ic(e){return Mf(this.persistence,new Rf,e.initialUser,this.It)}yc(e){return new Nf($r.Bs,this.It)}gc(e){return new $f}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Vm{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>ha(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Am.bind(null,this.syncEngine),await am(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new um}createDatastore(e){const n=ds(e.databaseInfo.databaseId),i=(s=e.databaseInfo,new Hf(s));var s;return function(r,o,a,l){return new Wf(r,o,a,l)}(e.authCredentials,e.appCheckCredentials,i,n)}createRemoteStore(e){return n=this.localStore,i=this.datastore,s=e.asyncQueue,r=a=>ha(this.syncEngine,a,0),o=la.C()?new la:new jf,new Yf(n,i,s,r,o);var n,i,s,r,o}createSyncEngine(e,n){return function(i,s,r,o,a,l,u){const c=new ym(i,s,r,o,a,l);return u&&(c.dc=!0),c}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return async function(e){const n=F(e);x("RemoteStore","RemoteStore shutting down."),n._u.add(5),await oi(n),n.mu.shutdown(),n.gu.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ru(t,e,n){if(!n)throw new C(g.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Rm(t,e,n,i){if(e===!0&&i===!0)throw new C(g.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function fa(t){if(!D.isDocumentKey(t))throw new C(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function ma(t){if(D.isDocumentKey(t))throw new C(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function gs(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":q()}function Rt(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new C(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=gs(t);throw new C(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ga=new Map;class pa{constructor(e){var n;if(e.host===void 0){if(e.ssl!==void 0)throw new C(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new C(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Rm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(e,n,i,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=i,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pa({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new C(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new C(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pa(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new od;switch(n.type){case"gapi":const i=n.client;return new cd(i,n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new C(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const n=ga.get(e);n&&(x("ComponentProvider","Removing Datastore"),ga.delete(e),n.terminate())}(this),Promise.resolve()}}function Lm(t,e,n,i={}){var s;const r=(t=Rt(t,ps))._getSettings();if(r.host!=="firestore.googleapis.com"&&r.host!==e&&Ws("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:`${e}:${n}`,ssl:!1})),i.mockUserToken){let o,a;if(typeof i.mockUserToken=="string")o=i.mockUserToken,a=Ee.MOCK_USER;else{o=wc(i.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const l=i.mockUserToken.sub||i.mockUserToken.user_id;if(!l)throw new C(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Ee(l)}t._authCredentials=new ad(new ql(o,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me{constructor(e,n,i){this.converter=n,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new dt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Me(this.firestore,e,this._key)}}class li{constructor(e,n,i){this.converter=n,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new li(this.firestore,e,this._query)}}class dt extends li{constructor(e,n,i){super(e,n,Kl(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Me(this.firestore,null,new D(e))}withConverter(e){return new dt(this.firestore,e,this._path)}}function va(t,e,...n){if(t=Zt(t),Ru("collection","path",e),t instanceof ps){const i=te.fromString(e,...n);return ma(i),new dt(t,null,i)}{if(!(t instanceof Me||t instanceof dt))throw new C(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(te.fromString(e,...n));return ma(i),new dt(t.firestore,null,i)}}function or(t,e,...n){if(t=Zt(t),arguments.length===1&&(e=Fl.R()),Ru("doc","path",e),t instanceof ps){const i=te.fromString(e,...n);return fa(i),new Me(t,null,new D(i))}{if(!(t instanceof Me||t instanceof dt))throw new C(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(te.fromString(e,...n));return fa(i),new Me(t.firestore,t instanceof dt?t.converter:null,new D(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):at("Uncaught Error in snapshot listener:",e)}bc(){this.muted=!0}Rc(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(e,n,i,s){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=i,this.databaseInfo=s,this.user=Ee.UNAUTHENTICATED,this.clientId=Fl.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,async r=>{x("FirestoreClient","Received user=",r.uid),await this.authCredentialListener(r),this.user=r}),this.appCheckCredentials.start(i,r=>(x("FirestoreClient","Received new app check token=",r),this.appCheckCredentialListener(r,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new C(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ht;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const i=Gr(n,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function qm(t,e){t.asyncQueue.verifyOperationInProgress(),x("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener(async s=>{i.isEqual(s)||(await pu(e.localStore,s),i=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t.offlineComponents=e}async function Fm(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Pm(t);x("FirestoreClient","Initializing OnlineComponentProvider");const i=await t.getConfiguration();await e.initialize(n,i),t.setCredentialChangeListener(s=>ua(e.remoteStore,s)),t.setAppCheckTokenChangeListener((s,r)=>ua(e.remoteStore,r)),t.onlineComponents=e}async function Pm(t){return t.offlineComponents||(x("FirestoreClient","Using default OfflineComponentProvider"),await qm(t,new Nm)),t.offlineComponents}async function Lu(t){return t.onlineComponents||(x("FirestoreClient","Using default OnlineComponentProvider"),await Fm(t,new Vm)),t.onlineComponents}function Um(t){return Lu(t).then(e=>e.syncEngine)}async function Bm(t){const e=await Lu(t),n=e.eventManager;return n.onListen=wm.bind(null,e.syncEngine),n.onUnlisten=Tm.bind(null,e.syncEngine),n}function $m(t,e,n={}){const i=new ht;return t.asyncQueue.enqueueAndForget(async()=>function(s,r,o,a,l){const u=new Mm({next:d=>{r.enqueueAndForget(()=>hm(s,c)),d.fromCache&&a.source==="server"?l.reject(new C(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(d)},error:d=>l.reject(d)}),c=new mm(o,u,{includeMetadataChanges:!0,Nu:!0});return cm(s,c)}(await Bm(t),t.asyncQueue,e,n,i)),i.promise}class jm{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.Uc=!1,this.qc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new yu(this,"async_queue_retry"),this.Wc=()=>{const n=Ls();n&&x("AsyncQueue","Visibility state changed to "+n.visibilityState),this.xo.Po()};const e=Ls();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.Uc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.Uc){this.Uc=!0,this.Qc=e||!1;const n=Ls();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.Uc)return new Promise(()=>{});const n=new ht;return this.Hc(()=>this.Uc&&this.Qc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(this.Lc.length!==0){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!ni(e))throw e;x("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro(()=>this.Jc())}}Hc(e){const n=this.Bc.then(()=>(this.Gc=!0,e().catch(i=>{this.Kc=i,this.Gc=!1;const s=function(r){let o=r.message||"";return r.stack&&(o=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),o}(i);throw at("INTERNAL UNHANDLED ERROR: ",s),i}).then(i=>(this.Gc=!1,i))));return this.Bc=n,n}enqueueAfterDelay(e,n,i){this.zc(),this.jc.indexOf(e)>-1&&(n=0);const s=Qr.createAndSchedule(this,e,n,i,r=>this.Yc(r));return this.qc.push(s),s}zc(){this.Kc&&q()}verifyOperationInProgress(){}async Xc(){let e;do e=this.Bc,await e;while(e!==this.Bc)}Zc(e){for(const n of this.qc)if(n.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.qc.sort((n,i)=>n.targetTimeMs-i.targetTimeMs);for(const n of this.qc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const n=this.qc.indexOf(e);this.qc.splice(n,1)}}class ui extends ps{constructor(e,n,i,s){super(e,n,i,s),this.type="firestore",this._queue=new jm,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Ou(this),this._firestoreClient.terminate()}}function Ti(t,e){const n=typeof t=="object"?t:Tn(),i=typeof t=="string"?t:e||"(default)",s=vc(n,"firestore").getImmediate({identifier:i});if(!s._initialized){const r=yc("firestore");r&&Lm(s,...r)}return s}function Mu(t){return t._firestoreClient||Ou(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Ou(t){var e;const n=t._freezeSettings(),i=function(s,r,o,a){return new Td(s,r,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Om(t._authCredentials,t._appCheckCredentials,t._queue,i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this._byteString=e}static fromBase64String(e){try{return new an(ke.fromBase64String(e))}catch(n){throw new C(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new an(ke.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new C(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new be(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new C(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new C(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Km=/^__.*__$/;class zm{constructor(e,n,i){this.data=e,this.fieldMask=n,this.fieldTransforms=i}toMutation(e,n){return this.fieldMask!==null?new Mt(e,this.data,this.fieldMask,n,this.fieldTransforms):new si(e,this.data,n,this.fieldTransforms)}}function Fu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw q()}}class Zr{constructor(e,n,i,s,r,o){this.settings=e,this.databaseId=n,this.It=i,this.ignoreUndefinedProperties=s,r===void 0&&this.na(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Zr(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var n;const i=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.ia({path:i,oa:!1});return s.ua(e),s}ca(e){var n;const i=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.ia({path:i,oa:!1});return s.na(),s}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return $i(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(e.length===0)throw this.ha("Document fields must not be empty");if(Fu(this.sa)&&Km.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class Hm{constructor(e,n,i){this.databaseId=e,this.ignoreUndefinedProperties=n,this.It=i||ds(e)}da(e,n,i,s=!1){return new Zr({sa:e,methodName:n,fa:i,path:be.emptyPath(),oa:!1,la:s},this.databaseId,this.It,this.ignoreUndefinedProperties)}}function eo(t){const e=t._freezeSettings(),n=ds(t._databaseId);return new Hm(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Pu(t,e,n,i,s,r={}){const o=t.da(r.merge||r.mergeFields?2:0,e,n,s);$u("Data must be an object, but it was:",o,i);const a=Uu(i,o);let l,u;if(r.merge)l=new Xe(o.fieldMask),u=o.fieldTransforms;else if(r.mergeFields){const c=[];for(const d of r.mergeFields){const m=Gm(e,d,n);if(!o.contains(m))throw new C(g.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);Xm(c,m)||c.push(m)}l=new Xe(c),u=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,u=o.fieldTransforms;return new zm(new Pe(a),l,u)}function Qm(t,e,n,i=!1){return to(n,t.da(i?4:3,e))}function to(t,e){if(Bu(t=Zt(t)))return $u("Unsupported field value:",e,t),Uu(t,e);if(t instanceof qu)return function(n,i){if(!Fu(i.sa))throw i.ha(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.ha(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.oa&&e.sa!==4)throw e.ha("Nested arrays are not supported");return function(n,i){const s=[];let r=0;for(const o of n){let a=to(o,i.aa(r));a==null&&(a={nullValue:"NULL_VALUE"}),s.push(a),r++}return{arrayValue:{values:s}}}(t,e)}return function(n,i){if((n=Zt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return qd(i.It,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const s=le.fromDate(n);return{timestampValue:Ui(i.It,s)}}if(n instanceof le){const s=new le(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Ui(i.It,s)}}if(n instanceof Jr)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof an)return{bytesValue:hu(i.It,n._byteString)};if(n instanceof Me){const s=i.databaseId,r=n.firestore._databaseId;if(!r.isEqual(s))throw i.ha(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Pr(n.firestore._databaseId||i.databaseId,n._key.path)}}throw i.ha(`Unsupported field value: ${gs(n)}`)}(t,e)}function Uu(t,e){const n={};return Pl(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):dn(t,(i,s)=>{const r=to(s,e.ra(i));r!=null&&(n[i]=r)}),{mapValue:{fields:n}}}function Bu(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof le||t instanceof Jr||t instanceof an||t instanceof Me||t instanceof qu)}function $u(t,e,n){if(!Bu(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){const i=gs(n);throw i==="an object"?e.ha(t+" a custom object"):e.ha(t+" "+i)}}function Gm(t,e,n){if((e=Zt(e))instanceof Yr)return e._internalPath;if(typeof e=="string")return ju(t,e);throw $i("Field path arguments must be of type string or ",t,!1,void 0,n)}const Wm=new RegExp("[~\\*/\\[\\]]");function ju(t,e,n){if(e.search(Wm)>=0)throw $i(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Yr(...e.split("."))._internalPath}catch{throw $i(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function $i(t,e,n,i,s){const r=i&&!i.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(r||o)&&(l+=" (found",r&&(l+=` in field ${i}`),o&&(l+=` in document ${s}`),l+=")"),new C(g.INVALID_ARGUMENT,a+t+l)}function Xm(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ku{constructor(e,n,i,s,r){this._firestore=e,this._userDataWriter=n,this._key=i,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Me(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Ym(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(no("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Ym extends Ku{data(){return super.data()}}function no(t,e){return typeof e=="string"?ju(t,e):e instanceof Yr?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jm(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new C(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Zm{}function eg(t,...e){for(const n of e)t=n._apply(t);return t}class tg extends Zm{constructor(e,n,i){super(),this.ma=e,this.ga=n,this.ya=i,this.type="where"}_apply(e){const n=eo(e.firestore),i=function(s,r,o,a,l,u,c){let d;if(l.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new C(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){wa(c,u);const f=[];for(const y of c)f.push(ya(a,s,y));d={arrayValue:{values:f}}}else d=ya(a,s,c)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||wa(c,u),d=Qm(o,r,c,u==="in"||u==="not-in");const m=_e.create(l,u,d);return function(f,y){if(y.dt()){const w=Hl(f);if(w!==null&&!w.isEqual(y.field))throw new C(g.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${w.toString()}' and '${y.field.toString()}'`);const R=zl(f);R!==null&&ig(f,y.field,R)}const p=function(w,R){for(const N of w.filters)if(R.indexOf(N.op)>=0)return N.op;return null}(f,function(w){switch(w){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(y.op));if(p!==null)throw p===y.op?new C(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${y.op.toString()}' filter.`):new C(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${y.op.toString()}' filters with '${p.toString()}' filters.`)}(s,m),m}(e._query,"where",n,e.firestore._databaseId,this.ma,this.ga,this.ya);return new li(e.firestore,e.converter,function(s,r){const o=s.filters.concat([r]);return new ii(s.path,s.collectionGroup,s.explicitOrderBy.slice(),o,s.limit,s.limitType,s.startAt,s.endAt)}(e._query,i))}}function ng(t,e,n){const i=e,s=no("where",t);return new tg(s,i,n)}function ya(t,e,n){if(typeof(n=Zt(n))=="string"){if(n==="")throw new C(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ql(e)&&n.indexOf("/")!==-1)throw new C(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=e.path.child(te.fromString(n));if(!D.isDocumentKey(i))throw new C(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return zo(t,new D(i))}if(n instanceof Me)return zo(t,n._key);throw new C(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${gs(n)}.`)}function wa(t,e){if(!Array.isArray(t)||t.length===0)throw new C(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new C(g.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function ig(t,e,n){if(!n.isEqual(e))throw new C(g.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sg{convertValue(e,n="none"){switch(Vt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ae(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(nn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw q()}}convertObject(e,n){const i={};return dn(e.fields,(s,r)=>{i[s]=this.convertValue(r,n)}),i}convertGeoPoint(e){return new Jr(ae(e.latitude),ae(e.longitude))}convertArray(e,n){return(e.values||[]).map(i=>this.convertValue(i,n))}convertServerTimestamp(e,n){switch(n){case"previous":const i=Bl(e);return i==null?null:this.convertValue(i,n);case"estimate":return this.convertTimestamp(Un(e));default:return null}}convertTimestamp(e){const n=mt(e);return new le(n.seconds,n.nanos)}convertDocumentKey(e,n){const i=te.fromString(e);ee(gu(i));const s=new Bn(i.get(1),i.get(3)),r=new D(i.popFirst(5));return s.isEqual(n)||at(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zu(t,e,n){let i;return i=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class rg extends Ku{constructor(e,n,i,s,r,o){super(e,n,i,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new ki(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const i=this._document.data.field(no("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,n.serverTimestamps)}}}class ki extends rg{data(e={}){return super.data(e)}}class og{constructor(e,n,i,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Ei(s.hasPendingWrites,s.fromCache),this.query=i}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(i=>{e.call(n,new ki(this._firestore,this._userDataWriter,i.key,i,new Ei(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new C(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let r=0;return i._snapshot.docChanges.map(o=>{const a=new ki(i._firestore,i._userDataWriter,o.doc.key,o.doc,new Ei(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);return o.doc,{type:"added",doc:a,oldIndex:-1,newIndex:r++}})}{let r=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{const a=new ki(i._firestore,i._userDataWriter,o.doc.key,o.doc,new Ei(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);let l=-1,u=-1;return o.type!==0&&(l=r.indexOf(o.doc.key),r=r.delete(o.doc.key)),o.type!==1&&(r=r.add(o.doc),u=r.indexOf(o.doc.key)),{type:ag(o.type),doc:a,oldIndex:l,newIndex:u}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function ag(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return q()}}class lg extends sg{constructor(e){super(),this.firestore=e}convertBytes(e){return new an(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Me(this.firestore,null,n)}}function ug(t){t=Rt(t,li);const e=Rt(t.firestore,ui),n=Mu(e),i=new lg(e);return Jm(t._query),$m(n,t._query).then(s=>new og(e,i,t,s))}function cg(t,e,n){t=Rt(t,Me);const i=Rt(t.firestore,ui),s=zu(t.converter,e,n);return io(i,[Pu(eo(i),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,ze.none())])}function hg(t){return io(Rt(t.firestore,ui),[new Fr(t._key,ze.none())])}function dg(t,e){const n=Rt(t.firestore,ui),i=or(t),s=zu(t.converter,e);return io(n,[Pu(eo(t.firestore),"addDoc",i._key,s,t.converter!==null,{}).toMutation(i._key,ze.exists(!1))]).then(()=>i)}function io(t,e){return function(n,i){const s=new ht;return n.asyncQueue.enqueueAndForget(async()=>Em(await Um(n),i,s)),s.promise}(Mu(t),e)}(function(t,e=!0){(function(n){hn=n})(pc),dc(new fc("firestore",(n,{instanceIdentifier:i,options:s})=>{const r=n.getProvider("app").getImmediate(),o=new ui(new ld(n.getProvider("auth-internal")),new dd(n.getProvider("app-check-internal")),function(a,l){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new C(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bn(a.options.projectId,l)}(r,i),r);return s=Object.assign({useFetchStreams:e},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),wo(Uo,"3.7.2",t),wo(Uo,"3.7.2","esm2017")})();const Hu=Sc("teas",{state:()=>({teas:[]}),getters:{allTypes:t=>t.teas,oneType:t=>e=>t.teas.filter(n=>n.type==e),getByID:t=>e=>{const n=t.teas.find(i=>i.id==e);return"preparation2"in n||(n.preparation2=[{amount:"",temperature:"",wash:!1,times:["","","","",""]}]),n},emptyTea:t=>()=>({owner:So().currentUser.uid,name:"",notes:"",origin:"",pickingDate:"",type:"white",archived:!0,preparation2:[{amount:"",temperature:"",wash:!1,times:["","","","",""]}]})},actions:{resetTeas(){this.teas=[]},async fetchTeas(){const t=Ti(Tn()),e=await ug(eg(va(t,"teas"),ng("owner","==",So().currentUser.uid)));this.resetTeas(),e.forEach(n=>{this.teas.push({id:n.id,...n.data()})})},async updateTea(t){const e=this.teas.findIndex(i=>i.id==t.id);this.teas[e]=t;const n=Ti(Tn());await cg(or(n,"teas",t.id),t)},async createTea(t){const e=Ti(Tn()),n=await dg(va(e,"teas"),t);this.teas.push({id:n.id,...t})},async deleteTea(t){const e=this.teas.findIndex(i=>i.id==t);e>-1&&this.teas.splice(e,1);const n=Ti(Tn());await hg(or(n,"teas",t))},restoreBackup(t){const e=this.teas.findIndex(n=>n.id==t.id);this.teas[e]=t}}}),fg=["horizontal","vertical","cell","none"];var mg=Ue({name:"QMarkupTable",props:{...ji,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:t=>fg.includes(t)}},setup(t,{slots:e}){const n=pt(),i=Ki(t,n.proxy.$q),s=I(()=>`q-markup-table q-table__container q-table__card q-table--${t.separator}-separator`+(i.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(t.dense===!0?" q-table--dense":"")+(t.flat===!0?" q-table--flat":"")+(t.bordered===!0?" q-table--bordered":"")+(t.square===!0?" q-table--square":"")+(t.wrapCells===!1?" q-table--no-wrap":""));return()=>k("div",{class:s.value},[k("table",{class:"q-table"},ln(e.default))])}});const gg={name:"TeaItem",components:{},props:["info"],setup(t){return{}}},pg={class:"row justify-between"},vg={key:0,class:"text-overline"},yg={class:"col-11 text-h6"},wg={class:"col-1 text-right"},Sg={class:"column justify-between"},Tg={class:"col"},Eg={key:0},bg={class:"prep-table"},Ig=Y("thead",null,[Y("tr",null,[Y("th",{class:"text-left"},"Mno\u017Estv\xED"),Y("th",{class:"text-left"},"Teplota"),Y("th",{class:"text-left"},"Opl\xE1chnout"),Y("th",{class:"text-left"},"1."),Y("th",{class:"text-left"},"2."),Y("th",{class:"text-left"},"3."),Y("th",{class:"text-left"},"4."),Y("th",{class:"text-left"},"5.")])],-1),Cg={key:0},kg=Y("td",null,null,-1),Ag=Y("td",null,null,-1),xg=Y("td",null,null,-1),Dg=Y("td",null,null,-1),_g=Y("td",null,null,-1),Ng=Y("td",null,null,-1),Vg=Y("td",null,null,-1),Rg=Y("td",null,null,-1),Lg=[kg,Ag,xg,Dg,_g,Ng,Vg,Rg],Mg={key:1},Og={key:0},qg={key:0},Fg={key:0};function Pg(t,e,n,i,s,r){return he(),Rn(ka,{class:"q-ma-md tea-card"},{default:Ne(()=>[G(kn,{class:Tc(n.info.type)},{default:Ne(()=>[Y("div",pg,[n.info.archived?Ge("",!0):(he(),Le("div",vg,"Neni ve sbirce")),Y("div",yg,tt(n.info.name),1),Y("div",wg,[G(Cn,{icon:"fa-solid fa-pen-to-square",size:"sm",flat:"",round:"",onClick:e[0]||(e[0]=o=>t.$emit("showEditDialog"))})])]),Y("div",Sg,[Y("div",Tg,[bs(tt(n.info.pickingDate),1),n.info.pickingDate!=""&&n.info.origin!=""?(he(),Le("span",Eg,", ")):Ge("",!0),bs(tt(n.info.origin),1)])])]),_:1},8,["class"]),G(kn,{class:"pre-wrap"},{default:Ne(()=>[bs(tt(n.info.notes),1)]),_:1}),G(kn,null,{default:Ne(()=>[G(mg,{dense:"",class:"no-overflow"},{default:Ne(()=>[Y("table",bg,[Ig,Y("tbody",null,["preparation2"in n.info?Ge("",!0):(he(),Le("tr",Cg,Lg)),"preparation2"in n.info?(he(),Le("tr",Mg,[Y("td",null,[n.info.preparation2[0].amount!=""?(he(),Le("span",Og,tt(n.info.preparation2[0].amount)+" g / 100 ml",1)):Ge("",!0)]),Y("td",null,[n.info.preparation2[0].temperature!=""?(he(),Le("span",qg,tt(n.info.preparation2[0].temperature)+" \u02DAC",1)):Ge("",!0)]),Y("td",null,tt(n.info.preparation2[0].wash?"Ano":"Ne"),1),(he(),Le(Ia,null,Ca([0,1,2,3,4],o=>Y("td",{key:o},[n.info.preparation2[0].times[o]!=""?(he(),Le("span",Fg,tt(n.info.preparation2[0].times[o])+" s",1)):Ge("",!0)])),64))])):Ge("",!0)])])]),_:1})]),_:1})]),_:1})}var Ug=lr(gg,[["render",Pg]]),Bg=Ue({name:"QField",inheritAttrs:!1,props:ur,emits:Aa,setup(){return xa(Da())}});const $g={xs:8,sm:10,md:14,lg:20,xl:24};var jg=Ue({name:"QChip",props:{...ji,...Ec,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(t,{slots:e,emit:n}){const{proxy:{$q:i}}=pt(),s=Ki(t,i),r=bc(t,$g),o=I(()=>t.selected===!0||t.icon!==void 0),a=I(()=>t.selected===!0?t.iconSelected||i.iconSet.chip.selected:t.icon),l=I(()=>t.iconRemove||i.iconSet.chip.remove),u=I(()=>t.disable===!1&&(t.clickable===!0||t.selected!==null)),c=I(()=>{const w=t.outline===!0&&t.color||t.textColor;return"q-chip row inline no-wrap items-center"+(t.outline===!1&&t.color!==void 0?` bg-${t.color}`:"")+(w?` text-${w} q-chip--colored`:"")+(t.disable===!0?" disabled":"")+(t.dense===!0?" q-chip--dense":"")+(t.outline===!0?" q-chip--outline":"")+(t.selected===!0?" q-chip--selected":"")+(u.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(t.square===!0?" q-chip--square":"")+(s.value===!0?" q-chip--dark q-dark":"")}),d=I(()=>{const w=t.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:t.tabindex||0},R={...w,role:"button","aria-hidden":"false","aria-label":t.removeAriaLabel||i.lang.label.remove};return{chip:w,remove:R}});function m(w){w.keyCode===13&&f(w)}function f(w){t.disable||(n("update:selected",!t.selected),n("click",w))}function y(w){(w.keyCode===void 0||w.keyCode===13)&&(je(w),t.disable===!1&&(n("update:modelValue",!1),n("remove")))}function p(){const w=[];u.value===!0&&w.push(k("div",{class:"q-focus-helper"})),o.value===!0&&w.push(k(Wt,{class:"q-chip__icon q-chip__icon--left",name:a.value}));const R=t.label!==void 0?[k("div",{class:"ellipsis"},[t.label])]:void 0;return w.push(k("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},Cc(e.default,R))),t.iconRight&&w.push(k(Wt,{class:"q-chip__icon q-chip__icon--right",name:t.iconRight})),t.removable===!0&&w.push(k(Wt,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:l.value,...d.value.remove,onClick:y,onKeyup:y})),w}return()=>{if(t.modelValue===!1)return;const w={class:c.value,style:r.value};return u.value===!0&&Object.assign(w,d.value.chip,{onClick:f,onKeyup:m}),Ic("div",w,p(),"ripple",t.ripple!==!1&&t.disable!==!0,()=>[[kc,t.ripple]])}}}),Qu=Ue({name:"QItem",props:{...ji,...cr,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(t,{slots:e,emit:n}){const{proxy:{$q:i}}=pt(),s=Ki(t,i),{hasLink:r,linkAttrs:o,linkClass:a,linkTag:l,navigateOnClick:u}=Ac(),c=J(null),d=J(null),m=I(()=>t.clickable===!0||r.value===!0||t.tag==="label"),f=I(()=>t.disable!==!0&&m.value===!0),y=I(()=>"q-item q-item-type row no-wrap"+(t.dense===!0?" q-item--dense":"")+(s.value===!0?" q-item--dark":"")+(r.value===!0&&t.active===null?a.value:t.active===!0?` q-item--active${t.activeClass!==void 0?` ${t.activeClass}`:""}`:"")+(t.disable===!0?" disabled":"")+(f.value===!0?" q-item--clickable q-link cursor-pointer "+(t.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(t.focused===!0?" q-manual-focusable--focused":""):"")),p=I(()=>{if(t.insetLevel===void 0)return null;const _=i.lang.rtl===!0?"Right":"Left";return{["padding"+_]:16+t.insetLevel*56+"px"}});function w(_){f.value===!0&&(d.value!==null&&(_.qKeyEvent!==!0&&document.activeElement===c.value?d.value.focus():document.activeElement===d.value&&c.value.focus()),u(_))}function R(_){if(f.value===!0&&_a(_,13)===!0){je(_),_.qKeyEvent=!0;const M=new MouseEvent("click",_);M.qKeyEvent=!0,c.value.dispatchEvent(M)}n("keyup",_)}function N(){const _=xc(e.default,[]);return f.value===!0&&_.unshift(k("div",{class:"q-focus-helper",tabindex:-1,ref:d})),_}return()=>{const _={ref:c,class:y.value,style:p.value,role:"listitem",onClick:w,onKeyup:R};return f.value===!0?(_.tabindex=t.tabindex||"0",Object.assign(_,o.value)):m.value===!0&&(_["aria-disabled"]="true"),k(l.value,_,N())}}}),Ai=Ue({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(t,{slots:e}){const n=I(()=>`q-item__section column q-item__section--${t.avatar===!0||t.side===!0||t.thumbnail===!0?"side":"main"}`+(t.top===!0?" q-item__section--top justify-start":" justify-center")+(t.avatar===!0?" q-item__section--avatar":"")+(t.thumbnail===!0?" q-item__section--thumbnail":"")+(t.noWrap===!0?" q-item__section--nowrap":""));return()=>k("div",{class:n.value},ln(e.default))}}),ar=Ue({name:"QItemLabel",props:{overline:Boolean,caption:Boolean,header:Boolean,lines:[Number,String]},setup(t,{slots:e}){const n=I(()=>parseInt(t.lines,10)),i=I(()=>"q-item__label"+(t.overline===!0?" q-item__label--overline text-overline":"")+(t.caption===!0?" q-item__label--caption text-caption":"")+(t.header===!0?" q-item__label--header":"")+(n.value===1?" ellipsis":"")),s=I(()=>t.lines!==void 0&&n.value>1?{overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":n.value}:null);return()=>k("div",{style:s.value,class:i.value},ln(e.default))}});const Ke=1e3,Kg=["start","center","end","start-force","center-force","end-force"],Gu=Array.prototype.filter,zg=window.getComputedStyle(document.body).overflowAnchor===void 0?Dc:function(t,e){t!==null&&(cancelAnimationFrame(t._qOverflowAnimationFrame),t._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(t===null)return;const n=t.children||[];Gu.call(n,s=>s.dataset&&s.dataset.qVsAnchor!==void 0).forEach(s=>{delete s.dataset.qVsAnchor});const i=n[e];i&&i.dataset&&(i.dataset.qVsAnchor="")}))};function Jt(t,e){return t+e}function Ms(t,e,n,i,s,r,o,a){const l=t===window?document.scrollingElement||document.documentElement:t,u=s===!0?"offsetWidth":"offsetHeight",c={scrollStart:0,scrollViewSize:-o-a,scrollMaxSize:0,offsetStart:-o,offsetEnd:-a};if(s===!0?(t===window?(c.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,c.scrollViewSize+=document.documentElement.clientWidth):(c.scrollStart=l.scrollLeft,c.scrollViewSize+=l.clientWidth),c.scrollMaxSize=l.scrollWidth,r===!0&&(c.scrollStart=(qs===!0?c.scrollMaxSize-c.scrollViewSize:0)-c.scrollStart)):(t===window?(c.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,c.scrollViewSize+=document.documentElement.clientHeight):(c.scrollStart=l.scrollTop,c.scrollViewSize+=l.clientHeight),c.scrollMaxSize=l.scrollHeight),n!==null)for(let d=n.previousElementSibling;d!==null;d=d.previousElementSibling)d.classList.contains("q-virtual-scroll--skip")===!1&&(c.offsetStart+=d[u]);if(i!==null)for(let d=i.nextElementSibling;d!==null;d=d.nextElementSibling)d.classList.contains("q-virtual-scroll--skip")===!1&&(c.offsetEnd+=d[u]);if(e!==t){const d=l.getBoundingClientRect(),m=e.getBoundingClientRect();s===!0?(c.offsetStart+=m.left-d.left,c.offsetEnd-=m.width):(c.offsetStart+=m.top-d.top,c.offsetEnd-=m.height),t!==window&&(c.offsetStart+=c.scrollStart),c.offsetEnd+=c.scrollMaxSize-c.offsetStart}return c}function Sa(t,e,n,i){e==="end"&&(e=(t===window?document.body:t)[n===!0?"scrollWidth":"scrollHeight"]),t===window?n===!0?(i===!0&&(e=(qs===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-e),window.scrollTo(e,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,e):n===!0?(i===!0&&(e=(qs===!0?t.scrollWidth-t.offsetWidth:0)-e),t.scrollLeft=e):t.scrollTop=e}function Sn(t,e,n,i){if(n>=i)return 0;const s=e.length,r=Math.floor(n/Ke),o=Math.floor((i-1)/Ke)+1;let a=t.slice(r,o).reduce(Jt,0);return n%Ke!==0&&(a-=e.slice(r*Ke,n).reduce(Jt,0)),i%Ke!==0&&i!==s&&(a-=e.slice(i,o*Ke).reduce(Jt,0)),a}const Hg={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},Qg={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...Hg};function Gg({virtualScrollLength:t,getVirtualScrollTarget:e,getVirtualScrollEl:n,virtualScrollItemSizeComputed:i}){const s=pt(),{props:r,emit:o,proxy:a}=s,{$q:l}=a;let u,c,d,m=[],f;const y=J(0),p=J(0),w=J({}),R=J(null),N=J(null),_=J(null),M=J({from:0,to:0}),B=I(()=>r.tableColspan!==void 0?r.tableColspan:100);i===void 0&&(i=I(()=>r.virtualScrollItemSize));const Se=I(()=>i.value+";"+r.virtualScrollHorizontal),Ve=I(()=>Se.value+";"+r.virtualScrollSliceRatioBefore+";"+r.virtualScrollSliceRatioAfter);it(Ve,()=>{He()}),it(Se,Je);function Je(){et(c,!0)}function wt(E){et(E===void 0?c:E)}function Ze(E,V){const U=e();if(U==null||U.nodeType===8)return;const ne=Ms(U,n(),R.value,N.value,r.virtualScrollHorizontal,l.lang.rtl,r.virtualScrollStickySizeStart,r.virtualScrollStickySizeEnd);d!==ne.scrollViewSize&&He(ne.scrollViewSize),ct(U,ne,Math.min(t.value-1,Math.max(0,parseInt(E,10)||0)),0,Kg.indexOf(V)>-1?V:c>-1&&E>c?"end":"start")}function Re(){const E=e();if(E==null||E.nodeType===8)return;const V=Ms(E,n(),R.value,N.value,r.virtualScrollHorizontal,l.lang.rtl,r.virtualScrollStickySizeStart,r.virtualScrollStickySizeEnd),U=t.value-1,ne=V.scrollMaxSize-V.offsetStart-V.offsetEnd-p.value;if(u===V.scrollStart)return;if(V.scrollMaxSize<=0){ct(E,V,0,0);return}d!==V.scrollViewSize&&He(V.scrollViewSize),St(M.value.from);const me=Math.floor(V.scrollMaxSize-Math.max(V.scrollViewSize,V.offsetEnd)-Math.min(f[U],V.scrollViewSize/2));if(me>0&&Math.ceil(V.scrollStart)>=me){ct(E,V,U,V.scrollMaxSize-V.offsetEnd-m.reduce(Jt,0));return}let Q=0,$=V.scrollStart-V.offsetStart,Te=$;if($<=ne&&$+V.scrollViewSize>=y.value)$-=y.value,Q=M.value.from,Te=$;else for(let K=0;$>=m[K]&&Q<U;K++)$-=m[K],Q+=Ke;for(;$>0&&Q<U;)$-=f[Q],$>-V.scrollViewSize?(Q++,Te=$):Te=f[Q]+$;ct(E,V,Q,Te)}function ct(E,V,U,ne,me){const Q=typeof me=="string"&&me.indexOf("-force")>-1,$=Q===!0?me.replace("-force",""):me,Te=$!==void 0?$:"start";let K=Math.max(0,U-w.value[Te]),qe=K+w.value.total;qe>t.value&&(qe=t.value,K=Math.max(0,qe-w.value.total)),u=V.scrollStart;const Et=K!==M.value.from||qe!==M.value.to;if(Et===!1&&$===void 0){Ae(U);return}const{activeElement:gn}=document,Qe=_.value;Et===!0&&Qe!==null&&Qe!==gn&&Qe.contains(gn)===!0&&(Qe.addEventListener("focusout",Tt),setTimeout(()=>{Qe!==null&&Qe.removeEventListener("focusout",Tt)})),zg(Qe,U-K);const ci=$!==void 0?f.slice(K,U).reduce(Jt,0):0;if(Et===!0){const qt=qe>=M.value.from&&K<=M.value.to?M.value.to:qe;M.value={from:K,to:qt},y.value=Sn(m,f,0,K),p.value=Sn(m,f,qe,t.value),requestAnimationFrame(()=>{M.value.to!==qe&&u===V.scrollStart&&(M.value={from:M.value.from,to:qe},p.value=Sn(m,f,qe,t.value))})}requestAnimationFrame(()=>{if(u!==V.scrollStart)return;Et===!0&&St(K);const qt=f.slice(K,U).reduce(Jt,0),Ft=qt+V.offsetStart+y.value,hi=Ft+f[U];let pn=Ft+ne;if($!==void 0){const Fe=qt-ci,ge=V.scrollStart+Fe;pn=Q!==!0&&ge<Ft&&hi<ge+V.scrollViewSize?ge:$==="end"?hi-V.scrollViewSize:Ft-($==="start"?0:Math.round((V.scrollViewSize-f[U])/2))}u=pn,Sa(E,pn,r.virtualScrollHorizontal,l.lang.rtl),Ae(U)})}function St(E){const V=_.value;if(V){const U=Gu.call(V.children,K=>K.classList&&K.classList.contains("q-virtual-scroll--skip")===!1),ne=U.length,me=r.virtualScrollHorizontal===!0?K=>K.getBoundingClientRect().width:K=>K.offsetHeight;let Q=E,$,Te;for(let K=0;K<ne;){for($=me(U[K]),K++;K<ne&&U[K].classList.contains("q-virtual-scroll--with-prev")===!0;)$+=me(U[K]),K++;Te=$-f[Q],Te!==0&&(f[Q]+=Te,m[Math.floor(Q/Ke)]+=Te),Q++}}}function Tt(){_.value!==null&&_.value!==void 0&&_.value.focus()}function et(E,V){const U=1*i.value;(V===!0||Array.isArray(f)===!1)&&(f=[]);const ne=f.length;f.length=t.value;for(let Q=t.value-1;Q>=ne;Q--)f[Q]=U;const me=Math.floor((t.value-1)/Ke);m=[];for(let Q=0;Q<=me;Q++){let $=0;const Te=Math.min((Q+1)*Ke,t.value);for(let K=Q*Ke;K<Te;K++)$+=f[K];m.push($)}c=-1,u=void 0,y.value=Sn(m,f,0,M.value.from),p.value=Sn(m,f,M.value.to,t.value),E>=0?(St(M.value.from),nt(()=>{Ze(E)})):Be()}function He(E){if(E===void 0&&typeof window!="undefined"){const $=e();$!=null&&$.nodeType!==8&&(E=Ms($,n(),R.value,N.value,r.virtualScrollHorizontal,l.lang.rtl,r.virtualScrollStickySizeStart,r.virtualScrollStickySizeEnd).scrollViewSize)}d=E;const V=parseFloat(r.virtualScrollSliceRatioBefore)||0,U=parseFloat(r.virtualScrollSliceRatioAfter)||0,ne=1+V+U,me=E===void 0||E<=0?1:Math.ceil(E/i.value),Q=Math.max(1,me,Math.ceil((r.virtualScrollSliceSize>0?r.virtualScrollSliceSize:10)/ne));w.value={total:Math.ceil(Q*ne),start:Math.ceil(Q*V),center:Math.ceil(Q*(.5+V)),end:Math.ceil(Q*(1+V)),view:me}}function P(E,V){const U=r.virtualScrollHorizontal===!0?"width":"height",ne={["--q-virtual-scroll-item-"+U]:i.value+"px"};return[E==="tbody"?k(E,{class:"q-virtual-scroll__padding",key:"before",ref:R},[k("tr",[k("td",{style:{[U]:`${y.value}px`,...ne},colspan:B.value})])]):k(E,{class:"q-virtual-scroll__padding",key:"before",ref:R,style:{[U]:`${y.value}px`,...ne}}),k(E,{class:"q-virtual-scroll__content",key:"content",ref:_,tabindex:-1},V.flat()),E==="tbody"?k(E,{class:"q-virtual-scroll__padding",key:"after",ref:N},[k("tr",[k("td",{style:{[U]:`${p.value}px`,...ne},colspan:B.value})])]):k(E,{class:"q-virtual-scroll__padding",key:"after",ref:N,style:{[U]:`${p.value}px`,...ne}})]}function Ae(E){c!==E&&(r.onVirtualScroll!==void 0&&o("virtualScroll",{index:E,from:M.value.from,to:M.value.to-1,direction:E<c?"decrease":"increase",ref:a}),c=E)}He();const Be=_c(Re,l.platform.is.ios===!0?120:35);Nc(()=>{He()});let b=!1;return Na(()=>{b=!0}),Va(()=>{if(b!==!0)return;const E=e();u!==void 0&&E!==void 0&&E!==null&&E.nodeType!==8?Sa(E,u,r.virtualScrollHorizontal,l.lang.rtl):Ze(c)}),zi(()=>{Be.cancel()}),Object.assign(a,{scrollTo:Ze,reset:Je,refresh:wt}),{virtualScrollSliceRange:M,virtualScrollSliceSizeComputed:w,setVirtualScrollSize:He,onVirtualScrollEvt:Be,localResetVirtualScroll:et,padVirtualScroll:P,scrollTo:Ze,reset:Je,refresh:wt}}function Ta(t,e,n){if(n<=e)return e;const i=n-e+1;let s=e+(t-e)%i;return s<e&&(s=i+s),s===0?0:s}const Ea=t=>["add","add-unique","toggle"].includes(t),Wg=".*+?^${}()|[]\\",Xg=Object.keys(ur);var Yg=Ue({name:"QSelect",inheritAttrs:!1,props:{...Qg,...Vc,...ur,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:Ea},mapOptions:Boolean,emitValue:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:String,transitionHide:String,transitionDuration:[String,Number],behavior:{type:String,validator:t=>["default","menu","dialog"].includes(t),default:"default"},virtualScrollItemSize:{type:[Number,String],default:void 0},onNewValue:Function,onFilter:Function},emits:[...Aa,"add","remove","inputValue","newValue","keyup","keypress","keydown","filterAbort"],setup(t,{slots:e,emit:n}){const{proxy:i}=pt(),{$q:s}=i,r=J(!1),o=J(!1),a=J(-1),l=J(""),u=J(!1),c=J(!1);let d,m,f,y,p,w,R,N,_;const M=J(null),B=J(null),Se=J(null),Ve=J(null),Je=J(null),wt=Rc(t),Ze=Oc(mo),Re=I(()=>Array.isArray(t.options)?t.options.length:0),ct=I(()=>t.virtualScrollItemSize===void 0?t.optionsDense===!0?24:48:t.virtualScrollItemSize),{virtualScrollSliceRange:St,virtualScrollSliceSizeComputed:Tt,localResetVirtualScroll:et,padVirtualScroll:He,onVirtualScrollEvt:P,scrollTo:Ae,setVirtualScrollSize:Be}=Gg({virtualScrollLength:Re,getVirtualScrollTarget:Ju,getVirtualScrollEl:ho,virtualScrollItemSizeComputed:ct}),b=Da(),E=I(()=>{const h=t.mapOptions===!0&&t.multiple!==!0,T=t.modelValue!==void 0&&(t.modelValue!==null||h===!0)?t.multiple===!0&&Array.isArray(t.modelValue)?t.modelValue:[t.modelValue]:[];if(t.mapOptions===!0&&Array.isArray(t.options)===!0){const S=t.mapOptions===!0&&m!==void 0?m:[],O=T.map(Z=>Yu(Z,S));return t.modelValue===null&&h===!0?O.filter(Z=>Z!==null):O}return T}),V=I(()=>{const h={};return Xg.forEach(T=>{const S=t[T];S!==void 0&&(h[T]=S)}),h}),U=I(()=>t.optionsDark===null?b.isDark.value:t.optionsDark),ne=I(()=>To(E.value)),me=I(()=>{let h="q-field__input q-placeholder col";return t.hideSelected===!0||E.value.length===0?[h,t.inputClass]:(h+=" q-field__input--padding",t.inputClass===void 0?h:[h,t.inputClass])}),Q=I(()=>(t.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(t.popupContentClass?" "+t.popupContentClass:"")),$=I(()=>Re.value===0),Te=I(()=>E.value.map(h=>ge.value(h)).join(", ")),K=I(()=>t.optionsHtml===!0?()=>!0:h=>h!=null&&h.html===!0),qe=I(()=>t.displayValueHtml===!0||t.displayValue===void 0&&(t.optionsHtml===!0||E.value.some(K.value))),Et=I(()=>b.focused.value===!0?t.tabindex:-1),gn=I(()=>({tabindex:t.tabindex,role:"combobox","aria-label":t.label,"aria-readonly":t.readonly===!0?"true":"false","aria-autocomplete":t.useInput===!0?"list":"none","aria-expanded":r.value===!0?"true":"false","aria-owns":`${b.targetUid.value}_lb`,"aria-controls":`${b.targetUid.value}_lb`})),Qe=I(()=>{const h={id:`${b.targetUid.value}_lb`,role:"listbox","aria-multiselectable":t.multiple===!0?"true":"false"};return a.value>=0&&(h["aria-activedescendant"]=`${b.targetUid.value}_${a.value}`),h}),ci=I(()=>E.value.map((h,T)=>({index:T,opt:h,html:K.value(h),selected:!0,removeAtIndex:Xu,toggleOption:bt,tabindex:Et.value}))),qt=I(()=>{if(Re.value===0)return[];const{from:h,to:T}=St.value;return t.options.slice(h,T).map((S,O)=>{const Z=Pt.value(S)===!0,X=h+O,re={clickable:!0,active:!1,activeClass:pn.value,manualFocus:!0,focused:!1,disable:Z,tabindex:-1,dense:t.optionsDense,dark:U.value,role:"option",id:`${b.targetUid.value}_${X}`,onClick:()=>{bt(S)}};return Z!==!0&&(ws(S)===!0&&(re.active=!0),a.value===X&&(re.focused=!0),re["aria-selected"]=re.active===!0?"true":"false",s.platform.is.desktop===!0&&(re.onMousemove=()=>{r.value===!0&&Ut(X)})),{index:X,opt:S,html:K.value(S),label:ge.value(S),selected:re.active,focused:re.focused,toggleOption:bt,setOptionIndex:Ut,itemProps:re}})}),Ft=I(()=>t.dropdownIcon!==void 0?t.dropdownIcon:s.iconSet.arrow.dropdown),hi=I(()=>t.optionsCover===!1&&t.outlined!==!0&&t.standout!==!0&&t.borderless!==!0&&t.rounded!==!0),pn=I(()=>t.optionsSelectedClass!==void 0?t.optionsSelectedClass:t.color!==void 0?`text-${t.color}`:""),Fe=I(()=>ys(t.optionValue,"value")),ge=I(()=>ys(t.optionLabel,"label")),Pt=I(()=>ys(t.optionDisable,"disable")),di=I(()=>E.value.map(h=>Fe.value(h))),Wu=I(()=>{const h={onInput:mo,onChange:Ze,onKeydown:co,onKeyup:lo,onKeypress:uo,onFocus:oo,onClick(T){f===!0&&zt(T)}};return h.onCompositionstart=h.onCompositionupdate=h.onCompositionend=Ze,h});it(E,h=>{m=h,t.useInput===!0&&t.fillInput===!0&&t.multiple!==!0&&b.innerLoading.value!==!0&&(o.value!==!0&&r.value!==!0||ne.value!==!0)&&(y!==!0&&Kt(),(o.value===!0||r.value===!0)&&Bt(""))},{immediate:!0}),it(()=>t.fillInput,Kt),it(r,Ss),it(Re,cc);function so(h){return t.emitValue===!0?Fe.value(h):h}function vs(h){if(h>-1&&h<E.value.length)if(t.multiple===!0){const T=t.modelValue.slice();n("remove",{index:h,value:T.splice(h,1)[0]}),n("update:modelValue",T)}else n("update:modelValue",null)}function Xu(h){vs(h),b.focus()}function ro(h,T){const S=so(h);if(t.multiple!==!0){t.fillInput===!0&&vn(ge.value(h),!0,!0),n("update:modelValue",S);return}if(E.value.length===0){n("add",{index:0,value:S}),n("update:modelValue",t.multiple===!0?[S]:S);return}if(T===!0&&ws(h)===!0||t.maxValues!==void 0&&t.modelValue.length>=t.maxValues)return;const O=t.modelValue.slice();n("add",{index:O.length,value:S}),O.push(S),n("update:modelValue",O)}function bt(h,T){if(b.editable.value!==!0||h===void 0||Pt.value(h)===!0)return;const S=Fe.value(h);if(t.multiple!==!0){T!==!0&&(vn(t.fillInput===!0?ge.value(h):"",!0,!0),It()),B.value!==null&&B.value.focus(),(E.value.length===0||yn(Fe.value(E.value[0]),S)!==!0)&&n("update:modelValue",t.emitValue===!0?S:h);return}if((f!==!0||u.value===!0)&&b.focus(),oo(),E.value.length===0){const X=t.emitValue===!0?S:h;n("add",{index:0,value:X}),n("update:modelValue",t.multiple===!0?[X]:X);return}const O=t.modelValue.slice(),Z=di.value.findIndex(X=>yn(X,S));if(Z>-1)n("remove",{index:Z,value:O.splice(Z,1)[0]});else{if(t.maxValues!==void 0&&O.length>=t.maxValues)return;const X=t.emitValue===!0?S:h;n("add",{index:O.length,value:X}),O.push(X)}n("update:modelValue",O)}function Ut(h){if(s.platform.is.desktop!==!0)return;const T=h>-1&&h<Re.value?h:-1;a.value!==T&&(a.value=T)}function fi(h=1,T){if(r.value===!0){let S=a.value;do S=Ta(S+h,-1,Re.value-1);while(S!==-1&&S!==a.value&&Pt.value(t.options[S])===!0);a.value!==S&&(Ut(S),Ae(S),T!==!0&&t.useInput===!0&&t.fillInput===!0&&mi(S>=0?ge.value(t.options[S]):w))}}function Yu(h,T){const S=O=>yn(Fe.value(O),h);return t.options.find(S)||T.find(S)||h}function ys(h,T){const S=h!==void 0?h:T;return typeof S=="function"?S:O=>O!==null&&typeof O=="object"&&S in O?O[S]:O}function ws(h){const T=Fe.value(h);return di.value.find(S=>yn(S,T))!==void 0}function oo(h){t.useInput===!0&&B.value!==null&&(h===void 0||B.value===h.target&&h.target.value===Te.value)&&B.value.select()}function ao(h){_a(h,27)===!0&&r.value===!0&&(zt(h),It(),Kt()),n("keyup",h)}function lo(h){const{value:T}=h.target;if(h.keyCode!==void 0){ao(h);return}if(h.target.value="",clearTimeout(d),Kt(),typeof T=="string"&&T.length>0){const S=T.toLocaleLowerCase(),O=X=>{const re=t.options.find(xe=>X.value(xe).toLocaleLowerCase()===S);return re===void 0?!1:(E.value.indexOf(re)===-1?bt(re):It(),!0)},Z=X=>{O(Fe)!==!0&&(O(ge)===!0||X===!0||Bt(T,!0,()=>Z(!0)))};Z()}else b.clearValue(h)}function uo(h){n("keypress",h)}function co(h){if(n("keydown",h),qc(h)===!0)return;const T=l.value.length>0&&(t.newValueMode!==void 0||t.onNewValue!==void 0),S=h.shiftKey!==!0&&t.multiple!==!0&&(a.value>-1||T===!0);if(h.keyCode===27){Is(h);return}if(h.keyCode===9&&S===!1){$t();return}if(h.target===void 0||h.target.id!==b.targetUid.value)return;if(h.keyCode===40&&b.innerLoading.value!==!0&&r.value===!1){je(h),jt();return}if(h.keyCode===8&&t.hideSelected!==!0&&l.value.length===0){t.multiple===!0&&Array.isArray(t.modelValue)===!0?vs(t.modelValue.length-1):t.multiple!==!0&&t.modelValue!==null&&n("update:modelValue",null);return}(h.keyCode===35||h.keyCode===36)&&(typeof l.value!="string"||l.value.length===0)&&(je(h),a.value=-1,fi(h.keyCode===36?1:-1,t.multiple)),(h.keyCode===33||h.keyCode===34)&&Tt.value!==void 0&&(je(h),a.value=Math.max(-1,Math.min(Re.value,a.value+(h.keyCode===33?-1:1)*Tt.value.view)),fi(h.keyCode===33?1:-1,t.multiple)),(h.keyCode===38||h.keyCode===40)&&(je(h),fi(h.keyCode===38?-1:1,t.multiple));const O=Re.value;if((N===void 0||_<Date.now())&&(N=""),O>0&&t.useInput!==!0&&h.key!==void 0&&h.key.length===1&&h.altKey===h.ctrlKey&&(h.keyCode!==32||N.length>0)){r.value!==!0&&jt(h);const Z=h.key.toLocaleLowerCase(),X=N.length===1&&N[0]===Z;_=Date.now()+1500,X===!1&&(je(h),N+=Z);const re=new RegExp("^"+N.split("").map(Ts=>Wg.indexOf(Ts)>-1?"\\"+Ts:Ts).join(".*"),"i");let xe=a.value;if(X===!0||xe<0||re.test(ge.value(t.options[xe]))!==!0)do xe=Ta(xe+1,-1,O-1);while(xe!==a.value&&(Pt.value(t.options[xe])===!0||re.test(ge.value(t.options[xe]))!==!0));a.value!==xe&&nt(()=>{Ut(xe),Ae(xe),xe>=0&&t.useInput===!0&&t.fillInput===!0&&mi(ge.value(t.options[xe]))});return}if(!(h.keyCode!==13&&(h.keyCode!==32||t.useInput===!0||N!=="")&&(h.keyCode!==9||S===!1))){if(h.keyCode!==9&&je(h),a.value>-1&&a.value<O){bt(t.options[a.value]);return}if(T===!0){const Z=(X,re)=>{if(re){if(Ea(re)!==!0)return}else re=t.newValueMode;if(X==null)return;vn("",t.multiple!==!0,!0),(re==="toggle"?bt:ro)(X,re==="add-unique"),t.multiple!==!0&&(B.value!==null&&B.value.focus(),It())};if(t.onNewValue!==void 0?n("newValue",l.value,Z):Z(l.value),t.multiple!==!0)return}r.value===!0?$t():b.innerLoading.value!==!0&&jt()}}function ho(){return f===!0?Je.value:Se.value!==null&&Se.value.contentEl!==null?Se.value.contentEl:void 0}function Ju(){return ho()}function Zu(){return t.hideSelected===!0?[]:e["selected-item"]!==void 0?ci.value.map(h=>e["selected-item"](h)).slice():e.selected!==void 0?[].concat(e.selected()):t.useChips===!0?ci.value.map((h,T)=>k(jg,{key:"option-"+T,removable:b.editable.value===!0&&Pt.value(h.opt)!==!0,dense:!0,textColor:t.color,tabindex:Et.value,onRemove(){h.removeAtIndex(T)}},()=>k("span",{class:"ellipsis",[h.html===!0?"innerHTML":"textContent"]:ge.value(h.opt)}))):[k("span",{[qe.value===!0?"innerHTML":"textContent"]:t.displayValue!==void 0?t.displayValue:Te.value})]}function fo(){if($.value===!0)return e["no-option"]!==void 0?e["no-option"]({inputValue:l.value}):void 0;const h=e.option!==void 0?e.option:S=>k(Qu,{key:S.index,...S.itemProps},()=>k(Ai,()=>k(ar,()=>k("span",{[S.html===!0?"innerHTML":"textContent"]:S.label}))));let T=He("div",qt.value.map(h));return e["before-options"]!==void 0&&(T=e["before-options"]().concat(T)),Fc(e["after-options"],T)}function ec(h,T){const S=T===!0?{...gn.value,...b.splitAttrs.attributes.value}:void 0,O={ref:T===!0?B:void 0,key:"i_t",class:me.value,style:t.inputStyle,value:l.value!==void 0?l.value:"",type:"search",...S,id:T===!0?b.targetUid.value:void 0,maxlength:t.maxlength,autocomplete:t.autocomplete,"data-autofocus":h!==!0&&t.autofocus===!0||void 0,disabled:t.disable===!0,readonly:t.readonly===!0,...Wu.value};return h!==!0&&f===!0&&(Array.isArray(O.class)===!0?O.class=[...O.class,"no-pointer-events"]:O.class+=" no-pointer-events"),k("input",O)}function mo(h){clearTimeout(d),!(h&&h.target&&h.target.qComposing===!0)&&(mi(h.target.value||""),y=!0,w=l.value,b.focused.value!==!0&&(f!==!0||u.value===!0)&&b.focus(),t.onFilter!==void 0&&(d=setTimeout(()=>{Bt(l.value)},t.inputDebounce)))}function mi(h){l.value!==h&&(l.value=h,n("inputValue",h))}function vn(h,T,S){y=S!==!0,t.useInput===!0&&(mi(h),(T===!0||S!==!0)&&(w=h),T!==!0&&Bt(h))}function Bt(h,T,S){if(t.onFilter===void 0||T!==!0&&b.focused.value!==!0)return;b.innerLoading.value===!0?n("filterAbort"):(b.innerLoading.value=!0,c.value=!0),h!==""&&t.multiple!==!0&&E.value.length>0&&y!==!0&&h===ge.value(E.value[0])&&(h="");const O=setTimeout(()=>{r.value===!0&&(r.value=!1)},10);clearTimeout(p),p=O,n("filter",h,(Z,X)=>{(T===!0||b.focused.value===!0)&&p===O&&(clearTimeout(p),typeof Z=="function"&&Z(),c.value=!1,nt(()=>{b.innerLoading.value=!1,b.editable.value===!0&&(T===!0?r.value===!0&&It():r.value===!0?Ss(!0):r.value=!0),typeof X=="function"&&nt(()=>{X(i)}),typeof S=="function"&&nt(()=>{S(i)})}))},()=>{b.focused.value===!0&&p===O&&(clearTimeout(p),b.innerLoading.value=!1,c.value=!1),r.value===!0&&(r.value=!1)})}function tc(){return k(Zc,{ref:Se,class:Q.value,style:t.popupContentStyle,modelValue:r.value,fit:t.menuShrink!==!0,cover:t.optionsCover===!0&&$.value!==!0&&t.useInput!==!0,anchor:t.menuAnchor,self:t.menuSelf,offset:t.menuOffset,dark:U.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,square:hi.value,transitionShow:t.transitionShow,transitionHide:t.transitionHide,transitionDuration:t.transitionDuration,separateClosePopup:!0,...Qe.value,onScrollPassive:P,onBeforeShow:po,onBeforeHide:nc,onShow:ic},fo)}function nc(h){vo(h),$t()}function ic(){Be()}function sc(h){zt(h),B.value!==null&&B.value.focus(),u.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function rc(h){zt(h),nt(()=>{u.value=!1})}function oc(){const h=[k(Bg,{class:`col-auto ${b.fieldClass.value}`,...V.value,for:b.targetUid.value,dark:U.value,square:!0,loading:c.value,itemAligned:!1,filled:!0,stackLabel:l.value.length>0,...b.splitAttrs.listeners.value,onFocus:sc,onBlur:rc},{...e,rawControl:()=>b.getControl(!0),before:void 0,after:void 0})];return r.value===!0&&h.push(k("div",{ref:Je,class:Q.value+" scroll",style:t.popupContentStyle,...Qe.value,onClick:Is,onScrollPassive:P},fo())),k(Ra,{ref:Ve,modelValue:o.value,position:t.useInput===!0?"top":void 0,transitionShow:R,transitionHide:t.transitionHide,transitionDuration:t.transitionDuration,onBeforeShow:po,onBeforeHide:ac,onHide:lc,onShow:uc},()=>k("div",{class:"q-select__dialog"+(U.value===!0?" q-select__dialog--dark q-dark":"")+(u.value===!0?" q-select__dialog--focused":"")},h))}function ac(h){vo(h),Ve.value!==null&&Ve.value.__updateRefocusTarget(b.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),b.focused.value=!1}function lc(h){It(),b.focused.value===!1&&n("blur",h),Kt()}function uc(){const h=document.activeElement;(h===null||h.id!==b.targetUid.value)&&B.value!==null&&B.value!==h&&B.value.focus(),Be()}function $t(){o.value!==!0&&(a.value=-1,r.value===!0&&(r.value=!1),b.focused.value===!1&&(clearTimeout(p),p=void 0,b.innerLoading.value===!0&&(n("filterAbort"),b.innerLoading.value=!1,c.value=!1)))}function jt(h){b.editable.value===!0&&(f===!0?(b.onControlFocusin(h),o.value=!0,nt(()=>{b.focus()})):b.focus(),t.onFilter!==void 0?Bt(l.value):($.value!==!0||e["no-option"]!==void 0)&&(r.value=!0))}function It(){o.value=!1,$t()}function Kt(){t.useInput===!0&&vn(t.multiple!==!0&&t.fillInput===!0&&E.value.length>0&&ge.value(E.value[0])||"",!0,!0)}function Ss(h){let T=-1;if(h===!0){if(E.value.length>0){const S=Fe.value(E.value[0]);T=t.options.findIndex(O=>yn(Fe.value(O),S))}et(T)}Ut(T)}function cc(h,T){r.value===!0&&b.innerLoading.value===!1&&(et(-1,!0),nt(()=>{r.value===!0&&b.innerLoading.value===!1&&(h>T?et():Ss(!0))}))}function go(){o.value===!1&&Se.value!==null&&Se.value.updatePosition()}function po(h){h!==void 0&&zt(h),n("popupShow",h),b.hasPopupOpen=!0,b.onControlFocusin(h)}function vo(h){h!==void 0&&zt(h),n("popupHide",h),b.hasPopupOpen=!1,b.onControlFocusout(h)}function yo(){f=s.platform.is.mobile!==!0&&t.behavior!=="dialog"?!1:t.behavior!=="menu"&&(t.useInput===!0?e["no-option"]!==void 0||t.onFilter!==void 0||$.value===!1:!0),R=s.platform.is.ios===!0&&f===!0&&t.useInput===!0?"fade":t.transitionShow}return Lc(yo),Mc(go),yo(),zi(()=>{clearTimeout(d)}),Object.assign(i,{showPopup:jt,hidePopup:It,removeAtIndex:vs,add:ro,toggleOption:bt,getOptionIndex:()=>a.value,setOptionIndex:Ut,moveOptionSelection:fi,filter:Bt,updateMenuPosition:go,updateInputValue:vn,isOptionSelected:ws,getEmittingOptionValue:so,isOptionDisabled:(...h)=>Pt.value.apply(null,h)===!0,getOptionValue:(...h)=>Fe.value.apply(null,h),getOptionLabel:(...h)=>ge.value.apply(null,h)}),Object.assign(b,{innerValue:E,fieldClass:I(()=>`q-select q-field--auto-height q-select--with${t.useInput!==!0?"out":""}-input q-select--with${t.useChips!==!0?"out":""}-chips q-select--${t.multiple===!0?"multiple":"single"}`),inputRef:M,targetRef:B,hasValue:ne,showPopup:jt,floatingLabel:I(()=>t.hideSelected!==!0&&ne.value===!0||typeof l.value=="number"||l.value.length>0||To(t.displayValue)),getControlChild:()=>{if(b.editable.value!==!1&&(o.value===!0||$.value!==!0||e["no-option"]!==void 0))return f===!0?oc():tc();b.hasPopupOpen===!0&&(b.hasPopupOpen=!1)},controlEvents:{onFocusin(h){b.onControlFocusin(h)},onFocusout(h){b.onControlFocusout(h,()=>{Kt(),$t()})},onClick(h){if(Is(h),f!==!0&&r.value===!0){$t(),B.value!==null&&B.value.focus();return}jt(h)}},getControl:h=>{const T=Zu(),S=h===!0||o.value!==!0||f!==!0;if(t.useInput===!0)T.push(ec(h,S));else if(b.editable.value===!0){const Z=S===!0?gn.value:void 0;T.push(k("input",{ref:S===!0?B:void 0,key:"d_t",class:"q-select__focus-target",id:S===!0?b.targetUid.value:void 0,readonly:!0,"data-autofocus":h!==!0&&t.autofocus===!0||void 0,...Z,onKeydown:co,onKeyup:ao,onKeypress:uo})),S===!0&&typeof t.autocomplete=="string"&&t.autocomplete.length>0&&T.push(k("input",{class:"q-select__autocomplete-input",autocomplete:t.autocomplete,tabindex:-1,onKeyup:lo}))}if(wt.value!==void 0&&t.disable!==!0&&di.value.length>0){const Z=di.value.map(X=>k("option",{value:X,selected:!0}));T.push(k("select",{class:"hidden",name:wt.value,multiple:t.multiple},Z))}const O=t.useInput===!0||S!==!0?void 0:b.splitAttrs.attributes.value;return k("div",{class:"q-field__native row items-center",...O},T)},getInnerAppend:()=>t.loading!==!0&&c.value!==!0&&t.hideDropdownIcon!==!0?[k(Wt,{class:"q-select__dropdown-icon"+(r.value===!0?" rotate-180":""),name:Ft.value})]:null}),xa(b)}}),Jg=Ue({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(t,{slots:e,emit:n}){let i=!1,s,r,o,a,l,u;function c(){s&&s(),s=null,i=!1,clearTimeout(o),clearTimeout(a),r!==void 0&&r.removeEventListener("transitionend",l),l=null}function d(p,w,R){p.style.overflowY="hidden",w!==void 0&&(p.style.height=`${w}px`),p.style.transition=`height ${t.duration}ms cubic-bezier(.25, .8, .50, 1)`,i=!0,s=R}function m(p,w){p.style.overflowY=null,p.style.height=null,p.style.transition=null,c(),w!==u&&n(w)}function f(p,w){let R=0;r=p,i===!0?(c(),R=p.offsetHeight===p.scrollHeight?0:void 0):u="hide",d(p,R,w),o=setTimeout(()=>{p.style.height=`${p.scrollHeight}px`,l=N=>{(Object(N)!==N||N.target===p)&&m(p,"show")},p.addEventListener("transitionend",l),a=setTimeout(l,t.duration*1.1)},100)}function y(p,w){let R;r=p,i===!0?c():(u="show",R=p.scrollHeight),d(p,R,w),o=setTimeout(()=>{p.style.height=0,l=N=>{(Object(N)!==N||N.target===p)&&m(p,"hide")},p.addEventListener("transitionend",l),a=setTimeout(l,t.duration*1.1)},100)}return zi(()=>{i===!0&&c()}),()=>k(Pc,{css:!1,appear:t.appear,onEnter:f,onLeave:y},e.default)}});const Ct=Uc({}),Zg=Object.keys(cr);var ep=Ue({name:"QExpansionItem",props:{...cr,...Bc,...ji,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:Number,headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[...$c,"click","afterShow","afterHide"],setup(t,{slots:e,emit:n}){const{proxy:{$q:i}}=pt(),s=Ki(t,i),r=J(t.modelValue!==null?t.modelValue:t.defaultOpened),o=J(null),a=Eo(),{show:l,hide:u,toggle:c}=jc({showing:r});let d,m;const f=I(()=>`q-expansion-item q-item-type q-expansion-item--${r.value===!0?"expanded":"collapsed"} q-expansion-item--${t.popup===!0?"popup":"standard"}`),y=I(()=>{if(t.contentInsetLevel===void 0)return null;const P=i.lang.rtl===!0?"Right":"Left";return{["padding"+P]:t.contentInsetLevel*56+"px"}}),p=I(()=>t.disable!==!0&&(t.href!==void 0||t.to!==void 0&&t.to!==null&&t.to!=="")),w=I(()=>{const P={};return Zg.forEach(Ae=>{P[Ae]=t[Ae]}),P}),R=I(()=>p.value===!0||t.expandIconToggle!==!0),N=I(()=>t.expandedIcon!==void 0&&r.value===!0?t.expandedIcon:t.expandIcon||i.iconSet.expansionItem[t.denseToggle===!0?"denseIcon":"icon"]),_=I(()=>t.disable!==!0&&(p.value===!0||t.expandIconToggle===!0)),M=I(()=>({expanded:r.value===!0,detailsId:t.targetUid,toggle:c,show:l,hide:u})),B=I(()=>{const P=t.toggleAriaLabel!==void 0?t.toggleAriaLabel:i.lang.label[r.value===!0?"collapse":"expand"](t.label);return{role:"button","aria-expanded":r.value===!0?"true":"false","aria-owns":a,"aria-controls":a,"aria-label":P}});it(()=>t.group,P=>{m!==void 0&&m(),P!==void 0&&Re()});function Se(P){p.value!==!0&&c(P),n("click",P)}function Ve(P){P.keyCode===13&&Je(P,!0)}function Je(P,Ae){Ae!==!0&&o.value!==null&&o.value.focus(),c(P),je(P)}function wt(){n("afterShow")}function Ze(){n("afterHide")}function Re(){d===void 0&&(d=Eo()),r.value===!0&&(Ct[t.group]=d);const P=it(r,Be=>{Be===!0?Ct[t.group]=d:Ct[t.group]===d&&delete Ct[t.group]}),Ae=it(()=>Ct[t.group],(Be,b)=>{b===d&&Be!==void 0&&Be!==d&&u()});m=()=>{P(),Ae(),Ct[t.group]===d&&delete Ct[t.group],m=void 0}}function ct(){const P={class:[`q-focusable relative-position cursor-pointer${t.denseToggle===!0&&t.switchToggleSide===!0?" items-end":""}`,t.expandIconClass],side:t.switchToggleSide!==!0,avatar:t.switchToggleSide},Ae=[k(Wt,{class:"q-expansion-item__toggle-icon"+(t.expandedIcon===void 0&&r.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:N.value})];return _.value===!0&&(Object.assign(P,{tabindex:0,...B.value,onClick:Je,onKeyup:Ve}),Ae.unshift(k("div",{ref:o,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),k(Ai,P,()=>Ae)}function St(){let P;return e.header!==void 0?P=[].concat(e.header(M.value)):(P=[k(Ai,()=>[k(ar,{lines:t.labelLines},()=>t.label||""),t.caption?k(ar,{lines:t.captionLines,caption:!0},()=>t.caption):null])],t.icon&&P[t.switchToggleSide===!0?"push":"unshift"](k(Ai,{side:t.switchToggleSide===!0,avatar:t.switchToggleSide!==!0},()=>k(Wt,{name:t.icon})))),t.disable!==!0&&t.hideExpandIcon!==!0&&P[t.switchToggleSide===!0?"unshift":"push"](ct()),P}function Tt(){const P={ref:"item",style:t.headerStyle,class:t.headerClass,dark:s.value,disable:t.disable,dense:t.dense,insetLevel:t.headerInsetLevel};return R.value===!0&&(P.clickable=!0,P.onClick=Se,Object.assign(P,p.value===!0?w.value:B.value)),k(Qu,P,St)}function et(){return Os(k("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:y.value,id:a},ln(e.default)),[[Kc,r.value]])}function He(){const P=[Tt(),k(Jg,{duration:t.duration,onShow:wt,onHide:Ze},et)];return t.expandSeparator===!0&&P.push(k(bo,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:s.value}),k(bo,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:s.value})),P}return t.group!==void 0&&Re(),zi(()=>{m!==void 0&&m()}),()=>k("div",{class:f.value},[k("div",{class:"q-expansion-item__container relative-position"},He())])}});const tp=k("div",{class:"q-space"});var np=Ue({name:"QSpace",setup(){return()=>tp}}),ip=Ue({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(t,{slots:e,emit:n}){const i=pt(),s=J(null);let r=0;const o=[];function a(f){const y=typeof f=="boolean"?f:t.noErrorFocus!==!0,p=++r,w=(_,M)=>{n("validation"+(_===!0?"Success":"Error"),M)},R=_=>{const M=_.validate();return typeof M.then=="function"?M.then(B=>({valid:B,comp:_}),B=>({valid:!1,comp:_,err:B})):Promise.resolve({valid:M,comp:_})};return(t.greedy===!0?Promise.all(o.map(R)).then(_=>_.filter(M=>M.valid!==!0)):o.reduce((_,M)=>_.then(()=>R(M).then(B=>{if(B.valid===!1)return Promise.reject(B)})),Promise.resolve()).catch(_=>[_])).then(_=>{if(_===void 0||_.length===0)return p===r&&w(!0),!0;if(p===r){const{comp:M,err:B}=_[0];if(B!==void 0&&console.error(B),w(!1,M),y===!0){const Se=_.find(({comp:Ve})=>typeof Ve.focus=="function"&&Hc(Ve.$)===!1);Se!==void 0&&Se.comp.focus()}}return!1})}function l(){r++,o.forEach(f=>{typeof f.resetValidation=="function"&&f.resetValidation()})}function u(f){f!==void 0&&je(f);const y=r+1;a().then(p=>{y===r&&p===!0&&(t.onSubmit!==void 0?n("submit",f):f!==void 0&&f.target!==void 0&&typeof f.target.submit=="function"&&f.target.submit())})}function c(f){f!==void 0&&je(f),n("reset"),nt(()=>{l(),t.autofocus===!0&&t.noResetFocus!==!0&&d()})}function d(){Qc(()=>{if(s.value===null)return;const f=s.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||s.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||s.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(s.value.querySelectorAll("[tabindex]"),y=>y.tabIndex>-1);f!=null&&f.focus({preventScroll:!0})})}zc(Gc,{bindComponent(f){o.push(f)},unbindComponent(f){const y=o.indexOf(f);y>-1&&o.splice(y,1)}});let m=!1;return Na(()=>{m=!0}),Va(()=>{m===!0&&t.autofocus===!0&&d()}),La(()=>{t.autofocus===!0&&d()}),Object.assign(i.proxy,{validate:a,resetValidation:l,submit:u,reset:c,focus:d,getValidationComponents:()=>o}),()=>k("form",{class:"q-form",ref:s,onSubmit:u,onReset:c},ln(e.default))}});function sp(){return ba(Wc)}const rp={name:"TeaEditDialog",components:{},props:["teaID"],emits:["deleted"],setup(t,e){const n=sp(),i=Hu(),s=J(t.teaID!=-1?i.getByID(t.teaID):i.emptyTea()),r=JSON.parse(JSON.stringify(s.value));return{model:s,typeOptions:[{value:"white",label:"B\xEDl\xFD \u010Daj"},{value:"green",label:"Zelen\xFD \u010Daj"},{value:"lightoolong",label:"Sv\u011Btl\xFD oolong"},{value:"darkoolong",label:"Tmav\xFD oolong"},{value:"black",label:"\u010Cern\xFD \u010Daj"},{value:"shu",label:"Shu puerh"},{value:"sheng",label:"Sheng puerh"},{value:"yellow",label:"\u017DLut\xFD \u010Daj"}],onSubmit:async()=>{t.teaID!=-1?await i.updateTea(s.value):await i.createTea(s.value)},onCancel:()=>{t.teaID!=-1&&i.restoreBackup(r)},onDelete:()=>{n.dialog({title:"Potvrdit",message:"Opravdu chcete smazat polo\u017Eku?",cancel:{label:"Ne",color:"positive"},ok:{label:"Ano",color:"positive"},persistent:!1}).onOk(async()=>{await i.deleteTea(t.teaID),e.emit("deleted")})}}}},op={key:0,class:"text-h6"},ap={key:1,class:"text-h6"},lp={key:0,class:"text-red-10"};function up(t,e,n,i,s,r){return he(),Rn(ka,{class:"q-pa-md dialog-card"},{default:Ne(()=>[G(ip,{onSubmit:i.onSubmit},{default:Ne(()=>[G(kn,null,{default:Ne(()=>[n.teaID!=-1?(he(),Le("div",op,"Upravit")):(he(),Le("div",ap,"Vytvo\u0159it")),G($e,{modelValue:i.model.name,"onUpdate:modelValue":e[0]||(e[0]=o=>i.model.name=o),label:"N\xE1zev"},null,8,["modelValue"]),G(Yg,{modelValue:i.model.type,"onUpdate:modelValue":e[1]||(e[1]=o=>i.model.type=o),options:i.typeOptions,"emit-value":"","map-options":"",label:"Kategorie"},null,8,["modelValue","options"]),G($e,{modelValue:i.model.pickingDate,"onUpdate:modelValue":e[2]||(e[2]=o=>i.model.pickingDate=o),label:"Obdob\xED sb\u011Bru"},null,8,["modelValue"]),G($e,{modelValue:i.model.origin,"onUpdate:modelValue":e[3]||(e[3]=o=>i.model.origin=o),label:"P\u016Fvod"},null,8,["modelValue"]),G($e,{modelValue:i.model.notes,"onUpdate:modelValue":e[4]||(e[4]=o=>i.model.notes=o),autogrow:"",label:"Popis"},null,8,["modelValue"]),G(Io,{modelValue:i.model.archived,"onUpdate:modelValue":e[5]||(e[5]=o=>i.model.archived=o),"left-label":"",label:"\u010Caj m\xE1m ve sb\xEDrce",color:"positive"},null,8,["modelValue"])]),_:1}),G(kn,null,{default:Ne(()=>[G(ep,{label:"P\u0159\xEDprava 1","header-class":"text-subtitle1","default-opened":"","header-style":{paddingLeft:"0px",paddingRight:"0px"}},{default:Ne(()=>["preparation"in i.model&&i.model.preparation!="..."?(he(),Le("div",lp,tt(i.model.preparation)+" (Pouze do\u010Dasn\u011B) ",1)):Ge("",!0),G($e,{modelValue:i.model.preparation2[0].amount,"onUpdate:modelValue":e[6]||(e[6]=o=>i.model.preparation2[0].amount=o),label:"Mno\u017Estv\xED [g / 100 ml]",dense:""},null,8,["modelValue"]),G($e,{modelValue:i.model.preparation2[0].temperature,"onUpdate:modelValue":e[7]||(e[7]=o=>i.model.preparation2[0].temperature=o),label:"Teplota [\u02DAC]",dense:""},null,8,["modelValue"]),G(Io,{modelValue:i.model.preparation2[0].wash,"onUpdate:modelValue":e[8]||(e[8]=o=>i.model.preparation2[0].wash=o),"left-label":"",label:"Opl\xE1chnout",color:"positive"},null,8,["modelValue"]),G($e,{modelValue:i.model.preparation2[0].times[0],"onUpdate:modelValue":e[9]||(e[9]=o=>i.model.preparation2[0].times[0]=o),label:"1. n\xE1lev [s]",dense:"","hide-bottom-space":""},null,8,["modelValue"]),G($e,{modelValue:i.model.preparation2[0].times[1],"onUpdate:modelValue":e[10]||(e[10]=o=>i.model.preparation2[0].times[1]=o),label:"2. n\xE1lev [s]",dense:"","hide-bottom-space":""},null,8,["modelValue"]),G($e,{modelValue:i.model.preparation2[0].times[2],"onUpdate:modelValue":e[11]||(e[11]=o=>i.model.preparation2[0].times[2]=o),label:"3. n\xE1lev [s]",dense:"","hide-bottom-space":""},null,8,["modelValue"]),G($e,{modelValue:i.model.preparation2[0].times[3],"onUpdate:modelValue":e[12]||(e[12]=o=>i.model.preparation2[0].times[3]=o),label:"4. n\xE1lev [s]",dense:"","hide-bottom-space":""},null,8,["modelValue"]),G($e,{modelValue:i.model.preparation2[0].times[4],"onUpdate:modelValue":e[13]||(e[13]=o=>i.model.preparation2[0].times[4]=o),label:"5. n\xE1lev [s]",dense:"","hide-bottom-space":""},null,8,["modelValue"])]),_:1})]),_:1}),G(Xc,{align:"right",class:"text-positive"},{default:Ne(()=>[n.teaID!=-1?(he(),Rn(Cn,{key:0,label:"Odstranit",onClick:i.onDelete,color:"negative",flat:""},null,8,["onClick"])):Ge("",!0),G(np),Os(G(Cn,{label:"Zru\u0161it",flat:"",onClick:i.onCancel},null,8,["onClick"]),[[ko]]),Os(G(Cn,{label:"Ulo\u017Eit",type:"submit",color:"positive"},null,512),[[ko]])]),_:1})]),_:1},8,["onSubmit"])]),_:1})}var cp=lr(rp,[["render",up]]);const hp=Yc({name:"IndexPage",components:{TeaItem:Ug,TeaEditDialog:cp},props:["selectedType"],setup(t){const e=J(!0),n=J([]),i=Hu(),s=eh();La(async()=>{await i.fetchTeas(),e.value=!1});const r=I(()=>{let u=t.selectedType=="all"?i.allTypes:i.oneType(t.selectedType);return s.showOnlyAvailable==!0&&(u=u.filter(c=>c.archived==!0)),u.sort((c,d)=>c.name>d.name)}),o=J(!1),a=J(-1);return{loading:e,teas:n,teasFiltered:r,editDialogVisible:o,editDialogTeaID:a,showEditDialog:u=>{o.value=!0,a.value=u}}}}),dp={key:0,class:"flex column items-stretch"};function fp(t,e,n,i,s,r){const o=Co("TeaItem"),a=Co("TeaEditDialog");return he(),Rn(Jc,{class:"flex column items-center bg-grey-2"},{default:Ne(()=>[t.loading?Ge("",!0):(he(),Le("div",dp,[(he(!0),Le(Ia,null,Ca(t.teasFiltered,l=>(he(),Rn(o,{key:l.id,info:l,onShowEditDialog:u=>t.showEditDialog(l.id)},null,8,["info","onShowEditDialog"]))),128))])),G(Ra,{modelValue:t.editDialogVisible,"onUpdate:modelValue":e[1]||(e[1]=l=>t.editDialogVisible=l),persistent:""},{default:Ne(()=>[G(a,{teaID:t.editDialogTeaID,onDeleted:e[0]||(e[0]=l=>t.editDialogVisible=!1)},null,8,["teaID"])]),_:1},8,["modelValue"]),G(ih,{position:"bottom-right",offset:[18,18]},{default:Ne(()=>[G(Cn,{fab:"",icon:"add",color:"positive",onClick:e[2]||(e[2]=l=>t.showEditDialog(-1))})]),_:1})]),_:1})}var yp=lr(hp,[["render",fp]]);export{yp as default};
